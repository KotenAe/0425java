<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.48">
    <script>
      const userMode = localStorage.getItem('vuepress-reco-color-scheme');
      const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;

      if (userMode === 'dark' || (typeof userMode !== 'string' && systemDarkMode)) {
        document.documentElement.classList.toggle('dark', true);
      }
    </script>
    <title>day14.书城项目第六阶段 | </title><meta name="description" content="Just playing around">
    <link rel="modulepreload" href="/assets/app.a3ab45a4.js"><link rel="modulepreload" href="/assets/day14_书城项目第六阶段.html.5d00b54f.js"><link rel="modulepreload" href="/assets/day14_书城项目第六阶段.html.3ab3b7e3.js"><link rel="prefetch" href="/assets/index.html.ebb15f84.js"><link rel="prefetch" href="/assets/day01_html_css.html.58531186.js"><link rel="prefetch" href="/assets/day02_JS.html.7bbefa79.js"><link rel="prefetch" href="/assets/day03.正则表达式-VUE-书城项目.html.adf37614.js"><link rel="prefetch" href="/assets/day04.xml_tomcat_http.html.103f4b3b.js"><link rel="prefetch" href="/assets/day05.Servlet.html.dcd8b6a6.js"><link rel="prefetch" href="/assets/day06.Request_Response.html.fb6e665d.js"><link rel="prefetch" href="/assets/day07.书城项目第二阶段.html.c0e07c35.js"><link rel="prefetch" href="/assets/day08_Thymeleaf.html.24b964b0.js"><link rel="prefetch" href="/assets/day09_书城项目第三阶段.html.8074f608.js"><link rel="prefetch" href="/assets/day10_cookie_session_书城第四阶段.html.de0da957.js"><link rel="prefetch" href="/assets/day11_Ajax_Axios_书城项目第五阶段.html.f0a245d7.js"><link rel="prefetch" href="/assets/day12_书城项目第五阶段.html.3a76a974.js"><link rel="prefetch" href="/assets/day13_Filter_Listenler_书城项目第六阶段.html.7967e701.js"><link rel="prefetch" href="/assets/day01._环境变量_HelloWorld_变量_常量_.html.7ae7bd2a.js"><link rel="prefetch" href="/assets/day02.变量_数据类型转换_运算符.html.61b798b4.js"><link rel="prefetch" href="/assets/day03_流程控制.html.24a574b4.js"><link rel="prefetch" href="/assets/day04.循环_数组.html.354c4af1.js"><link rel="prefetch" href="/assets/day05.方法.html.3eb83c4b.js"><link rel="prefetch" href="/assets/day06.方法的重载_面向对象.html.0f4e47d6.js"><link rel="prefetch" href="/assets/day07.可变参数 命令行参数 递归 对象数组.html.49f61394.js"><link rel="prefetch" href="/assets/day08.封装_标准JavaBean_继承_代码块.html.c33d7be4.js"><link rel="prefetch" href="/assets/day09.抽象 多态.html.fa6b08b2.js"><link rel="prefetch" href="/assets/day10.接口-final-内部类.html.c1ceaebb.js"><link rel="prefetch" href="/assets/day11.Object_异常.html.dec73e0a.js"><link rel="prefetch" href="/assets/day12.基础API.html.78902b30.js"><link rel="prefetch" href="/assets/day13.常用API.html.6baab0dd.js"><link rel="prefetch" href="/assets/day14.API_多线程.html.b85f8d16.js"><link rel="prefetch" href="/assets/day15. 多线程.html.d344fb02.js"><link rel="prefetch" href="/assets/day16.集合.html.1a53a169.js"><link rel="prefetch" href="/assets/day17.集合.html.31d51334.js"><link rel="prefetch" href="/assets/day18.Map集合_正则表达式.html.438d1716.js"><link rel="prefetch" href="/assets/day19.File类_IO流.html.25b09cae.js"><link rel="prefetch" href="/assets/day20.IO流.html.33266278.js"><link rel="prefetch" href="/assets/day21.IO流_网络编程.html.5665c59c.js"><link rel="prefetch" href="/assets/day22.JDK8新特性.html.50304d5f.js"><link rel="prefetch" href="/assets/day23.反射.html.ddf5f3d3.js"><link rel="prefetch" href="/assets/Maven.html.bea69fd9.js"><link rel="prefetch" href="/assets/JDBC相关配置.html.6fa67258.js"><link rel="prefetch" href="/assets/MySQL8.0_JDBC笔记.html.ca348289.js"><link rel="prefetch" href="/assets/MySQL8.0_SQL笔记.html.e4a25fc0.js"><link rel="prefetch" href="/assets/尚硅谷_JavaEE_Linux.html.e1cb317c.js"><link rel="prefetch" href="/assets/尚硅谷_JAVAEE_MyBatis.html.cfc6f95c.js"><link rel="prefetch" href="/assets/尚硅谷_JAVAEE_SpringMVC_01.html.d5463ac6.js"><link rel="prefetch" href="/assets/尚硅谷_JAVAEE_SpringMVC_02.html.1950a71d.js"><link rel="prefetch" href="/assets/尚硅谷_JAVAEE_SpringMVC_03.html.8eeb7d5e.js"><link rel="prefetch" href="/assets/尚硅谷_JAVAEE_Spring_01.html.3c92ad1f.js"><link rel="prefetch" href="/assets/尚硅谷_JAVAEE_Spring_02.html.02108edc.js"><link rel="prefetch" href="/assets/尚硅谷_JAVAEE_SSM整合.html.6dc18351.js"><link rel="prefetch" href="/assets/introduce.html.28805215.js"><link rel="prefetch" href="/assets/api.html.129f101e.js"><link rel="prefetch" href="/assets/home.html.003faba0.js"><link rel="prefetch" href="/assets/plugin.html.ef0e2a60.js"><link rel="prefetch" href="/assets/theme.html.b9cd7c4e.js"><link rel="prefetch" href="/assets/day01_数据库基础.html.126e3169.js"><link rel="prefetch" href="/assets/day03_Mysql函数_DCL_JDBC.html.6060eb04.js"><link rel="prefetch" href="/assets/day04.连接池_DBUtils_事务.html.73863eaf.js"><link rel="prefetch" href="/assets/day02.多表查询.html.41d5f281.js"><link rel="prefetch" href="/assets/404.html.d341cb57.js"><link rel="prefetch" href="/assets/index.html.58efd06f.js"><link rel="prefetch" href="/assets/index.html.97de9f46.js"><link rel="prefetch" href="/assets/index.html.557aa63b.js"><link rel="prefetch" href="/assets/index.html.ad7ee736.js"><link rel="prefetch" href="/assets/index.html.0c81c793.js"><link rel="prefetch" href="/assets/index.html.3ad1ba34.js"><link rel="prefetch" href="/assets/index.html.1df5c8f0.js"><link rel="prefetch" href="/assets/index.html.3063722d.js"><link rel="prefetch" href="/assets/index.html.61990ea1.js"><link rel="prefetch" href="/assets/index.html.47860465.js"><link rel="prefetch" href="/assets/index.html.9c0ff370.js"><link rel="prefetch" href="/assets/index.html.ceff066d.js"><link rel="prefetch" href="/assets/index.html.619474bb.js"><link rel="prefetch" href="/assets/index.html.a37c7154.js"><link rel="prefetch" href="/assets/index.html.0b8b01e2.js"><link rel="prefetch" href="/assets/index.html.c84b791a.js"><link rel="prefetch" href="/assets/index.html.0019e90f.js"><link rel="prefetch" href="/assets/index.html.f4568a25.js"><link rel="prefetch" href="/assets/index.html.57051674.js"><link rel="prefetch" href="/assets/index.html.40a5a878.js"><link rel="prefetch" href="/assets/index.html.574e8ea0.js"><link rel="prefetch" href="/assets/index.html.0dd284c6.js"><link rel="prefetch" href="/assets/index.html.06e3e078.js"><link rel="prefetch" href="/assets/index.html.a012c9d6.js"><link rel="prefetch" href="/assets/index.html.524628e4.js"><link rel="prefetch" href="/assets/index.html.cf9769f3.js"><link rel="prefetch" href="/assets/index.html.c6e767ae.js"><link rel="prefetch" href="/assets/index.html.fca78420.js"><link rel="prefetch" href="/assets/index.html.c27283be.js"><link rel="prefetch" href="/assets/index.html.0927b918.js"><link rel="prefetch" href="/assets/index.html.98fba16a.js"><link rel="prefetch" href="/assets/index.html.e85777b3.js"><link rel="prefetch" href="/assets/index.html.20785866.js"><link rel="prefetch" href="/assets/index.html.4d2fabb8.js"><link rel="prefetch" href="/assets/index.html.4528ce4e.js"><link rel="prefetch" href="/assets/index.html.631e815c.js"><link rel="prefetch" href="/assets/index.html.29a76e91.js"><link rel="prefetch" href="/assets/index.html.b3505ff8.js"><link rel="prefetch" href="/assets/index.html.6253a7e1.js"><link rel="prefetch" href="/assets/index.html.bb8525b1.js"><link rel="prefetch" href="/assets/index.html.28ee009d.js"><link rel="prefetch" href="/assets/index.html.72ac4063.js"><link rel="prefetch" href="/assets/index.html.b57762aa.js"><link rel="prefetch" href="/assets/index.html.08b3a957.js"><link rel="prefetch" href="/assets/index.html.9cbf2d78.js"><link rel="prefetch" href="/assets/index.html.4bc70fa1.js"><link rel="prefetch" href="/assets/index.html.7d530fd6.js"><link rel="prefetch" href="/assets/index.html.6c91053f.js"><link rel="prefetch" href="/assets/index.html.aca8845c.js"><link rel="prefetch" href="/assets/day01_html_css.html.e7031b28.js"><link rel="prefetch" href="/assets/day02_JS.html.67604748.js"><link rel="prefetch" href="/assets/day03.正则表达式-VUE-书城项目.html.aaff2bde.js"><link rel="prefetch" href="/assets/day04.xml_tomcat_http.html.e15916ae.js"><link rel="prefetch" href="/assets/day05.Servlet.html.94007cd3.js"><link rel="prefetch" href="/assets/day06.Request_Response.html.7903b50f.js"><link rel="prefetch" href="/assets/day07.书城项目第二阶段.html.b0a2dbf2.js"><link rel="prefetch" href="/assets/day08_Thymeleaf.html.e08a367a.js"><link rel="prefetch" href="/assets/day09_书城项目第三阶段.html.6ab231dd.js"><link rel="prefetch" href="/assets/day10_cookie_session_书城第四阶段.html.d8e47253.js"><link rel="prefetch" href="/assets/day11_Ajax_Axios_书城项目第五阶段.html.05e9c152.js"><link rel="prefetch" href="/assets/day12_书城项目第五阶段.html.e73547da.js"><link rel="prefetch" href="/assets/day13_Filter_Listenler_书城项目第六阶段.html.706a4f5d.js"><link rel="prefetch" href="/assets/day01._环境变量_HelloWorld_变量_常量_.html.1218b13b.js"><link rel="prefetch" href="/assets/day02.变量_数据类型转换_运算符.html.033b30ff.js"><link rel="prefetch" href="/assets/day03_流程控制.html.e1c8c0e7.js"><link rel="prefetch" href="/assets/day04.循环_数组.html.bac2989b.js"><link rel="prefetch" href="/assets/day05.方法.html.f9f40ee7.js"><link rel="prefetch" href="/assets/day06.方法的重载_面向对象.html.71c81410.js"><link rel="prefetch" href="/assets/day07.可变参数 命令行参数 递归 对象数组.html.cdc4876c.js"><link rel="prefetch" href="/assets/day08.封装_标准JavaBean_继承_代码块.html.e1784b45.js"><link rel="prefetch" href="/assets/day09.抽象 多态.html.77aeb0f5.js"><link rel="prefetch" href="/assets/day10.接口-final-内部类.html.73b28a0b.js"><link rel="prefetch" href="/assets/day11.Object_异常.html.a57b0c5f.js"><link rel="prefetch" href="/assets/day12.基础API.html.5260352e.js"><link rel="prefetch" href="/assets/day13.常用API.html.07b560ea.js"><link rel="prefetch" href="/assets/day14.API_多线程.html.e6cb5701.js"><link rel="prefetch" href="/assets/day15. 多线程.html.be89a5b2.js"><link rel="prefetch" href="/assets/day16.集合.html.c114e4e8.js"><link rel="prefetch" href="/assets/day17.集合.html.3f246d0d.js"><link rel="prefetch" href="/assets/day18.Map集合_正则表达式.html.4180d9a9.js"><link rel="prefetch" href="/assets/day19.File类_IO流.html.7a9058b2.js"><link rel="prefetch" href="/assets/day20.IO流.html.0854835f.js"><link rel="prefetch" href="/assets/day21.IO流_网络编程.html.d5e2eb99.js"><link rel="prefetch" href="/assets/day22.JDK8新特性.html.b0126c2e.js"><link rel="prefetch" href="/assets/day23.反射.html.7bd37766.js"><link rel="prefetch" href="/assets/Maven.html.d5b0f369.js"><link rel="prefetch" href="/assets/JDBC相关配置.html.ce57076e.js"><link rel="prefetch" href="/assets/MySQL8.0_JDBC笔记.html.908bbbbf.js"><link rel="prefetch" href="/assets/MySQL8.0_SQL笔记.html.b35b9eec.js"><link rel="prefetch" href="/assets/尚硅谷_JavaEE_Linux.html.49047ee1.js"><link rel="prefetch" href="/assets/尚硅谷_JAVAEE_MyBatis.html.b1888d79.js"><link rel="prefetch" href="/assets/尚硅谷_JAVAEE_SpringMVC_01.html.b365a1f7.js"><link rel="prefetch" href="/assets/尚硅谷_JAVAEE_SpringMVC_02.html.48af7bad.js"><link rel="prefetch" href="/assets/尚硅谷_JAVAEE_SpringMVC_03.html.bd03fc97.js"><link rel="prefetch" href="/assets/尚硅谷_JAVAEE_Spring_01.html.b0ac5006.js"><link rel="prefetch" href="/assets/尚硅谷_JAVAEE_Spring_02.html.81819d25.js"><link rel="prefetch" href="/assets/尚硅谷_JAVAEE_SSM整合.html.071d6dbd.js"><link rel="prefetch" href="/assets/introduce.html.1f287638.js"><link rel="prefetch" href="/assets/api.html.0ff820e5.js"><link rel="prefetch" href="/assets/home.html.cc5e5dd6.js"><link rel="prefetch" href="/assets/plugin.html.96c4855f.js"><link rel="prefetch" href="/assets/theme.html.b204257f.js"><link rel="prefetch" href="/assets/day01_数据库基础.html.435d0f70.js"><link rel="prefetch" href="/assets/day03_Mysql函数_DCL_JDBC.html.fc4cbbd6.js"><link rel="prefetch" href="/assets/day04.连接池_DBUtils_事务.html.1c03ce85.js"><link rel="prefetch" href="/assets/day02.多表查询.html.530dbd1f.js"><link rel="prefetch" href="/assets/404.html.6c289388.js"><link rel="prefetch" href="/assets/index.html.28d46d0f.js"><link rel="prefetch" href="/assets/index.html.a52191f3.js"><link rel="prefetch" href="/assets/index.html.8d55b278.js"><link rel="prefetch" href="/assets/index.html.8f21397a.js"><link rel="prefetch" href="/assets/index.html.ae1d53ab.js"><link rel="prefetch" href="/assets/index.html.d18b591c.js"><link rel="prefetch" href="/assets/index.html.d0675f51.js"><link rel="prefetch" href="/assets/index.html.428a891a.js"><link rel="prefetch" href="/assets/index.html.e444627b.js"><link rel="prefetch" href="/assets/index.html.7ebfebc8.js"><link rel="prefetch" href="/assets/index.html.faa84a8c.js"><link rel="prefetch" href="/assets/index.html.222f6531.js"><link rel="prefetch" href="/assets/index.html.6fdf9859.js"><link rel="prefetch" href="/assets/index.html.cb4ad210.js"><link rel="prefetch" href="/assets/index.html.f958ccc9.js"><link rel="prefetch" href="/assets/index.html.350fea0d.js"><link rel="prefetch" href="/assets/index.html.db50d4c5.js"><link rel="prefetch" href="/assets/index.html.0ebe57fe.js"><link rel="prefetch" href="/assets/index.html.7ebded45.js"><link rel="prefetch" href="/assets/index.html.4c42615d.js"><link rel="prefetch" href="/assets/index.html.9c4009c2.js"><link rel="prefetch" href="/assets/index.html.16792d52.js"><link rel="prefetch" href="/assets/index.html.3f3a2245.js"><link rel="prefetch" href="/assets/index.html.aec0688f.js"><link rel="prefetch" href="/assets/index.html.05572688.js"><link rel="prefetch" href="/assets/index.html.a9d9696b.js"><link rel="prefetch" href="/assets/index.html.4c72881c.js"><link rel="prefetch" href="/assets/index.html.1347abf2.js"><link rel="prefetch" href="/assets/index.html.13be939a.js"><link rel="prefetch" href="/assets/index.html.11b2957c.js"><link rel="prefetch" href="/assets/index.html.dc2286ef.js"><link rel="prefetch" href="/assets/index.html.5f96ea9e.js"><link rel="prefetch" href="/assets/index.html.419630fc.js"><link rel="prefetch" href="/assets/index.html.8f0d3a1a.js"><link rel="prefetch" href="/assets/index.html.f056c164.js"><link rel="prefetch" href="/assets/index.html.6dabcbc7.js"><link rel="prefetch" href="/assets/index.html.2328a899.js"><link rel="prefetch" href="/assets/index.html.43087c18.js"><link rel="prefetch" href="/assets/index.html.7e0e55d3.js"><link rel="prefetch" href="/assets/index.html.ff46ce3d.js"><link rel="prefetch" href="/assets/index.html.22afaaac.js"><link rel="prefetch" href="/assets/index.html.7882710c.js"><link rel="prefetch" href="/assets/index.html.72604ce3.js"><link rel="prefetch" href="/assets/index.html.6009e057.js"><link rel="prefetch" href="/assets/index.html.b0a115c8.js"><link rel="prefetch" href="/assets/index.html.07e29e17.js"><link rel="prefetch" href="/assets/index.html.721e20e8.js"><link rel="prefetch" href="/assets/index.html.38465f47.js"><link rel="prefetch" href="/assets/404.9e6b1fc0.js"><link rel="prefetch" href="/assets/Categories.b4cdad14.js"><link rel="prefetch" href="/assets/Layout.e815cd43.js"><link rel="prefetch" href="/assets/Post.b02fd647.js"><link rel="prefetch" href="/assets/Timeline.2abb69c2.js"><link rel="prefetch" href="/assets/reco-valine.88224ab5.js">
    <link rel="stylesheet" href="/assets/style.03d208ca.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><div class="common-wrapper no-sidebar"><header class="navbar-container"><div class="toggle-sidebar-button" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span class="site-brand"><a href="/" class=""><!----><!----></a></span><div class="navbar-links-wrapper" style=""><form class="search-box" role="search"><input type="search" autocomplete="off" spellcheck="false" value><!----></form><nav class="navbar-links"><!--[--><div class="navbar-links-item"><a href="/" class="nav-link" aria-label="Home"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->Home<!--]--></span></a><!--[--><!--]--></a></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="Categories"><a class="icon-container left title" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->Categories<!--]--></span></a><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="Categories"><a class="icon-container left title" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->Categories<!--]--></span></a><span class="right arrow"></span></button><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/categories/JavaWEB/1/" class="nav-link" aria-label="JavaWEB"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->JavaWEB<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/categories/Javajichu/1/" class="nav-link" aria-label="Java基础"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->Java基础<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/categories/Maven/1/" class="nav-link" aria-label="Maven"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->Maven<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/categories/JDBC/1/" class="nav-link" aria-label="JDBC"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->JDBC<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/categories/MySQL/1/" class="nav-link" aria-label="MySQL"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->MySQL<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/categories/MyBatis/1/" class="nav-link" aria-label="MyBatis"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->MyBatis<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/categories/SpringMVC/1/" class="nav-link" aria-label="SpringMVC"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->SpringMVC<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/categories/Spring5/1/" class="nav-link" aria-label="Spring5"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->Spring5<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/categories/SSM/1/" class="nav-link" aria-label="SSM"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->SSM<!--]--></span></a><!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="Tags"><a class="icon-container left title" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->Tags<!--]--></span></a><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="Tags"><a class="icon-container left title" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->Tags<!--]--></span></a><span class="right arrow"></span></button><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/tags/JavaWEB/1/" class="nav-link" aria-label="JavaWEB"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->JavaWEB<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/shuchengxiangmu/1/" class="nav-link" aria-label="书城项目"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->书城项目<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/Javajichu/1/" class="nav-link" aria-label="Java基础"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->Java基础<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/yichang/1/" class="nav-link" aria-label="异常"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->异常<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/API/1/" class="nav-link" aria-label="API"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->API<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/duoxiancheng/1/" class="nav-link" aria-label="多线程"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->多线程<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/jihe/1/" class="nav-link" aria-label="集合"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->集合<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/zhengzebiaodashi/1/" class="nav-link" aria-label="正则表达式"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->正则表达式<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/IOliu/1/" class="nav-link" aria-label="IO流"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->IO流<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/wangluobiancheng/1/" class="nav-link" aria-label="网络编程"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->网络编程<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/JDK8xintexing/1/" class="nav-link" aria-label="JDK8新特性"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->JDK8新特性<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/fanshe/1/" class="nav-link" aria-label="反射"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->反射<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/Maven/1/" class="nav-link" aria-label="Maven"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->Maven<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/baoguanli/1/" class="nav-link" aria-label="包管理"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->包管理<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/shujukuqudong/1/" class="nav-link" aria-label="数据库驱动"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->数据库驱动<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/JDBC/1/" class="nav-link" aria-label="JDBC"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->JDBC<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/shujuku/1/" class="nav-link" aria-label="数据库"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->数据库<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/MySQL/1/" class="nav-link" aria-label="MySQL"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->MySQL<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/MyBatis/1/" class="nav-link" aria-label="MyBatis"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->MyBatis<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/SpringMVC/1/" class="nav-link" aria-label="SpringMVC"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->SpringMVC<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/Spring5/1/" class="nav-link" aria-label="Spring5"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->Spring5<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/SSM/1/" class="nav-link" aria-label="SSM"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->SSM<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/lianjiechi/1/" class="nav-link" aria-label="连接池"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->连接池<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/DBUtils/1/" class="nav-link" aria-label="DBUtils"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->DBUtils<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/shiwu/1/" class="nav-link" aria-label="事务"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->事务<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/Mysql/1/" class="nav-link" aria-label="Mysql"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->Mysql<!--]--></span></a><!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="Link"><a class="icon-container left title" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->Link<!--]--></span></a><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="Link"><a class="icon-container left title" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->Link<!--]--></span></a><span class="right arrow"></span></button><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a class="nav-link" href="https://sneoo.com" rel="noopener noreferrer" target="_blank" aria-label="Typecho"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->Typecho<!--]--></span></a><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><!--]--></ul></div></div><!--]--></nav><a class="icon-container left btn-toggle-dark-mode" href="javascript:void(0)"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" style="color:inherit;width:20px;height:20px;font-size:20px;"><g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3h.393a7.5 7.5 0 0 0 7.92 12.446A9 9 0 1 1 12 2.992z"></path><path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0-2 2a2 2 0 0 0-2-2a2 2 0 0 0 2-2"></path><path d="M19 11h2m-1-1v2"></path></g></svg><!----></a></div></header><div class="sidebar-mask"></div><aside class="series-container"><nav class="navbar-links"><!--[--><div class="navbar-links-item"><a href="/" class="nav-link" aria-label="Home"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->Home<!--]--></span></a><!--[--><!--]--></a></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="Categories"><a class="icon-container left title" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->Categories<!--]--></span></a><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="Categories"><a class="icon-container left title" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->Categories<!--]--></span></a><span class="right arrow"></span></button><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/categories/JavaWEB/1/" class="nav-link" aria-label="JavaWEB"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->JavaWEB<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/categories/Javajichu/1/" class="nav-link" aria-label="Java基础"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->Java基础<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/categories/Maven/1/" class="nav-link" aria-label="Maven"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->Maven<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/categories/JDBC/1/" class="nav-link" aria-label="JDBC"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->JDBC<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/categories/MySQL/1/" class="nav-link" aria-label="MySQL"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->MySQL<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/categories/MyBatis/1/" class="nav-link" aria-label="MyBatis"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->MyBatis<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/categories/SpringMVC/1/" class="nav-link" aria-label="SpringMVC"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->SpringMVC<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/categories/Spring5/1/" class="nav-link" aria-label="Spring5"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->Spring5<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/categories/SSM/1/" class="nav-link" aria-label="SSM"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->SSM<!--]--></span></a><!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="Tags"><a class="icon-container left title" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->Tags<!--]--></span></a><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="Tags"><a class="icon-container left title" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->Tags<!--]--></span></a><span class="right arrow"></span></button><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/tags/JavaWEB/1/" class="nav-link" aria-label="JavaWEB"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->JavaWEB<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/shuchengxiangmu/1/" class="nav-link" aria-label="书城项目"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->书城项目<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/Javajichu/1/" class="nav-link" aria-label="Java基础"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->Java基础<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/yichang/1/" class="nav-link" aria-label="异常"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->异常<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/API/1/" class="nav-link" aria-label="API"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->API<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/duoxiancheng/1/" class="nav-link" aria-label="多线程"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->多线程<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/jihe/1/" class="nav-link" aria-label="集合"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->集合<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/zhengzebiaodashi/1/" class="nav-link" aria-label="正则表达式"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->正则表达式<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/IOliu/1/" class="nav-link" aria-label="IO流"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->IO流<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/wangluobiancheng/1/" class="nav-link" aria-label="网络编程"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->网络编程<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/JDK8xintexing/1/" class="nav-link" aria-label="JDK8新特性"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->JDK8新特性<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/fanshe/1/" class="nav-link" aria-label="反射"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->反射<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/Maven/1/" class="nav-link" aria-label="Maven"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->Maven<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/baoguanli/1/" class="nav-link" aria-label="包管理"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->包管理<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/shujukuqudong/1/" class="nav-link" aria-label="数据库驱动"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->数据库驱动<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/JDBC/1/" class="nav-link" aria-label="JDBC"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->JDBC<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/shujuku/1/" class="nav-link" aria-label="数据库"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->数据库<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/MySQL/1/" class="nav-link" aria-label="MySQL"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->MySQL<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/MyBatis/1/" class="nav-link" aria-label="MyBatis"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->MyBatis<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/SpringMVC/1/" class="nav-link" aria-label="SpringMVC"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->SpringMVC<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/Spring5/1/" class="nav-link" aria-label="Spring5"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->Spring5<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/SSM/1/" class="nav-link" aria-label="SSM"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->SSM<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/lianjiechi/1/" class="nav-link" aria-label="连接池"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->连接池<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/DBUtils/1/" class="nav-link" aria-label="DBUtils"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->DBUtils<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/shiwu/1/" class="nav-link" aria-label="事务"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->事务<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/Mysql/1/" class="nav-link" aria-label="Mysql"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->Mysql<!--]--></span></a><!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="Link"><a class="icon-container left title" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->Link<!--]--></span></a><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="Link"><a class="icon-container left title" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->Link<!--]--></span></a><span class="right arrow"></span></button><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a class="nav-link" href="https://sneoo.com" rel="noopener noreferrer" target="_blank" aria-label="Typecho"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->Typecho<!--]--></span></a><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><!--]--></ul></div></div><!--]--></nav><!--[--><!--]--></aside><!--[--><main class="page-container show-catalog"><h1 class="page-title">day14.书城项目第六阶段</h1><div class="page-info"><a class="icon-container left" href="javascript:void(0)"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" style="color:inherit;width:18px;height:18px;font-size:18px;"><g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="7" r="4"></circle><path d="M6 21v-2a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v2"></path></g></svg><span style="color:inherit;font-size:14px;"><!--[-->Kotena<!--]--></span></a><a class="icon-container left" href="javascript:void(0)"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" style="color:inherit;width:18px;height:18px;font-size:18px;"><g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="9"></circle><path d="M12 7v5l3 3"></path></g></svg><span style="color:inherit;font-size:14px;"><!--[-->2022-07-04 00:00:00<!--]--></span></a><a class="icon-container left" href="javascript:void(0)"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" style="color:inherit;width:18px;height:18px;font-size:18px;"><path d="M5 4h4l3 3h7a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg><span style="color:inherit;font-size:14px;"><!--[--><!--[--><a href="/categories/JavaWEB/1/" class="category">JavaWEB</a><!--]--><!--]--></span></a><a class="icon-container left" href="javascript:void(0)"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" style="color:inherit;width:18px;height:18px;font-size:18px;"><g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="8.5" cy="8.5" r="1" fill="currentColor"></circle><path d="M4 7v3.859c0 .537.213 1.052.593 1.432l8.116 8.116a2.025 2.025 0 0 0 2.864 0l4.834-4.834a2.025 2.025 0 0 0 0-2.864L12.29 4.593A2.025 2.025 0 0 0 10.859 4H7a3 3 0 0 0-3 3z"></path></g></svg><span style="color:inherit;font-size:14px;"><!--[--><!--[--><a href="/tags/JavaWEB/1/" class="tag">JavaWEB</a><a href="/tags/书城项目/1/" class="tag">书城项目</a><!--]--><!--]--></span></a><a class="icon-container left" href="javascript:void(0)"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" style="color:inherit;width:18px;height:18px;font-size:18px;"><g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="2"></circle><path d="M22 12c-2.667 4.667-6 7-10 7s-7.333-2.333-10-7c2.667-4.667 6-7 10-7s7.333 2.333 10 7"></path></g></svg><span style="color:inherit;font-size:14px;"><!--[--><span id="/blogs/javaweb/day14_shuchengxiangmudiliujieduan.html" class="leancloud-visitors" data-flag-title="Your Article Title"><a class="leancloud-visitors-count" style=""></a></span><!--]--></span></a></div><div class="theme-reco-default-content"><div><h1 id="day14-书城项目第六阶段" tabindex="-1"><a class="header-anchor" href="#day14-书城项目第六阶段" aria-hidden="true">#</a> day14.书城项目第六阶段</h1><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>课前回顾<span class="token operator">:</span>
  <span class="token number">1.F</span>ilter过滤器<span class="token operator">-&gt;</span>用于过滤请求的运行在服务器的小程序
  <span class="token number">2.F</span>ilter过滤器中的过滤方法<span class="token operator">:</span><span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span>代表放行<span class="token punctuation">,</span>如果不写<span class="token punctuation">,</span>就直接会卡到当前过滤器中
  <span class="token number">3.</span>匹配规则<span class="token operator">:</span>
    a<span class="token punctuation">.</span>精准匹配<span class="token operator">:</span>  直接写的是请求资源的路径
    b<span class="token punctuation">.</span>模糊匹配<span class="token operator">:</span>
      <span class="token comment">/* -&gt; 过滤所有请求 -&gt; 太绝对
      /目录名/*  -&gt; 只有访问路径中带指定目录名的才能走这个过滤器  
    c.后缀名匹配:
      后缀名  -&gt; 访问路径上带这个后缀名的才会走过滤器
    d.名称匹配:
      写servlet-name中的名字
      
  4.多个过滤器的执行顺序:
    a.多个过滤器如果都是使用url-pattern配置,那么哪个过滤器在web.xml上面就先走哪个过滤器
    b.如果url-pattern方式和servlet-name方式混合使用,先走url-pattern这种
    c.注解方式:  看名字,谁在前,谁先执行,比较名称字符
  5.监听器-&gt;监听域对象以及域对象属性的更改

今日重点:
  1.完成订单和订单项的存储
  2.会事务的基本使用-&gt;回顾
  3.在订单功能中添加事务
     
</span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="第一章-书城项目第六阶段" tabindex="-1"><a class="header-anchor" href="#第一章-书城项目第六阶段" aria-hidden="true">#</a> 第一章.书城项目第六阶段</h1><h2 id="_1-登录检查" tabindex="-1"><a class="header-anchor" href="#_1-登录检查" aria-hidden="true">#</a> 1.登录检查</h2><h3 id="_1-1-用户权限说明" tabindex="-1"><a class="header-anchor" href="#_1-1-用户权限说明" aria-hidden="true">#</a> 1.1.用户权限说明</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token number">1.</span>当前项目如果我们没有登录的话<span class="token punctuation">,</span>也可以直接访问购物车<span class="token punctuation">,</span>也可以操作购物车<span class="token punctuation">,</span>但是实际上我们不允许<span class="token punctuation">;</span>只有登录之后才能操作购物车<span class="token punctuation">,</span>所以我们需要加一个登录权限的校验

<span class="token number">2.</span>不光是购物车<span class="token punctuation">,</span>订单也需要用户权限
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-2-登录检查功能流程" tabindex="-1"><a class="header-anchor" href="#_1-2-登录检查功能流程" aria-hidden="true">#</a> 1.2.登录检查功能流程</h3><img src="https://photo.sneoo.com/spring5/202207051131871.png" alt="image-20211203143038950" style="zoom:80%;"><h3 id="_1-3-登录检查功能过滤器配置" tabindex="-1"><a class="header-anchor" href="#_1-3-登录检查功能过滤器配置" aria-hidden="true">#</a> 1.3.登录检查功能过滤器配置</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>由于我们过滤的资源只有购物车和订单<span class="token punctuation">,</span>其他的不拦截<span class="token punctuation">,</span>所以我们在过滤器上直接指定<span class="token operator">-&gt;</span>使用目录配置
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@WebFilter</span><span class="token punctuation">(</span><span class="token string">&quot;/protected/*&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LoginFilter</span> <span class="token keyword">implements</span> <span class="token class-name">Filter</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">FilterConfig</span> filterConfig<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span> <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">ServletRequest</span> servletRequest<span class="token punctuation">,</span> <span class="token class-name">ServletResponse</span> servletResponse<span class="token punctuation">,</span> <span class="token class-name">FilterChain</span> filterChain<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">{</span>
        <span class="token comment">//放行</span>
       filterChain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>servletRequest<span class="token punctuation">,</span>servletResponse<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>修改<span class="token class-name">CartServlet</span>的url<span class="token operator">-</span>pattern
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
    
凡是访问<span class="token class-name">CartServlet</span>的请求<span class="token punctuation">,</span>肯定是操作<span class="token string">&quot;购物车&quot;</span><span class="token punctuation">,</span>就应该匹配过滤器<span class="token punctuation">,</span>先去过滤器这边过滤一下<span class="token punctuation">,</span>放行了<span class="token punctuation">,</span>再到<span class="token class-name">CartServlet</span>上执行    
    
<span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span><span class="token string">&quot;/protected/cart&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CartServlet</span> <span class="token keyword">extends</span> <span class="token class-name">BaseServlet</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
如果只修改servlet那么页面所有关于购物车的都废了<span class="token punctuation">,</span>所以我们还有修改页面上的请求路径
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>修改index<span class="token punctuation">.</span>html<span class="token punctuation">,</span>将所有请求路径中带cart的前面全部加上<span class="token keyword">protected</span><span class="token operator">/</span>
修改cart<span class="token punctuation">.</span>html<span class="token punctuation">,</span>将所有请求路径中带cart的前面全部加上<span class="token keyword">protected</span><span class="token operator">/</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-4-登录检查实现" tabindex="-1"><a class="header-anchor" href="#_1-4-登录检查实现" aria-hidden="true">#</a> 1.4.登录检查实现</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>修改<span class="token class-name">LoginFilter</span>类<span class="token operator">:</span>
<span class="token number">1.</span>先从session域中取出用户对象
<span class="token number">2.</span>如果用户对象不是空<span class="token punctuation">,</span>证明用户登录了<span class="token punctuation">,</span>就放行
<span class="token number">3.</span>如果用户对象为空<span class="token punctuation">,</span>证明用户尚未登录
  <span class="token class-name">A</span><span class="token operator">:</span>同步请求<span class="token punctuation">,</span>转发到登录页面
  <span class="token class-name">B</span><span class="token operator">:</span>异步请求<span class="token punctuation">,</span>响应尚未登录的信息
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
<span class="token annotation punctuation">@WebFilter</span><span class="token punctuation">(</span><span class="token string">&quot;/protected/*&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LoginFilter</span> <span class="token keyword">implements</span> <span class="token class-name">Filter</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">ServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">ServletResponse</span> resp<span class="token punctuation">,</span> <span class="token class-name">FilterChain</span> chain<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token comment">//1.由于参数都是父接口,所以先强转一下</span>
        <span class="token class-name">HttpServletRequest</span> request <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span><span class="token punctuation">)</span> req<span class="token punctuation">;</span>
        <span class="token class-name">HttpServletResponse</span> response <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">HttpServletResponse</span><span class="token punctuation">)</span> resp<span class="token punctuation">;</span>
        <span class="token comment">//2.获取session中的user对象</span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">)</span> request<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//3.如果user为空,开始拦截</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>user <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">/*
            注意:
              我们点击&quot;购物车&quot;的时候是同步请求
              我们点击&quot;添加购物车&quot;以及其他购物车操作都是异步的

              我们如何判定是同步还是异步呢?
            解决:
              a.我们点击&quot;购物车&quot;按钮其实在index.html中调用了method=toCartPage方法
                如果我们获取到的method请求参数是toCartPage就是同步请求

              b.其他的购物车操作都是异步的
           */</span>
          <span class="token comment">//4.获取method请求参数</span>
            <span class="token class-name">String</span> method <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">&quot;method&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;toCartPage&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                response<span class="token punctuation">.</span><span class="token function">sendRedirect</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getContextPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;/user?method=toLoginPage&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                <span class="token comment">//异步请求</span>
                <span class="token class-name">CommonResult</span> commonResult <span class="token operator">=</span> <span class="token class-name">CommonResult</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setMessage</span><span class="token punctuation">(</span><span class="token string">&quot;unlogin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//打成json数据,响应给客户端</span>
                <span class="token class-name">JsonUtils</span><span class="token punctuation">.</span><span class="token function">writeResult</span><span class="token punctuation">(</span>response<span class="token punctuation">,</span>commonResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            chain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> resp<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">FilterConfig</span> config<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span> <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>修改index<span class="token punctuation">.</span>html
<span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">=</span>
 <span class="token comment">//添加购物车</span>
            <span class="token function">addCart</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">/*
                  将&quot;添加购物车&quot;按钮上获取的bookId拿过来呀&#39;
                  只有将按钮上获取的bookId拿到此方法中
                  我们才能发送axios异步请求,将bookId携带过去

                  event.target可以获取到当前方法对应事件所在的标签对象
                 */</span>
                <span class="token keyword">var</span> bookId <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
                <span class="token comment">//发送异步请求</span>
                <span class="token function">axios</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                    <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">&quot;post&quot;</span><span class="token punctuation">,</span> <span class="token comment">//请求方式</span>
                    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">&quot;protected/cart&quot;</span><span class="token punctuation">,</span>    <span class="token comment">//请求路径</span>
                    <span class="token literal-property property">params</span><span class="token operator">:</span> <span class="token punctuation">{</span>   <span class="token comment">//请求参数</span>
                        <span class="token string-property property">&quot;method&quot;</span><span class="token operator">:</span> <span class="token string">&quot;addCart&quot;</span><span class="token punctuation">,</span>
                        <span class="token string-property property">&quot;bookId&quot;</span><span class="token operator">:</span> bookId
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>flag <span class="token operator">==</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token comment">//提示用户添加成功</span>
                        layer<span class="token punctuation">.</span><span class="token function">msg</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token comment">//添加之后马上再重新获取一下总数量</span>
                        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getTotalCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>message<span class="token operator">==</span><span class="token string">&quot;unlogin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                            <span class="token comment">/*
                              location对象,这个对象可以操作地址栏的内容

                              location是window对象中的,属于BOM对象

                              window对象不用写,就可以直接使用window对象中的其他对象

                              使用location中的href属性,可以直接操作浏览器地址栏中的内容
                            */</span>
                            location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">&quot;user?method=toLoginPage&quot;</span><span class="token punctuation">;</span>

                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-5-登录检查购物车显示数量问题" tabindex="-1"><a class="header-anchor" href="#_1-5-登录检查购物车显示数量问题" aria-hidden="true">#</a> 1.5.登录检查购物车显示数量问题</h3><img src="https://photo.sneoo.com/spring5/202207051131873.png" alt="image-20211202205632021" style="zoom:80%;"><img src="https://photo.sneoo.com/spring5/202207051131874.png" alt="image-20211202210358590" style="zoom:80%;"><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>修改index<span class="token punctuation">.</span><span class="token function">html中的getTotalCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span>函数
<span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">==</span>
    
  <span class="token comment">/*
    获取添加购物车的总商品数量
  */</span>
  <span class="token function">getTotalCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token comment">//服务器发送请求,获取购物车中的商品数量</span>
      <span class="token function">axios</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          <span class="token literal-property property">method</span><span class="token operator">:</span><span class="token string">&quot;post&quot;</span><span class="token punctuation">,</span> <span class="token comment">//请求方式</span>
          <span class="token literal-property property">url</span><span class="token operator">:</span><span class="token string">&quot;protected/cart&quot;</span><span class="token punctuation">,</span>    <span class="token comment">//请求路径</span>
          <span class="token literal-property property">params</span><span class="token operator">:</span><span class="token punctuation">{</span>   <span class="token comment">//请求参数</span>
              <span class="token string-property property">&quot;method&quot;</span><span class="token operator">:</span><span class="token string">&quot;getTotalCount&quot;</span> <span class="token comment">//调用获取商品总数量的方法</span>
          <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>message<span class="token operator">==</span><span class="token string">&quot;unlogin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
              <span class="token keyword">this</span><span class="token punctuation">.</span>count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
              <span class="token comment">//console.log(response.data);</span>
              <span class="token comment">//服务器响应回来的购买数量,展示在页面中</span>
              <span class="token keyword">this</span><span class="token punctuation">.</span>count <span class="token operator">=</span> response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>resultData
          <span class="token punctuation">}</span>

      <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_2-订单功能-提交订单结账-准备工作" tabindex="-1"><a class="header-anchor" href="#_2-订单功能-提交订单结账-准备工作" aria-hidden="true">#</a> 2.订单功能_提交订单结账(准备工作)</h2><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>表关系回顾<span class="token operator">:</span>

  一对一   <span class="token operator">-&gt;</span> 两张表怎么看都是一对一
  一对多   <span class="token operator">-&gt;</span> 比如<span class="token operator">:</span>商品分类表  商品信息表
             从分类表往信息表看<span class="token operator">-&gt;</span> 一个分类包含了多个商品 <span class="token operator">-&gt;</span> 一对多
             从信息表往分类表看<span class="token operator">-&gt;</span> 多个商品会属于同一个分类 <span class="token operator">-&gt;</span> 多对一
              
             分清楚<span class="token operator">:</span>谁是主表<span class="token punctuation">(</span>分类表<span class="token punctuation">)</span><span class="token punctuation">,</span>谁是从表<span class="token punctuation">(</span>商品表<span class="token punctuation">)</span>
                 
            怎么将两个表连接起来<span class="token operator">-&gt;</span>建立外键约束<span class="token punctuation">,</span>从从表中设置外键<span class="token punctuation">,</span>外键其实保存的是主表的主键
                 
  多对多  <span class="token operator">-&gt;</span> 比如<span class="token operator">:</span> 角色表和演员表
      
            正着看<span class="token punctuation">,</span>反着看都是一对多
      
            需要中间表<span class="token operator">:</span>保存的是两个表的主键
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-1-创建订单表" tabindex="-1"><a class="header-anchor" href="#_2-1-创建订单表" aria-hidden="true">#</a> 2.1.创建订单表</h3><div class="language-mysql ext-mysql line-numbers-mode"><pre class="language-mysql"><code>#订单表
CREATE TABLE t_order(
	order_id INT PRIMARY KEY AUTO_INCREMENT,
	order_sequence VARCHAR(200),
	create_time VARCHAR(100),  
	total_count INT,
	total_amount DOUBLE,  
	order_status INT,
	user_id INT
);

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><table><thead><tr><th>字段名</th><th>字段作用</th></tr></thead><tbody><tr><td>order_id</td><td>主键</td></tr><tr><td>order_sequence</td><td>订单号</td></tr><tr><td>create_time</td><td>订单创建时间 -&gt;使用Date,将Date按照指定的格式转成String存进来</td></tr><tr><td>total_count</td><td>订单中商品的总数量-&gt;购物车中的总数量</td></tr><tr><td>total_amount</td><td>订单的总金额 -&gt; 购物车中的总金额</td></tr><tr><td>order_status</td><td>订单的状态 -&gt;表示的是未付款,已付款等状态</td></tr><tr><td>user_id</td><td>下单的用户的id-&gt;获取User对象,获取User对象中的userid,为此列赋值</td></tr></tbody></table><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token number">1.</span>虽然order_sequence也是一个不重复的数值，但是不使用它作为主键。数据库表的主键要使用没有业务功能的字段来担任。
<span class="token number">2.</span>订单的状态
  a<span class="token punctuation">.</span>待支付（书城项目中暂不考虑）
  b<span class="token punctuation">.</span>已支付，待发货：<span class="token number">0</span>
  c<span class="token punctuation">.</span>已发货：<span class="token number">1</span>
  d<span class="token punctuation">.</span>确认收货：<span class="token number">2</span>
  e<span class="token punctuation">.</span>发起退款或退货（书城项目中暂不考虑）
<span class="token number">3.</span>user_id
  a<span class="token punctuation">.</span>从逻辑和表结构的角度来说，这其实是一个外键。
  b<span class="token punctuation">.</span>但是开发过程中建议先不要加外键约束：因为开发过程中数据尚不完整，加了外键约束开发过程中使用测试数据非常不方便，建议项目预发布时添加外键约束测试。
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-2-创建订单项表" tabindex="-1"><a class="header-anchor" href="#_2-2-创建订单项表" aria-hidden="true">#</a> 2.2.创建订单项表</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>订单项中的内容<span class="token punctuation">,</span>就是购物项中的内容
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-mysql ext-mysql line-numbers-mode"><pre class="language-mysql"><code>CREATE TABLE t_order_item(
	item_id INT PRIMARY KEY AUTO_INCREMENT,
	book_name VARCHAR(20),
	price DOUBLE,
	img_path VARCHAR(50),
	item_count INT,
	item_amount DOUBLE,
	order_id VARCHAR(20)
);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><table><thead><tr><th>字段名称</th><th>字段作用</th></tr></thead><tbody><tr><td>item_id</td><td>主键</td></tr><tr><td>book_name</td><td>书名-&gt;获取购物项中的name,为此列赋值</td></tr><tr><td>price</td><td>单价-&gt;获取购物项中的price,为此列赋值</td></tr><tr><td>img_path</td><td>图片路径-&gt;获取购物项中的imgPath,为此列赋值</td></tr><tr><td>item_count</td><td>当前订单项的数量 -&gt; -&gt;获取购物项中的count,为此列赋值</td></tr><tr><td>item_amount</td><td>当前订单项的金额-&gt;-&gt;获取购物项中的amount,为此列赋值</td></tr><tr><td>order_id</td><td>当前订单项关联的订单表的主键(外键)</td></tr></tbody></table><h3 id="_2-3-创建order订单javabean" tabindex="-1"><a class="header-anchor" href="#_2-3-创建order订单javabean" aria-hidden="true">#</a> 2.3.创建Order订单javabean</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Order</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> orderId<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> orderSequence<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> createTime<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> totalCount<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Double</span> totalAmount<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> orderStatus<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> userId<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-4-创建orderitem订单项javabean" tabindex="-1"><a class="header-anchor" href="#_2-4-创建orderitem订单项javabean" aria-hidden="true">#</a> 2.4.创建OrderItem订单项javabean</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderItem</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> itemId<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> bookName<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Double</span> price<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> imgPath<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> itemCount<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Double</span> itemAmount<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> orderId<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-订单功能-提交订单结账" tabindex="-1"><a class="header-anchor" href="#_3-订单功能-提交订单结账" aria-hidden="true">#</a> 3.订单功能_提交订单结账</h2><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token number">1.</span>创建
    <span class="token class-name">OrderServlet</span>  
    <span class="token class-name">OrderService</span> <span class="token class-name">OrderServiceImpl</span>   
    <span class="token class-name">OrderDao</span>  <span class="token class-name">OrderDaoImpl</span>      
    <span class="token class-name">OrderItemDao</span>   <span class="token class-name">OrderItemDaoImpl</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://photo.sneoo.com/spring5/202207051131875.png" alt="1656035183729"></p><p><img src="https://photo.sneoo.com/spring5/202207051131876.png" alt="1656036008794"></p><h3 id="_3-1-修改cart-html" tabindex="-1"><a class="header-anchor" href="#_3-1-修改cart-html" aria-hidden="true">#</a> 3.1.修改cart.html</h3><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code>修改&quot;去结账&quot;的请求地址
================================
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>pay<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>protected/order?method=checkout<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>去结账<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-2-orderservlet实现" tabindex="-1"><a class="header-anchor" href="#_3-2-orderservlet实现" aria-hidden="true">#</a> 3.2.OrderServlet实现</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>修改<span class="token class-name">LoginFilter</span>比较<span class="token operator">-&gt;</span>因为结账功能也是同步
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
 <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;toCartPage&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token operator">||</span><span class="token string">&quot;checkout&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span><span class="token string">&quot;/protected/order&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderServlet</span> <span class="token keyword">extends</span> <span class="token class-name">BaseServlet</span> <span class="token punctuation">{</span>
    <span class="token class-name">OrderService</span> orderService <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderServiceImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * 订单结算功能
     *
     * <span class="token keyword">@param</span> <span class="token parameter">request</span>
     * <span class="token keyword">@param</span> <span class="token parameter">response</span>
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">checkout</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token comment">/*
          由于订单中的数据都是从购物车中来的
          所以我们需要获取出Cart对象
          
          又因为订单需要用户的支持,所以需要User对象
        */</span>
        
        <span class="token comment">//1.从session中获取购物车对象</span>
        <span class="token class-name">HttpSession</span> session <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Cart</span> cart <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Cart</span><span class="token punctuation">)</span> session<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;cart&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//2.从session获取用户信息</span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">)</span> session<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//3.调用service层的方法,进行订单结算,并且获取订单的序列号</span>
        <span class="token class-name">String</span> orderSequence <span class="token operator">=</span> orderService<span class="token punctuation">.</span><span class="token function">checkout</span><span class="token punctuation">(</span>cart<span class="token punctuation">,</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//5.将订单序列号存储到域中,跳转checkout.html页面</span>
        request<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;orderSequence&quot;</span><span class="token punctuation">,</span>orderSequence<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">processTemplate</span><span class="token punctuation">(</span><span class="token string">&quot;cart/checkout.html&quot;</span><span class="token punctuation">,</span>request<span class="token punctuation">,</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-3-orderservice实现" tabindex="-1"><a class="header-anchor" href="#_3-3-orderservice实现" aria-hidden="true">#</a> 3.3.OrderService实现</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">OrderService</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> <span class="token function">checkout</span><span class="token punctuation">(</span><span class="token class-name">Cart</span> cart<span class="token punctuation">,</span> <span class="token class-name">User</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">OrderService</span> <span class="token punctuation">{</span>
    <span class="token class-name">OrderDao</span> orderDao <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderDaoImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">checkout</span><span class="token punctuation">(</span><span class="token class-name">Cart</span> cart<span class="token punctuation">,</span> <span class="token class-name">User</span> user<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{</span>
        <span class="token comment">//1.创建订单对象</span>
        <span class="token class-name">Order</span> order <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Order</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//2.生成一个唯一的订单号(使用UUID)</span>
        <span class="token class-name">String</span> orderSequence <span class="token operator">=</span> UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//3.将生成的订单号封装到Order对象中</span>
        order<span class="token punctuation">.</span><span class="token function">setOrderSequence</span><span class="token punctuation">(</span>orderSequence<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//4.创建下单的时间,封装到Order对象中-&gt;当前时间</span>
        <span class="token class-name">SimpleDateFormat</span> sdf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> createTime <span class="token operator">=</span> sdf<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        order<span class="token punctuation">.</span><span class="token function">setCreateTime</span><span class="token punctuation">(</span>createTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//5.设置Order的购买数量,来自于购物车</span>
        order<span class="token punctuation">.</span><span class="token function">setTotalCount</span><span class="token punctuation">(</span>cart<span class="token punctuation">.</span><span class="token function">getTotalCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//6.设置Order的总金额,来自于购物车</span>
        order<span class="token punctuation">.</span><span class="token function">setTotalAmount</span><span class="token punctuation">(</span>cart<span class="token punctuation">.</span><span class="token function">getTotalAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">/*
          7.设置Order的订单状态 -&gt; 已支付,待发货:0

            注意:将来如果写状态码直接写0,不好
                如果将来项目经理或者产品说了:0不代表已支付,待发货了,咱们还得改这个0
                所以,状态码不应该写死

            解决:创建一个类,在里面创建状态码,到时候如果整数代表的状态改了,我们直接在此类中
                 改
                 此处的代码不用改了
         */</span>
         order<span class="token punctuation">.</span><span class="token function">setOrderStatus</span><span class="token punctuation">(</span><span class="token class-name">OrderStatusCode</span><span class="token punctuation">.</span>YIZHIFU<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token comment">//8.设置Order的用户主键</span>
        order<span class="token punctuation">.</span><span class="token function">setUserId</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getUserid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//9.调用dao成的insertOrder方法,传递Order对象</span>
        orderDao<span class="token punctuation">.</span><span class="token function">insertOrder</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> orderSequence<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>在utils包中创建<span class="token class-name">OrderStatusCode</span>类<span class="token operator">:</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderStatusCode</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token keyword">int</span> YIZHIFU <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token keyword">int</span> YIFAHUO <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token keyword">int</span> YISHOUHUO <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-4-orderdao实现" tabindex="-1"><a class="header-anchor" href="#_3-4-orderdao实现" aria-hidden="true">#</a> 3.4.OrderDao实现</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">OrderDao</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">insertOrder</span><span class="token punctuation">(</span><span class="token class-name">Order</span> order<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderDaoImpl</span> <span class="token keyword">implements</span> <span class="token class-name">OrderDao</span> <span class="token punctuation">{</span>
    <span class="token class-name">QueryRunner</span> qr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryRunner</span><span class="token punctuation">(</span><span class="token class-name">DruidUtils</span><span class="token punctuation">.</span><span class="token function">getDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * 添加订单方法
     * <span class="token keyword">@param</span> <span class="token parameter">order</span>
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">insertOrder</span><span class="token punctuation">(</span><span class="token class-name">Order</span> order<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">&quot;insert into t_order values (?,?,?,?,?,?,?)&quot;</span><span class="token punctuation">;</span>
        qr<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> order<span class="token punctuation">.</span><span class="token function">getOrderId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> order<span class="token punctuation">.</span><span class="token function">getOrderSequence</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> order<span class="token punctuation">.</span><span class="token function">getCreateTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> order<span class="token punctuation">.</span><span class="token function">getTotalCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                order<span class="token punctuation">.</span><span class="token function">getTotalAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> order<span class="token punctuation">.</span><span class="token function">getOrderStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> order<span class="token punctuation">.</span><span class="token function">getUserId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-订单功能-存储订单项" tabindex="-1"><a class="header-anchor" href="#_4-订单功能-存储订单项" aria-hidden="true">#</a> 4.订单功能_存储订单项</h2><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>订单项的内容是购物车购物项决定的
 
所以我们在提交订单之后<span class="token punctuation">,</span>马上就要从购物项中获取参数保存到订单项的对象中<span class="token punctuation">,</span>然后将订单项对象存入到数据库中
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-1-修改orderservice实现" tabindex="-1"><a class="header-anchor" href="#_4-1-修改orderservice实现" aria-hidden="true">#</a> 4.1.修改OrderService实现</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">OrderService</span> <span class="token punctuation">{</span>
    <span class="token class-name">OrderDao</span> orderDao <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderDaoImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">OrderItemDao</span> orderItemDao <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderItemDaoImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">checkout</span><span class="token punctuation">(</span><span class="token class-name">Cart</span> cart<span class="token punctuation">,</span> <span class="token class-name">User</span> user<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{</span>
        <span class="token comment">//1.创建订单对象</span>
        <span class="token class-name">Order</span> order <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Order</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//2.生成一个唯一的订单号(使用UUID)</span>
        <span class="token class-name">String</span> orderSequence <span class="token operator">=</span> UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//3.将生成的订单号封装到Order对象中</span>
        order<span class="token punctuation">.</span><span class="token function">setOrderSequence</span><span class="token punctuation">(</span>orderSequence<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//4.创建下单的时间,封装到Order对象中-&gt;当前时间</span>
        <span class="token class-name">SimpleDateFormat</span> sdf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> createTime <span class="token operator">=</span> sdf<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        order<span class="token punctuation">.</span><span class="token function">setCreateTime</span><span class="token punctuation">(</span>createTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//5.设置Order的购买数量,来自于购物车</span>
        order<span class="token punctuation">.</span><span class="token function">setTotalCount</span><span class="token punctuation">(</span>cart<span class="token punctuation">.</span><span class="token function">getTotalCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//6.设置Order的总金额,来自于购物车</span>
        order<span class="token punctuation">.</span><span class="token function">setTotalAmount</span><span class="token punctuation">(</span>cart<span class="token punctuation">.</span><span class="token function">getTotalAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">/*
          7.设置Order的订单状态 -&gt; 已支付,待发货:0

            注意:将来如果写状态码直接写0,不好
                如果将来项目经理或者产品说了:0不代表已支付,待发货了,咱们还得改这个0
                所以,状态码不应该写死

            解决:创建一个类,在里面创建状态码,到时候如果整数代表的状态改了,我们直接在此类中
                 改
                 此处的代码不用改了
         */</span>
         order<span class="token punctuation">.</span><span class="token function">setOrderStatus</span><span class="token punctuation">(</span><span class="token class-name">OrderStatusCode</span><span class="token punctuation">.</span>YIZHIFU<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token comment">//8.设置Order的用户主键</span>
        order<span class="token punctuation">.</span><span class="token function">setUserId</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getUserid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//9.调用dao成的insertOrder方法,传递Order对象</span>
        <span class="token class-name">Integer</span> key <span class="token operator">=</span> orderDao<span class="token punctuation">.</span><span class="token function">insertOrder</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;=================以下是订单项的代码================&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">/*
          10.由于订单项中的内容取决于购物车中购物项的内容
             所以需要先获取购物车中购物项的数据
             而且有几个购物项就应该有几个订单项
         */</span>
        <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CartItem</span><span class="token punctuation">&gt;</span></span> cartItemCollection <span class="token operator">=</span> cart<span class="token punctuation">.</span><span class="token function">getCartItemMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//有几个购物项,就应该有几个订单项</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">CartItem</span> cartItem <span class="token operator">:</span> cartItemCollection<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//创建订单项对象</span>
            <span class="token class-name">OrderItem</span> orderItem <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderItem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//设置订单项OrderItem中的属性值,属性值从购物项中取,然后放到OrderItem中</span>

            <span class="token comment">//设置orderItem对象的参数：书名</span>
            orderItem<span class="token punctuation">.</span><span class="token function">setBookName</span><span class="token punctuation">(</span> cartItem<span class="token punctuation">.</span><span class="token function">getBookName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//设置orderItem对象的参数：单价</span>
            orderItem<span class="token punctuation">.</span><span class="token function">setPrice</span><span class="token punctuation">(</span> cartItem<span class="token punctuation">.</span><span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//设置orderItem对象的参数：图片路径</span>
            orderItem<span class="token punctuation">.</span><span class="token function">setImgPath</span><span class="token punctuation">(</span> cartItem<span class="token punctuation">.</span><span class="token function">getImgPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//设置orderItem对象的参数：购买数量</span>
            orderItem<span class="token punctuation">.</span><span class="token function">setItemCount</span><span class="token punctuation">(</span> cartItem<span class="token punctuation">.</span><span class="token function">getCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//设置orderItem对象的参数：小计金额</span>
            orderItem<span class="token punctuation">.</span><span class="token function">setItemAmount</span><span class="token punctuation">(</span> cartItem<span class="token punctuation">.</span><span class="token function">getAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">/*
              orderItem中的order_id外键怎么保存?
              获取最后一次新增的订单id
              新提交了那个订单,直接把这个订单的id获取出来放到订单项的外键中
             */</span>
            <span class="token comment">//设置orderItem对象的参数：订单的外键 (订单数据表的主键)</span>
            orderItem<span class="token punctuation">.</span><span class="token function">setOrderId</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//调用OrderItemDao中的添加订单项的方法</span>
            orderItemDao<span class="token punctuation">.</span><span class="token function">insertOrderItem</span><span class="token punctuation">(</span>orderItem<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> orderSequence<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> category<span class="token punctuation">(</span>
  cid <span class="token keyword">INT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
  cname <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> category <span class="token punctuation">(</span>cname<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">&#39;服装&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> LAST_INSERT_ID<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">-- 查询最后一次插入的数据id</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-2-修改orderdao实现" tabindex="-1"><a class="header-anchor" href="#_4-2-修改orderdao实现" aria-hidden="true">#</a> 4.2.修改OrderDao实现</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code> <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">insertOrder</span><span class="token punctuation">(</span><span class="token class-name">Order</span> order<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">&quot;insert into t_order values (?,?,?,?,?,?,?)&quot;</span><span class="token punctuation">;</span>
        qr<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> order<span class="token punctuation">.</span><span class="token function">getOrderId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> order<span class="token punctuation">.</span><span class="token function">getOrderSequence</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> order<span class="token punctuation">.</span><span class="token function">getCreateTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> order<span class="token punctuation">.</span><span class="token function">getTotalCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                order<span class="token punctuation">.</span><span class="token function">getTotalAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> order<span class="token punctuation">.</span><span class="token function">getOrderStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> order<span class="token punctuation">.</span><span class="token function">getUserId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        

        <span class="token comment">//===============新添加的=============</span>
        <span class="token comment">//获取新增的主键</span>
        <span class="token class-name">String</span> sqlKey <span class="token operator">=</span> <span class="token string">&quot;select last_insert_id()&quot;</span><span class="token punctuation">;</span>
        <span class="token comment">/*
          执行select last_insert_id()需要转成BigInteger
          强转成BigInteger调用intValue()转成Integer
         */</span>
        <span class="token class-name">Integer</span> key <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">BigInteger</span><span class="token punctuation">)</span> qr<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>sqlKey<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ScalarHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">intValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> key<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-3-创建orderitemdao并实现" tabindex="-1"><a class="header-anchor" href="#_4-3-创建orderitemdao并实现" aria-hidden="true">#</a> 4.3.创建OrderItemDao并实现</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">OrderItemDao</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">insertOrderItem</span><span class="token punctuation">(</span><span class="token class-name">OrderItem</span> orderItem<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderItemDaoImpl</span> <span class="token keyword">implements</span> <span class="token class-name">OrderItemDao</span> <span class="token punctuation">{</span>
    <span class="token class-name">QueryRunner</span> qr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryRunner</span><span class="token punctuation">(</span><span class="token class-name">DruidUtils</span><span class="token punctuation">.</span><span class="token function">getDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">insertOrderItem</span><span class="token punctuation">(</span><span class="token class-name">OrderItem</span> orderItem<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{</span>
<span class="token comment">//写入中间表的SQL数据</span>
        <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">&quot;insert into t_order_item values(?,?,?,?,?,?,?)&quot;</span><span class="token punctuation">;</span>
        <span class="token comment">//对象数组，存储中间表问号占位符数据</span>
        <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> params <span class="token operator">=</span> <span class="token punctuation">{</span>orderItem<span class="token punctuation">.</span><span class="token function">getItemId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> orderItem<span class="token punctuation">.</span><span class="token function">getBookName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> orderItem<span class="token punctuation">.</span><span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                orderItem<span class="token punctuation">.</span><span class="token function">getImgPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> orderItem<span class="token punctuation">.</span><span class="token function">getItemCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> orderItem<span class="token punctuation">.</span><span class="token function">getItemAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> orderItem<span class="token punctuation">.</span><span class="token function">getOrderId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token comment">//执行SQL语句</span>
        qr<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> params<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-4-修改checkout-html显示域中的订单号" tabindex="-1"><a class="header-anchor" href="#_4-4-修改checkout-html显示域中的订单号" aria-hidden="true">#</a> 4.4.修改checkout.html显示域中的订单号</h3><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>main<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>你的订单已结算，订单号为:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>oid<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">th:</span>text</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span> <span class="token punctuation">&quot;</span>${orderSequence}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_5-订单功能-提交订单清空购物车" tabindex="-1"><a class="header-anchor" href="#_5-订单功能-提交订单清空购物车" aria-hidden="true">#</a> 5.订单功能_提交订单清空购物车</h2><h3 id="_5-1-修改orderservlet" tabindex="-1"><a class="header-anchor" href="#_5-1-修改orderservlet" aria-hidden="true">#</a> 5.1.修改OrderServlet</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code> cart<span class="token punctuation">.</span><span class="token function">getCartItemMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 cart<span class="token punctuation">.</span><span class="token function">setTotalAmount</span><span class="token punctuation">(</span><span class="token number">0d</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="第二章-事务在书城中的操作" tabindex="-1"><a class="header-anchor" href="#第二章-事务在书城中的操作" aria-hidden="true">#</a> 第二章.事务在书城中的操作</h1><h2 id="_1-未加事务时出现的bug" tabindex="-1"><a class="header-anchor" href="#_1-未加事务时出现的bug" aria-hidden="true">#</a> 1.未加事务时出现的bug</h2><h3 id="_1-1-在orderserviceimpl中加异常代码" tabindex="-1"><a class="header-anchor" href="#_1-1-在orderserviceimpl中加异常代码" aria-hidden="true">#</a> 1.1.在OrderServiceImpl中加异常代码</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token number">1.</span>在添加订单下加上<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">/</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token number">2.</span>checkout方法由<span class="token keyword">throws</span>异常<span class="token punctuation">,</span>改成<span class="token keyword">try</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token keyword">catch</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">OrderService</span> <span class="token punctuation">{</span>
    <span class="token class-name">OrderDao</span> orderDao <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderDaoImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">OrderItemDao</span> orderItemDao <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderItemDaoImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">checkout</span><span class="token punctuation">(</span><span class="token class-name">Cart</span> cart<span class="token punctuation">,</span> <span class="token class-name">User</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> orderSequence <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span><span class="token punctuation">{</span>
            <span class="token comment">//1.创建订单对象</span>
            <span class="token class-name">Order</span> order <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Order</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//2.生成一个唯一的订单号(使用UUID)</span>
            orderSequence <span class="token operator">=</span> UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//3.将生成的订单号封装到Order对象中</span>
            order<span class="token punctuation">.</span><span class="token function">setOrderSequence</span><span class="token punctuation">(</span>orderSequence<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//4.创建下单的时间,封装到Order对象中-&gt;当前时间</span>
            <span class="token class-name">SimpleDateFormat</span> sdf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> createTime <span class="token operator">=</span> sdf<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            order<span class="token punctuation">.</span><span class="token function">setCreateTime</span><span class="token punctuation">(</span>createTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//5.设置Order的购买数量,来自于购物车</span>
            order<span class="token punctuation">.</span><span class="token function">setTotalCount</span><span class="token punctuation">(</span>cart<span class="token punctuation">.</span><span class="token function">getTotalCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//6.设置Order的总金额,来自于购物车</span>
            order<span class="token punctuation">.</span><span class="token function">setTotalAmount</span><span class="token punctuation">(</span>cart<span class="token punctuation">.</span><span class="token function">getTotalAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">/*
          7.设置Order的订单状态 -&gt; 已支付,待发货:0

            注意:将来如果写状态码直接写0,不好
                如果将来项目经理或者产品说了:0不代表已支付,待发货了,咱们还得改这个0
                所以,状态码不应该写死

            解决:创建一个类,在里面创建状态码,到时候如果整数代表的状态改了,我们直接在此类中
                 改
                 此处的代码不用改了
         */</span>
            order<span class="token punctuation">.</span><span class="token function">setOrderStatus</span><span class="token punctuation">(</span><span class="token class-name">OrderStatusCode</span><span class="token punctuation">.</span>YIZHIFU<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//8.设置Order的用户主键</span>
            order<span class="token punctuation">.</span><span class="token function">setUserId</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getUserid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//9.调用dao成的insertOrder方法,传递Order对象</span>
            <span class="token class-name">Integer</span> key <span class="token operator">=</span> orderDao<span class="token punctuation">.</span><span class="token function">insertOrder</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">;</span>
            
              <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">/</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;=================以下是订单项的代码================&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">/*
          10.由于订单项中的内容取决于购物车中购物项的内容
             所以需要先获取购物车中购物项的数据
         */</span>
            <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CartItem</span><span class="token punctuation">&gt;</span></span> cartItemCollection <span class="token operator">=</span> cart<span class="token punctuation">.</span><span class="token function">getCartItemMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//有几个购物项,就应该有几个订单项</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">CartItem</span> cartItem <span class="token operator">:</span> cartItemCollection<span class="token punctuation">)</span> <span class="token punctuation">{</span>

          

                <span class="token comment">//创建订单项对象</span>
                <span class="token class-name">OrderItem</span> orderItem <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderItem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//设置订单项OrderItem中的属性值,属性值从购物项中取,然后放到OrderItem中</span>

                <span class="token comment">//设置orderItem对象的参数：书名</span>
                orderItem<span class="token punctuation">.</span><span class="token function">setBookName</span><span class="token punctuation">(</span> cartItem<span class="token punctuation">.</span><span class="token function">getBookName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//设置orderItem对象的参数：单价</span>
                orderItem<span class="token punctuation">.</span><span class="token function">setPrice</span><span class="token punctuation">(</span> cartItem<span class="token punctuation">.</span><span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//设置orderItem对象的参数：图片路径</span>
                orderItem<span class="token punctuation">.</span><span class="token function">setImgPath</span><span class="token punctuation">(</span> cartItem<span class="token punctuation">.</span><span class="token function">getImgPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//设置orderItem对象的参数：购买数量</span>
                orderItem<span class="token punctuation">.</span><span class="token function">setItemCount</span><span class="token punctuation">(</span> cartItem<span class="token punctuation">.</span><span class="token function">getCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//设置orderItem对象的参数：小计金额</span>
                orderItem<span class="token punctuation">.</span><span class="token function">setItemAmount</span><span class="token punctuation">(</span> cartItem<span class="token punctuation">.</span><span class="token function">getAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">/*
              orderItem中的order_id外键怎么保存?
              获取最后一次新增的订单id
             */</span>
                <span class="token comment">//设置orderItem对象的参数：订单的外键 (订单数据表的主键)</span>
                orderItem<span class="token punctuation">.</span><span class="token function">setOrderId</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">//调用OrderItemDao中的添加订单项的方法</span>
                orderItemDao<span class="token punctuation">.</span><span class="token function">insertOrderItem</span><span class="token punctuation">(</span>orderItem<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> orderSequence<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>问题<span class="token operator">:</span>
由于我们<span class="token keyword">catch</span>的是<span class="token class-name">Exception</span><span class="token punctuation">,</span>啥异常都能抓<span class="token punctuation">,</span>抓到后面的代码正常执行
所以发现我们的订单提交了<span class="token punctuation">,</span>但是看数据中t_order表中有订单数据<span class="token punctuation">,</span>但是t_order_item表中没有订单项数据
    
出现数据不安全的问题了
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><img src="https://photo.sneoo.com/spring5/202207051131877.png" alt="image-20211201225314487" style="zoom:80%;"><blockquote><p>以上添加订单和添加订单项其实是一组操作,这一组操作要么全成功,要么就全失败,可以用事务控制</p></blockquote><h2 id="_2-事务的引入" tabindex="-1"><a class="header-anchor" href="#_2-事务的引入" aria-hidden="true">#</a> 2.事务的引入</h2><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token number">1.</span>概述<span class="token operator">:</span>一种管理一组操作<span class="token punctuation">(</span>多条sql<span class="token punctuation">)</span>的技术
<span class="token number">2.</span>作用<span class="token operator">:</span>管理一组操作<span class="token punctuation">,</span>使其要么全成功<span class="token punctuation">,</span>要么全失败
<span class="token number">3.</span>注意<span class="token operator">:</span>
  mysql自带事务管理的<span class="token punctuation">,</span>但是一次只能管理一条sql<span class="token punctuation">,</span>所以我们应该手动管理事务
<span class="token number">4.</span>mysql中的事务操作<span class="token operator">:</span>
  begin  事务开启
  commit 事务提交  <span class="token operator">-&gt;</span> 当事务提交之后<span class="token punctuation">,</span>数据将永久保存
  rollback 事务回滚 <span class="token operator">-&gt;</span> 将数据返回到上次的状态
<span class="token number">5.</span>如何利用java代码操作事务<span class="token operator">-&gt;</span><span class="token class-name">Connection</span>对象
  a<span class="token punctuation">.</span><span class="token function">setAutoCommit</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> 关闭mysql自带事务<span class="token punctuation">,</span>开启手动事务
  b<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span>提交事务<span class="token punctuation">,</span>数据将永久保存
  c<span class="token punctuation">.</span><span class="token function">rollback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span>回滚事务<span class="token punctuation">,</span>数据还原
      
<span class="token number">6.</span>注意<span class="token operator">:</span>
  如果想让事务操作一组数据生效<span class="token punctuation">,</span>需要用到的是同一个<span class="token class-name">Connection</span>对象
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> account<span class="token punctuation">(</span>
   <span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
   money <span class="token keyword">INT</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- 开启事务</span>
<span class="token keyword">BEGIN</span><span class="token punctuation">;</span>

<span class="token keyword">UPDATE</span> account <span class="token keyword">SET</span> money <span class="token operator">=</span> money<span class="token operator">-</span><span class="token number">1000</span> <span class="token keyword">WHERE</span> <span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span><span class="token operator">=</span><span class="token string">&#39;涛哥&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">UPDATE</span> account <span class="token keyword">SET</span> money <span class="token operator">=</span> money<span class="token operator">+</span><span class="token number">1000</span> <span class="token keyword">WHERE</span> <span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span><span class="token operator">=</span><span class="token string">&#39;柳岩&#39;</span><span class="token punctuation">;</span>


<span class="token comment">-- 提交事务</span>
<span class="token keyword">COMMIT</span><span class="token punctuation">;</span>
<span class="token comment">-- 回滚事务</span>
<span class="token keyword">ROLLBACK</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>由<span class="token class-name">OrderServletImpl</span>中的代码我们发现<span class="token operator">:</span>
 <span class="token number">1.</span>将订单放到订单表中调用了<span class="token function">insertOrder</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span>方法
 <span class="token number">2.</span>将订单项放到订单项表中调用了<span class="token function">insertOrderItem</span><span class="token punctuation">(</span>orderItem<span class="token punctuation">)</span>方法
     
这就会执行<span class="token number">2</span>条sql语句<span class="token punctuation">,</span>而每条sql语句执行前都在对应的dao中创建了<span class="token class-name">QueryRunner</span>对象<span class="token punctuation">,</span>而<span class="token class-name">Connection</span>对象都是从连接池<span class="token punctuation">(</span><span class="token class-name">DataSource</span><span class="token punctuation">)</span>中获取的
     
就会出现<span class="token number">2</span>条sql使用<span class="token number">2</span>个<span class="token class-name">Connection</span>连接对象
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-使用事务改造订单相关类" tabindex="-1"><a class="header-anchor" href="#_3-使用事务改造订单相关类" aria-hidden="true">#</a> 3.使用事务改造订单相关类</h2><h3 id="_3-1-使用事务改造orderserviceimpl" tabindex="-1"><a class="header-anchor" href="#_3-1-使用事务改造orderserviceimpl" aria-hidden="true">#</a> 3.1.使用事务改造OrderServiceImpl</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">OrderService</span> <span class="token punctuation">{</span>
    <span class="token class-name">OrderDao</span> orderDao <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderDaoImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">OrderItemDao</span> orderItemDao <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderItemDaoImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">checkout</span><span class="token punctuation">(</span><span class="token class-name">Cart</span> cart<span class="token punctuation">,</span> <span class="token class-name">User</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//从连接池中获取连接</span>
        <span class="token class-name">Connection</span> connection <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> orderSequence <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            connection <span class="token operator">=</span> <span class="token class-name">DruidUtils</span><span class="token punctuation">.</span><span class="token function">getDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//开启事务</span>
            connection<span class="token punctuation">.</span><span class="token function">setAutoCommit</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//1.创建订单对象</span>
            <span class="token class-name">Order</span> order <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Order</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//2.生成一个唯一的订单号(使用UUID)</span>
            orderSequence <span class="token operator">=</span> UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//3.将生成的订单号封装到Order对象中</span>
            order<span class="token punctuation">.</span><span class="token function">setOrderSequence</span><span class="token punctuation">(</span>orderSequence<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//4.创建下单的时间,封装到Order对象中-&gt;当前时间</span>
            <span class="token class-name">SimpleDateFormat</span> sdf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> createTime <span class="token operator">=</span> sdf<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            order<span class="token punctuation">.</span><span class="token function">setCreateTime</span><span class="token punctuation">(</span>createTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//5.设置Order的购买数量,来自于购物车</span>
            order<span class="token punctuation">.</span><span class="token function">setTotalCount</span><span class="token punctuation">(</span>cart<span class="token punctuation">.</span><span class="token function">getTotalCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//6.设置Order的总金额,来自于购物车</span>
            order<span class="token punctuation">.</span><span class="token function">setTotalAmount</span><span class="token punctuation">(</span>cart<span class="token punctuation">.</span><span class="token function">getTotalAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">/*
          7.设置Order的订单状态 -&gt; 已支付,待发货:0

            注意:将来如果写状态码直接写0,不好
                如果将来项目经理或者产品说了:0不代表已支付,待发货了,咱们还得改这个0
                所以,状态码不应该写死

            解决:创建一个类,在里面创建状态码,到时候如果整数代表的状态改了,我们直接在此类中
                 改
                 此处的代码不用改了
         */</span>
            order<span class="token punctuation">.</span><span class="token function">setOrderStatus</span><span class="token punctuation">(</span><span class="token class-name">OrderStatusCode</span><span class="token punctuation">.</span>YIZHIFU<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//8.设置Order的用户主键</span>
            order<span class="token punctuation">.</span><span class="token function">setUserId</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getUserid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//9.调用dao成的insertOrder方法,传递Order对象</span>
            <span class="token class-name">Integer</span> key <span class="token operator">=</span> orderDao<span class="token punctuation">.</span><span class="token function">insertOrder</span><span class="token punctuation">(</span>connection<span class="token punctuation">,</span>order<span class="token punctuation">)</span><span class="token punctuation">;</span>
            
             <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">/</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;=================以下是订单项的代码================&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">/*
          10.由于订单项中的内容取决于购物车中购物项的内容
             所以需要先获取购物车中购物项的数据
         */</span>
            <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CartItem</span><span class="token punctuation">&gt;</span></span> cartItemCollection <span class="token operator">=</span> cart<span class="token punctuation">.</span><span class="token function">getCartItemMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//有几个购物项,就应该有几个订单项</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">CartItem</span> cartItem <span class="token operator">:</span> cartItemCollection<span class="token punctuation">)</span> <span class="token punctuation">{</span>

                <span class="token comment">//创建订单项对象</span>
                <span class="token class-name">OrderItem</span> orderItem <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderItem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//设置订单项OrderItem中的属性值,属性值从购物项中取,然后放到OrderItem中</span>

                <span class="token comment">//设置orderItem对象的参数：书名</span>
                orderItem<span class="token punctuation">.</span><span class="token function">setBookName</span><span class="token punctuation">(</span>cartItem<span class="token punctuation">.</span><span class="token function">getBookName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//设置orderItem对象的参数：单价</span>
                orderItem<span class="token punctuation">.</span><span class="token function">setPrice</span><span class="token punctuation">(</span>cartItem<span class="token punctuation">.</span><span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//设置orderItem对象的参数：图片路径</span>
                orderItem<span class="token punctuation">.</span><span class="token function">setImgPath</span><span class="token punctuation">(</span>cartItem<span class="token punctuation">.</span><span class="token function">getImgPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//设置orderItem对象的参数：购买数量</span>
                orderItem<span class="token punctuation">.</span><span class="token function">setItemCount</span><span class="token punctuation">(</span>cartItem<span class="token punctuation">.</span><span class="token function">getCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//设置orderItem对象的参数：小计金额</span>
                orderItem<span class="token punctuation">.</span><span class="token function">setItemAmount</span><span class="token punctuation">(</span>cartItem<span class="token punctuation">.</span><span class="token function">getAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">/*
              orderItem中的order_id外键怎么保存?
              获取最后一次新增的订单id
             */</span>
                <span class="token comment">//设置orderItem对象的参数：订单的外键 (订单数据表的主键)</span>
                orderItem<span class="token punctuation">.</span><span class="token function">setOrderId</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">//调用OrderItemDao中的添加订单项的方法</span>
                orderItemDao<span class="token punctuation">.</span><span class="token function">insertOrderItem</span><span class="token punctuation">(</span>connection<span class="token punctuation">,</span>orderItem<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token punctuation">}</span>
            <span class="token comment">//提交事务</span>
                connection<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//事务回滚</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                connection<span class="token punctuation">.</span><span class="token function">rollback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                ex<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                connection<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> orderSequence<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-2-使用事务改造orderdao" tabindex="-1"><a class="header-anchor" href="#_3-2-使用事务改造orderdao" aria-hidden="true">#</a> 3.2.使用事务改造OrderDao</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">OrderDao</span> <span class="token punctuation">{</span>
    <span class="token class-name">Integer</span> <span class="token function">insertOrder</span><span class="token punctuation">(</span><span class="token class-name">Connection</span> connection<span class="token punctuation">,</span> <span class="token class-name">Order</span> order<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderDaoImpl</span> <span class="token keyword">implements</span> <span class="token class-name">OrderDao</span> <span class="token punctuation">{</span>
   <span class="token class-name">QueryRunner</span> qr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryRunner</span><span class="token punctuation">(</span><span class="token class-name">DruidUtils</span><span class="token punctuation">.</span><span class="token function">getDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * 添加订单方法
     * <span class="token keyword">@param</span> <span class="token parameter">order</span>
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">insertOrder</span><span class="token punctuation">(</span><span class="token class-name">Connection</span> connection<span class="token punctuation">,</span><span class="token class-name">Order</span> order<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">&quot;insert into t_order values (?,?,?,?,?,?,?)&quot;</span><span class="token punctuation">;</span>
        qr<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>connection<span class="token punctuation">,</span>sql<span class="token punctuation">,</span> order<span class="token punctuation">.</span><span class="token function">getOrderId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> order<span class="token punctuation">.</span><span class="token function">getOrderSequence</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> order<span class="token punctuation">.</span><span class="token function">getCreateTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> order<span class="token punctuation">.</span><span class="token function">getTotalCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                order<span class="token punctuation">.</span><span class="token function">getTotalAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> order<span class="token punctuation">.</span><span class="token function">getOrderStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> order<span class="token punctuation">.</span><span class="token function">getUserId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//获取新增的主键</span>
        <span class="token class-name">String</span> sqlKey <span class="token operator">=</span> <span class="token string">&quot;select last_insert_id()&quot;</span><span class="token punctuation">;</span>
        <span class="token comment">/*
          执行select last_insert_id()需要转成BigInteger
          强转成BigInteger调用intValue()转成Integer
         */</span>
        <span class="token class-name">Integer</span> key <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">BigInteger</span><span class="token punctuation">)</span> qr<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>connection<span class="token punctuation">,</span>sqlKey<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ScalarHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">intValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> key<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-3-使用事务改造orderitemdao" tabindex="-1"><a class="header-anchor" href="#_3-3-使用事务改造orderitemdao" aria-hidden="true">#</a> 3.3.使用事务改造OrderItemDao</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">OrderItemDao</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">insertOrderItem</span><span class="token punctuation">(</span><span class="token class-name">Connection</span> connection<span class="token punctuation">,</span> <span class="token class-name">OrderItem</span> orderItem<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderItemDaoImpl</span> <span class="token keyword">implements</span> <span class="token class-name">OrderItemDao</span> <span class="token punctuation">{</span>
    <span class="token class-name">QueryRunner</span> qr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryRunner</span><span class="token punctuation">(</span><span class="token class-name">DruidUtils</span><span class="token punctuation">.</span><span class="token function">getDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">insertOrderItem</span><span class="token punctuation">(</span><span class="token class-name">Connection</span> connection<span class="token punctuation">,</span><span class="token class-name">OrderItem</span> orderItem<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{</span>
<span class="token comment">//写入中间表的SQL数据</span>
        <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">&quot;insert into t_order_item values(?,?,?,?,?,?,?)&quot;</span><span class="token punctuation">;</span>
        <span class="token comment">//对象数组，存储中间表问号占位符数据</span>
        <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> params <span class="token operator">=</span> <span class="token punctuation">{</span>orderItem<span class="token punctuation">.</span><span class="token function">getItemId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> orderItem<span class="token punctuation">.</span><span class="token function">getBookName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> orderItem<span class="token punctuation">.</span><span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                orderItem<span class="token punctuation">.</span><span class="token function">getImgPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> orderItem<span class="token punctuation">.</span><span class="token function">getItemCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> orderItem<span class="token punctuation">.</span><span class="token function">getItemAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> orderItem<span class="token punctuation">.</span><span class="token function">getOrderId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token comment">//执行SQL语句</span>
        qr<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>connection<span class="token punctuation">,</span>sql<span class="token punctuation">,</span> params<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>问题:</p><p>1.发现如果程序有问题了,事务控制之后,t_order和t_orderitem两个表中都没有数据了</p><p>2.但是订单号还是有,怎么解决?</p></blockquote><h3 id="_3-4-订单提交失败-处理方式" tabindex="-1"><a class="header-anchor" href="#_3-4-订单提交失败-处理方式" aria-hidden="true">#</a> 3.4.订单提交失败,处理方式</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token number">1.</span>修改<span class="token class-name">OrderServiceImpl</span><span class="token punctuation">,</span>在回滚之前把uuid变为<span class="token keyword">null</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    orderSequence <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token comment">//事务回滚</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        connection<span class="token punctuation">.</span><span class="token function">rollback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        ex<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token number">2.</span>修改<span class="token class-name">OrderServlet</span>端接收到的订单号是否为空
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code> <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">checkout</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>

        <span class="token class-name">String</span> orderSequence <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">//1.从session中获取购物车对象</span>
            <span class="token class-name">HttpSession</span> session <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Cart</span> cart <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Cart</span><span class="token punctuation">)</span> session<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;cart&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//2.从session获取用户信息</span>
            <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">)</span> session<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//3.调用service层的方法,进行订单结算,并且获取订单的序列号</span>
            orderSequence <span class="token operator">=</span> orderService<span class="token punctuation">.</span><span class="token function">checkout</span><span class="token punctuation">(</span>cart<span class="token punctuation">,</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>orderSequence<span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token comment">//4.清空购物车</span>
                <span class="token comment">//session.removeAttribute(&quot;cart&quot;);</span>
                cart<span class="token punctuation">.</span><span class="token function">getCartItemMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                cart<span class="token punctuation">.</span><span class="token function">setTotalAmount</span><span class="token punctuation">(</span><span class="token number">0d</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//5.将订单序列号存储到域中,跳转checkout.html页面</span>
                request<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;orderSequence&quot;</span><span class="token punctuation">,</span>orderSequence<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">processTemplate</span><span class="token punctuation">(</span><span class="token string">&quot;cart/checkout&quot;</span><span class="token punctuation">,</span>request<span class="token punctuation">,</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                request<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;orderSequence&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;对不起,订单失败&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">processTemplate</span><span class="token punctuation">(</span><span class="token string">&quot;cart/checkout&quot;</span><span class="token punctuation">,</span>request<span class="token punctuation">,</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>问题:</p><p>Service只是处理业务的,而获取连接对象,传递连接对象操作不应该Service干的事儿</p><p>获取连接这个事儿不是应该Service层干,将连接对象传递给dao层也不应该是Service干的事儿</p><p>获取连接传递连接不应该在service层干,这件事从service层抽离出来,但是还要 保证service和dao层使用的连接对象是同一条连接</p></blockquote><h2 id="_4-threadlocal对象介绍" tabindex="-1"><a class="header-anchor" href="#_4-threadlocal对象介绍" aria-hidden="true">#</a> 4.ThreadLocal对象介绍</h2><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token number">1.</span>问题描述<span class="token operator">:</span>
  a<span class="token punctuation">.</span>如何保证<span class="token class-name">Service</span>层不给dao层传递连接对象时<span class="token punctuation">,</span>使用的是 同一条连接呢
  b<span class="token punctuation">.</span>一个用户就是一个线程<span class="token punctuation">,</span>那么在同一条线程中保证连接对应是同一个呢<span class="token punctuation">,</span>怎么将连接对象和线程绑在一起呢<span class="token operator">?</span>
    这样不管用户去哪里<span class="token punctuation">,</span>使用的连接都是同一个连接
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token number">1.</span>概述<span class="token operator">:</span>容器
<span class="token number">2.</span>方法<span class="token operator">:</span>
    <span class="token keyword">void</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">T</span> value<span class="token punctuation">)</span>  <span class="token operator">-&gt;</span>往<span class="token class-name">ThreadLocal</span>中添加元素
    <span class="token class-name">T</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token operator">-&gt;</span> 从<span class="token class-name">ThreadLocal</span>中获取元素
    
<span class="token number">3.</span>特点<span class="token operator">:</span>
   <span class="token class-name"><span class="token namespace">a<span class="token punctuation">.</span></span>ThreadLocal</span>中获取的元素都是最后一次存进去的<span class="token punctuation">,</span>一次只能存一个
   b<span class="token punctuation">.</span>一个线程往<span class="token class-name">ThreadLocal</span>中存储数据<span class="token punctuation">,</span>其他线程获取不到
       
<span class="token number">4.</span>作用<span class="token operator">:</span>保证一条线程中使用的资源是同一个
    
<span class="token number">5.</span>底层实质上是一个map集合
  key<span class="token operator">:</span>当前线程对象  <span class="token operator">-&gt;</span>  <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  value<span class="token operator">:</span>随意  <span class="token operator">-&gt;</span>  存在<span class="token class-name">ThreadLocal</span>中的值
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test01</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//创建ThreadLocal对象</span>
        <span class="token class-name">ThreadLocal</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> threadLocal <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadLocal</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        threadLocal<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;多尔衮&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>threadLocal<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>threadLocal<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//null</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_5-连接管理类" tabindex="-1"><a class="header-anchor" href="#_5-连接管理类" aria-hidden="true">#</a> 5.连接管理类</h2><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 *  使用ThreadLocal类，将线程对象，和数据库连接对象实现绑定
 *  保证一个用户一个线程
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConnectionManager</span> <span class="token punctuation">{</span>
    <span class="token comment">//定义对象ThreadLocal</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">ThreadLocal</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Connection</span><span class="token punctuation">&gt;</span></span> local <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadLocal</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Connection</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * 方法，释放资源
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">//线程对象和连接对象解除绑定</span>
            <span class="token comment">//Map集合，移除键值对</span>
            local<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//释放资源，连接对象，归还连接池</span>
            <span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token doc-comment comment">/**
     * 方法：回滚事务
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">rollback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">rollback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * 方法:提交事务
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{</span>
        <span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token doc-comment comment">/**
     * 方法：开启事务的方法
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{</span>
        <span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAutoCommit</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     *  方法：返回数据库的连接对象
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Connection</span> <span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{</span>
        <span class="token comment">//从local对象中，获取数据库连接对象</span>
        <span class="token class-name">Connection</span> con <span class="token operator">=</span> local<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//判断连接对象，是否存在</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>con <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">//local对象中，没有存储过连接对象</span>
            <span class="token comment">//连接池拿一个</span>
            con <span class="token operator">=</span> <span class="token class-name">DruidUtils</span><span class="token punctuation">.</span><span class="token function">getDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//存储到local对象</span>
            local<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>con<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> con<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_6-使用连接管理类改造orderservice和orderdao以及orderitemdao" tabindex="-1"><a class="header-anchor" href="#_6-使用连接管理类改造orderservice和orderdao以及orderitemdao" aria-hidden="true">#</a> 6.使用连接管理类改造OrderService和OrderDao以及OrderItemDao</h2><h3 id="_6-1-修改orderservice" tabindex="-1"><a class="header-anchor" href="#_6-1-修改orderservice" aria-hidden="true">#</a> 6.1.修改OrderService</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">OrderService</span> <span class="token punctuation">{</span>
    <span class="token class-name">OrderDao</span> orderDao <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderDaoImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">OrderItemDao</span> orderItemDao <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderItemDaoImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">checkout</span><span class="token punctuation">(</span><span class="token class-name">Cart</span> cart<span class="token punctuation">,</span> <span class="token class-name">User</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> orderSequence <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">//开启事务</span>
            <span class="token class-name">ConnectionManager</span><span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//1.创建订单对象</span>
            <span class="token class-name">Order</span> order <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Order</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//2.生成一个唯一的订单号(使用UUID)</span>
            orderSequence <span class="token operator">=</span> UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//3.将生成的订单号封装到Order对象中</span>
            order<span class="token punctuation">.</span><span class="token function">setOrderSequence</span><span class="token punctuation">(</span>orderSequence<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//4.创建下单的时间,封装到Order对象中-&gt;当前时间</span>
            <span class="token class-name">SimpleDateFormat</span> sdf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> createTime <span class="token operator">=</span> sdf<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            order<span class="token punctuation">.</span><span class="token function">setCreateTime</span><span class="token punctuation">(</span>createTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//5.设置Order的购买数量,来自于购物车</span>
            order<span class="token punctuation">.</span><span class="token function">setTotalCount</span><span class="token punctuation">(</span>cart<span class="token punctuation">.</span><span class="token function">getTotalCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//6.设置Order的总金额,来自于购物车</span>
            order<span class="token punctuation">.</span><span class="token function">setTotalAmount</span><span class="token punctuation">(</span>cart<span class="token punctuation">.</span><span class="token function">getTotalAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">/*
          7.设置Order的订单状态 -&gt; 已支付,待发货:0

            注意:将来如果写状态码直接写0,不好
                如果将来项目经理或者产品说了:0不代表已支付,待发货了,咱们还得改这个0
                所以,状态码不应该写死

            解决:创建一个类,在里面创建状态码,到时候如果整数代表的状态改了,我们直接在此类中
                 改
                 此处的代码不用改了
         */</span>
            order<span class="token punctuation">.</span><span class="token function">setOrderStatus</span><span class="token punctuation">(</span><span class="token class-name">OrderStatusCode</span><span class="token punctuation">.</span>YIZHIFU<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//8.设置Order的用户主键</span>
            order<span class="token punctuation">.</span><span class="token function">setUserId</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getUserid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//9.调用dao成的insertOrder方法,传递Order对象</span>
            <span class="token class-name">Integer</span> key <span class="token operator">=</span> orderDao<span class="token punctuation">.</span><span class="token function">insertOrder</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">/</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;=================以下是订单项的代码================&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">/*
          10.由于订单项中的内容取决于购物车中购物项的内容
             所以需要先获取购物车中购物项的数据
         */</span>
            <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CartItem</span><span class="token punctuation">&gt;</span></span> cartItemCollection <span class="token operator">=</span> cart<span class="token punctuation">.</span><span class="token function">getCartItemMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//有几个购物项,就应该有几个订单项</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">CartItem</span> cartItem <span class="token operator">:</span> cartItemCollection<span class="token punctuation">)</span> <span class="token punctuation">{</span>

                <span class="token comment">//创建订单项对象</span>
                <span class="token class-name">OrderItem</span> orderItem <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderItem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//设置订单项OrderItem中的属性值,属性值从购物项中取,然后放到OrderItem中</span>

                <span class="token comment">//设置orderItem对象的参数：书名</span>
                orderItem<span class="token punctuation">.</span><span class="token function">setBookName</span><span class="token punctuation">(</span>cartItem<span class="token punctuation">.</span><span class="token function">getBookName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//设置orderItem对象的参数：单价</span>
                orderItem<span class="token punctuation">.</span><span class="token function">setPrice</span><span class="token punctuation">(</span>cartItem<span class="token punctuation">.</span><span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//设置orderItem对象的参数：图片路径</span>
                orderItem<span class="token punctuation">.</span><span class="token function">setImgPath</span><span class="token punctuation">(</span>cartItem<span class="token punctuation">.</span><span class="token function">getImgPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//设置orderItem对象的参数：购买数量</span>
                orderItem<span class="token punctuation">.</span><span class="token function">setItemCount</span><span class="token punctuation">(</span>cartItem<span class="token punctuation">.</span><span class="token function">getCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//设置orderItem对象的参数：小计金额</span>
                orderItem<span class="token punctuation">.</span><span class="token function">setItemAmount</span><span class="token punctuation">(</span>cartItem<span class="token punctuation">.</span><span class="token function">getAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">/*
              orderItem中的order_id外键怎么保存?
              获取最后一次新增的订单id
             */</span>
                <span class="token comment">//设置orderItem对象的参数：订单的外键 (订单数据表的主键)</span>
                orderItem<span class="token punctuation">.</span><span class="token function">setOrderId</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">//调用OrderItemDao中的添加订单项的方法</span>
                orderItemDao<span class="token punctuation">.</span><span class="token function">insertOrderItem</span><span class="token punctuation">(</span>orderItem<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">//提交事务</span>
            <span class="token class-name">ConnectionManager</span><span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            orderSequence <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

            <span class="token comment">//事务回滚</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token class-name">ConnectionManager</span><span class="token punctuation">.</span><span class="token function">rollback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                ex<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
               <span class="token class-name">ConnectionManager</span><span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> orderSequence<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-2-修改orderdao" tabindex="-1"><a class="header-anchor" href="#_6-2-修改orderdao" aria-hidden="true">#</a> 6.2.修改OrderDao</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">OrderDao</span> <span class="token punctuation">{</span>
    <span class="token class-name">Integer</span> <span class="token function">insertOrder</span><span class="token punctuation">(</span><span class="token class-name">Order</span> order<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderDaoImpl</span> <span class="token keyword">implements</span> <span class="token class-name">OrderDao</span> <span class="token punctuation">{</span>
    <span class="token class-name">QueryRunner</span> qr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryRunner</span><span class="token punctuation">(</span><span class="token class-name">DruidUtils</span><span class="token punctuation">.</span><span class="token function">getDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * 添加订单方法
     * <span class="token keyword">@param</span> <span class="token parameter">order</span>
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">insertOrder</span><span class="token punctuation">(</span><span class="token class-name">Order</span> order<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">&quot;insert into t_order values (?,?,?,?,?,?,?)&quot;</span><span class="token punctuation">;</span>
        qr<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">ConnectionManager</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>sql<span class="token punctuation">,</span> order<span class="token punctuation">.</span><span class="token function">getOrderId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> order<span class="token punctuation">.</span><span class="token function">getOrderSequence</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> order<span class="token punctuation">.</span><span class="token function">getCreateTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> order<span class="token punctuation">.</span><span class="token function">getTotalCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                order<span class="token punctuation">.</span><span class="token function">getTotalAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> order<span class="token punctuation">.</span><span class="token function">getOrderStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> order<span class="token punctuation">.</span><span class="token function">getUserId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//获取新增的主键</span>
        <span class="token class-name">String</span> sqlKey <span class="token operator">=</span> <span class="token string">&quot;select last_insert_id()&quot;</span><span class="token punctuation">;</span>
        <span class="token comment">/*
          执行select last_insert_id()需要转成BigInteger
          强转成BigInteger调用intValue()转成Integer
         */</span>
        <span class="token class-name">Integer</span> key <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">BigInteger</span><span class="token punctuation">)</span> qr<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token class-name">ConnectionManager</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>sqlKey<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ScalarHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">intValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> key<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-3-修改orderitemdao" tabindex="-1"><a class="header-anchor" href="#_6-3-修改orderitemdao" aria-hidden="true">#</a> 6.3.修改OrderItemDao</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">OrderItemDao</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">insertOrderItem</span><span class="token punctuation">(</span> <span class="token class-name">OrderItem</span> orderItem<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderItemDaoImpl</span> <span class="token keyword">implements</span> <span class="token class-name">OrderItemDao</span> <span class="token punctuation">{</span>
    <span class="token class-name">QueryRunner</span> qr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryRunner</span><span class="token punctuation">(</span><span class="token class-name">DruidUtils</span><span class="token punctuation">.</span><span class="token function">getDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">insertOrderItem</span><span class="token punctuation">(</span><span class="token class-name">OrderItem</span> orderItem<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{</span>
<span class="token comment">//写入中间表的SQL数据</span>
        <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">&quot;insert into t_order_item values(?,?,?,?,?,?,?)&quot;</span><span class="token punctuation">;</span>
        <span class="token comment">//对象数组，存储中间表问号占位符数据</span>
        <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> params <span class="token operator">=</span> <span class="token punctuation">{</span>orderItem<span class="token punctuation">.</span><span class="token function">getItemId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> orderItem<span class="token punctuation">.</span><span class="token function">getBookName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> orderItem<span class="token punctuation">.</span><span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                orderItem<span class="token punctuation">.</span><span class="token function">getImgPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> orderItem<span class="token punctuation">.</span><span class="token function">getItemCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> orderItem<span class="token punctuation">.</span><span class="token function">getItemAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> orderItem<span class="token punctuation">.</span><span class="token function">getOrderId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token comment">//执行SQL语句</span>
        qr<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">ConnectionManager</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>sql<span class="token punctuation">,</span> params<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div></div><footer class="page-meta"><div class="meta-item edit-link"><a class="nav-link meta-item-label" href="https://github.com/vuepress-reco/vuepress-theme-reco-next/edit/main/example//blogs/javaweb/day14_%E4%B9%A6%E5%9F%8E%E9%A1%B9%E7%9B%AE%E7%AC%AC%E5%85%AD%E9%98%B6%E6%AE%B5.md" rel="noopener noreferrer" target="_blank" aria-label="Edit this page"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" style="color:inherit;width:20px;height:20px;font-size:20px;"><g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 7H6a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h9a2 2 0 0 0 2-2v-3"></path><path d="M9 15h3l8.5-8.5a1.5 1.5 0 0 0-3-3L9 12v3"></path><path d="M16 5l3 3"></path></g></svg><span style="color:inherit;font-size:14px;"><!--[-->Edit this page<!--]--></span></a><!----><!--[--><!--]--></a></div><!----></footer><!----><div class="reco-valine-wrapper" style="display:none;"><div id="valine"></div></div></main><!--]--><div class="page-catalog-container"><h5 class="tip">ON THIS PAGE</h5><ul><!--[--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/blogs/javaweb/day14_shuchengxiangmudiliujieduan.html#_1-登录检查" class="router-link-active router-link-exact-active nav-link page-catalog-item" aria-label="1.登录检查"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->1.登录检查<!--]--></span></a><!--[--><!--]--></a></li><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/javaweb/day14_shuchengxiangmudiliujieduan.html#_1-1-用户权限说明" class="router-link-active router-link-exact-active nav-link page-catalog-item" aria-label="1.1.用户权限说明"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->1.1.用户权限说明<!--]--></span></a><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/javaweb/day14_shuchengxiangmudiliujieduan.html#_1-2-登录检查功能流程" class="router-link-active router-link-exact-active nav-link page-catalog-item" aria-label="1.2.登录检查功能流程"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->1.2.登录检查功能流程<!--]--></span></a><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/javaweb/day14_shuchengxiangmudiliujieduan.html#_1-3-登录检查功能过滤器配置" class="router-link-active router-link-exact-active nav-link page-catalog-item" aria-label="1.3.登录检查功能过滤器配置"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->1.3.登录检查功能过滤器配置<!--]--></span></a><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/javaweb/day14_shuchengxiangmudiliujieduan.html#_1-4-登录检查实现" class="router-link-active router-link-exact-active nav-link page-catalog-item" aria-label="1.4.登录检查实现"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->1.4.登录检查实现<!--]--></span></a><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/javaweb/day14_shuchengxiangmudiliujieduan.html#_1-5-登录检查购物车显示数量问题" class="router-link-active router-link-exact-active nav-link page-catalog-item" aria-label="1.5.登录检查购物车显示数量问题"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->1.5.登录检查购物车显示数量问题<!--]--></span></a><!--[--><!--]--></a></li><!--]--><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/blogs/javaweb/day14_shuchengxiangmudiliujieduan.html#_2-订单功能-提交订单结账-准备工作" class="router-link-active router-link-exact-active nav-link page-catalog-item" aria-label="2.订单功能_提交订单结账(准备工作)"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->2.订单功能_提交订单结账(准备工作)<!--]--></span></a><!--[--><!--]--></a></li><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/javaweb/day14_shuchengxiangmudiliujieduan.html#_2-1-创建订单表" class="router-link-active router-link-exact-active nav-link page-catalog-item" aria-label="2.1.创建订单表"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->2.1.创建订单表<!--]--></span></a><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/javaweb/day14_shuchengxiangmudiliujieduan.html#_2-2-创建订单项表" class="router-link-active router-link-exact-active nav-link page-catalog-item" aria-label="2.2.创建订单项表"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->2.2.创建订单项表<!--]--></span></a><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/javaweb/day14_shuchengxiangmudiliujieduan.html#_2-3-创建order订单javabean" class="router-link-active router-link-exact-active nav-link page-catalog-item" aria-label="2.3.创建Order订单javabean"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->2.3.创建Order订单javabean<!--]--></span></a><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/javaweb/day14_shuchengxiangmudiliujieduan.html#_2-4-创建orderitem订单项javabean" class="router-link-active router-link-exact-active nav-link page-catalog-item" aria-label="2.4.创建OrderItem订单项javabean"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->2.4.创建OrderItem订单项javabean<!--]--></span></a><!--[--><!--]--></a></li><!--]--><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/blogs/javaweb/day14_shuchengxiangmudiliujieduan.html#_3-订单功能-提交订单结账" class="router-link-active router-link-exact-active nav-link page-catalog-item" aria-label="3.订单功能_提交订单结账"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->3.订单功能_提交订单结账<!--]--></span></a><!--[--><!--]--></a></li><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/javaweb/day14_shuchengxiangmudiliujieduan.html#_3-1-修改cart-html" class="router-link-active router-link-exact-active nav-link page-catalog-item" aria-label="3.1.修改cart.html"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->3.1.修改cart.html<!--]--></span></a><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/javaweb/day14_shuchengxiangmudiliujieduan.html#_3-2-orderservlet实现" class="router-link-active router-link-exact-active nav-link page-catalog-item" aria-label="3.2.OrderServlet实现"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->3.2.OrderServlet实现<!--]--></span></a><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/javaweb/day14_shuchengxiangmudiliujieduan.html#_3-3-orderservice实现" class="router-link-active router-link-exact-active nav-link page-catalog-item" aria-label="3.3.OrderService实现"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->3.3.OrderService实现<!--]--></span></a><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/javaweb/day14_shuchengxiangmudiliujieduan.html#_3-4-orderdao实现" class="router-link-active router-link-exact-active nav-link page-catalog-item" aria-label="3.4.OrderDao实现"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->3.4.OrderDao实现<!--]--></span></a><!--[--><!--]--></a></li><!--]--><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/blogs/javaweb/day14_shuchengxiangmudiliujieduan.html#_4-订单功能-存储订单项" class="router-link-active router-link-exact-active nav-link page-catalog-item" aria-label="4.订单功能_存储订单项"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->4.订单功能_存储订单项<!--]--></span></a><!--[--><!--]--></a></li><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/javaweb/day14_shuchengxiangmudiliujieduan.html#_4-1-修改orderservice实现" class="router-link-active router-link-exact-active nav-link page-catalog-item" aria-label="4.1.修改OrderService实现"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->4.1.修改OrderService实现<!--]--></span></a><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/javaweb/day14_shuchengxiangmudiliujieduan.html#_4-2-修改orderdao实现" class="router-link-active router-link-exact-active nav-link page-catalog-item" aria-label="4.2.修改OrderDao实现"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->4.2.修改OrderDao实现<!--]--></span></a><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/javaweb/day14_shuchengxiangmudiliujieduan.html#_4-3-创建orderitemdao并实现" class="router-link-active router-link-exact-active nav-link page-catalog-item" aria-label="4.3.创建OrderItemDao并实现"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->4.3.创建OrderItemDao并实现<!--]--></span></a><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/javaweb/day14_shuchengxiangmudiliujieduan.html#_4-4-修改checkout-html显示域中的订单号" class="router-link-active router-link-exact-active nav-link page-catalog-item" aria-label="4.4.修改checkout.html显示域中的订单号"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->4.4.修改checkout.html显示域中的订单号<!--]--></span></a><!--[--><!--]--></a></li><!--]--><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/blogs/javaweb/day14_shuchengxiangmudiliujieduan.html#_5-订单功能-提交订单清空购物车" class="router-link-active router-link-exact-active nav-link page-catalog-item" aria-label="5.订单功能_提交订单清空购物车"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->5.订单功能_提交订单清空购物车<!--]--></span></a><!--[--><!--]--></a></li><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/javaweb/day14_shuchengxiangmudiliujieduan.html#_5-1-修改orderservlet" class="router-link-active router-link-exact-active nav-link page-catalog-item" aria-label="5.1.修改OrderServlet"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->5.1.修改OrderServlet<!--]--></span></a><!--[--><!--]--></a></li><!--]--><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/blogs/javaweb/day14_shuchengxiangmudiliujieduan.html#_1-未加事务时出现的bug" class="router-link-active router-link-exact-active nav-link page-catalog-item" aria-label="1.未加事务时出现的bug"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->1.未加事务时出现的bug<!--]--></span></a><!--[--><!--]--></a></li><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/javaweb/day14_shuchengxiangmudiliujieduan.html#_1-1-在orderserviceimpl中加异常代码" class="router-link-active router-link-exact-active nav-link page-catalog-item" aria-label="1.1.在OrderServiceImpl中加异常代码"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->1.1.在OrderServiceImpl中加异常代码<!--]--></span></a><!--[--><!--]--></a></li><!--]--><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/blogs/javaweb/day14_shuchengxiangmudiliujieduan.html#_2-事务的引入" class="router-link-active router-link-exact-active nav-link page-catalog-item" aria-label="2.事务的引入"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->2.事务的引入<!--]--></span></a><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/blogs/javaweb/day14_shuchengxiangmudiliujieduan.html#_3-使用事务改造订单相关类" class="router-link-active router-link-exact-active nav-link page-catalog-item" aria-label="3.使用事务改造订单相关类"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->3.使用事务改造订单相关类<!--]--></span></a><!--[--><!--]--></a></li><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/javaweb/day14_shuchengxiangmudiliujieduan.html#_3-1-使用事务改造orderserviceimpl" class="router-link-active router-link-exact-active nav-link page-catalog-item" aria-label="3.1.使用事务改造OrderServiceImpl"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->3.1.使用事务改造OrderServiceImpl<!--]--></span></a><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/javaweb/day14_shuchengxiangmudiliujieduan.html#_3-2-使用事务改造orderdao" class="router-link-active router-link-exact-active nav-link page-catalog-item" aria-label="3.2.使用事务改造OrderDao"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->3.2.使用事务改造OrderDao<!--]--></span></a><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/javaweb/day14_shuchengxiangmudiliujieduan.html#_3-3-使用事务改造orderitemdao" class="router-link-active router-link-exact-active nav-link page-catalog-item" aria-label="3.3.使用事务改造OrderItemDao"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->3.3.使用事务改造OrderItemDao<!--]--></span></a><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/javaweb/day14_shuchengxiangmudiliujieduan.html#_3-4-订单提交失败-处理方式" class="router-link-active router-link-exact-active nav-link page-catalog-item" aria-label="3.4.订单提交失败,处理方式"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->3.4.订单提交失败,处理方式<!--]--></span></a><!--[--><!--]--></a></li><!--]--><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/blogs/javaweb/day14_shuchengxiangmudiliujieduan.html#_4-threadlocal对象介绍" class="router-link-active router-link-exact-active nav-link page-catalog-item" aria-label="4.ThreadLocal对象介绍"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->4.ThreadLocal对象介绍<!--]--></span></a><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/blogs/javaweb/day14_shuchengxiangmudiliujieduan.html#_5-连接管理类" class="router-link-active router-link-exact-active nav-link page-catalog-item" aria-label="5.连接管理类"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->5.连接管理类<!--]--></span></a><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/blogs/javaweb/day14_shuchengxiangmudiliujieduan.html#_6-使用连接管理类改造orderservice和orderdao以及orderitemdao" class="router-link-active router-link-exact-active nav-link page-catalog-item" aria-label="6.使用连接管理类改造OrderService和OrderDao以及OrderItemDao"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->6.使用连接管理类改造OrderService和OrderDao以及OrderItemDao<!--]--></span></a><!--[--><!--]--></a></li><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/javaweb/day14_shuchengxiangmudiliujieduan.html#_6-1-修改orderservice" class="router-link-active router-link-exact-active nav-link page-catalog-item" aria-label="6.1.修改OrderService"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->6.1.修改OrderService<!--]--></span></a><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/javaweb/day14_shuchengxiangmudiliujieduan.html#_6-2-修改orderdao" class="router-link-active router-link-exact-active nav-link page-catalog-item" aria-label="6.2.修改OrderDao"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->6.2.修改OrderDao<!--]--></span></a><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/javaweb/day14_shuchengxiangmudiliujieduan.html#_6-3-修改orderitemdao" class="router-link-active router-link-exact-active nav-link page-catalog-item" aria-label="6.3.修改OrderItemDao"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->6.3.修改OrderItemDao<!--]--></span></a><!--[--><!--]--></a></li><!--]--><!--]--><!--]--></ul></div></div></div><!----><!----><!--]--></div>
    <script type="module" src="/assets/app.a3ab45a4.js" defer></script>
  </body>
</html>
