<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.48">
    <script>
      const userMode = localStorage.getItem('vuepress-reco-color-scheme');
      const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;

      if (userMode === 'dark' || (typeof userMode !== 'string' && systemDarkMode)) {
        document.documentElement.classList.toggle('dark', true);
      }
    </script>
    <title>day04.连接池-DBUtils-事务 | </title><meta name="description" content="Just playing around">
    <link rel="modulepreload" href="/assets/app.a3ab45a4.js"><link rel="modulepreload" href="/assets/day04.连接池_DBUtils_事务.html.1c03ce85.js"><link rel="modulepreload" href="/assets/day04.连接池_DBUtils_事务.html.73863eaf.js"><link rel="prefetch" href="/assets/index.html.ebb15f84.js"><link rel="prefetch" href="/assets/day01_html_css.html.58531186.js"><link rel="prefetch" href="/assets/day02_JS.html.7bbefa79.js"><link rel="prefetch" href="/assets/day03.正则表达式-VUE-书城项目.html.adf37614.js"><link rel="prefetch" href="/assets/day04.xml_tomcat_http.html.103f4b3b.js"><link rel="prefetch" href="/assets/day05.Servlet.html.dcd8b6a6.js"><link rel="prefetch" href="/assets/day06.Request_Response.html.fb6e665d.js"><link rel="prefetch" href="/assets/day07.书城项目第二阶段.html.c0e07c35.js"><link rel="prefetch" href="/assets/day08_Thymeleaf.html.24b964b0.js"><link rel="prefetch" href="/assets/day09_书城项目第三阶段.html.8074f608.js"><link rel="prefetch" href="/assets/day10_cookie_session_书城第四阶段.html.de0da957.js"><link rel="prefetch" href="/assets/day11_Ajax_Axios_书城项目第五阶段.html.f0a245d7.js"><link rel="prefetch" href="/assets/day12_书城项目第五阶段.html.3a76a974.js"><link rel="prefetch" href="/assets/day13_Filter_Listenler_书城项目第六阶段.html.7967e701.js"><link rel="prefetch" href="/assets/day14_书城项目第六阶段.html.3ab3b7e3.js"><link rel="prefetch" href="/assets/day01._环境变量_HelloWorld_变量_常量_.html.7ae7bd2a.js"><link rel="prefetch" href="/assets/day02.变量_数据类型转换_运算符.html.61b798b4.js"><link rel="prefetch" href="/assets/day03_流程控制.html.24a574b4.js"><link rel="prefetch" href="/assets/day04.循环_数组.html.354c4af1.js"><link rel="prefetch" href="/assets/day05.方法.html.3eb83c4b.js"><link rel="prefetch" href="/assets/day06.方法的重载_面向对象.html.0f4e47d6.js"><link rel="prefetch" href="/assets/day07.可变参数 命令行参数 递归 对象数组.html.49f61394.js"><link rel="prefetch" href="/assets/day08.封装_标准JavaBean_继承_代码块.html.c33d7be4.js"><link rel="prefetch" href="/assets/day09.抽象 多态.html.fa6b08b2.js"><link rel="prefetch" href="/assets/day10.接口-final-内部类.html.c1ceaebb.js"><link rel="prefetch" href="/assets/day11.Object_异常.html.dec73e0a.js"><link rel="prefetch" href="/assets/day12.基础API.html.78902b30.js"><link rel="prefetch" href="/assets/day13.常用API.html.6baab0dd.js"><link rel="prefetch" href="/assets/day14.API_多线程.html.b85f8d16.js"><link rel="prefetch" href="/assets/day15. 多线程.html.d344fb02.js"><link rel="prefetch" href="/assets/day16.集合.html.1a53a169.js"><link rel="prefetch" href="/assets/day17.集合.html.31d51334.js"><link rel="prefetch" href="/assets/day18.Map集合_正则表达式.html.438d1716.js"><link rel="prefetch" href="/assets/day19.File类_IO流.html.25b09cae.js"><link rel="prefetch" href="/assets/day20.IO流.html.33266278.js"><link rel="prefetch" href="/assets/day21.IO流_网络编程.html.5665c59c.js"><link rel="prefetch" href="/assets/day22.JDK8新特性.html.50304d5f.js"><link rel="prefetch" href="/assets/day23.反射.html.ddf5f3d3.js"><link rel="prefetch" href="/assets/Maven.html.bea69fd9.js"><link rel="prefetch" href="/assets/JDBC相关配置.html.6fa67258.js"><link rel="prefetch" href="/assets/MySQL8.0_JDBC笔记.html.ca348289.js"><link rel="prefetch" href="/assets/MySQL8.0_SQL笔记.html.e4a25fc0.js"><link rel="prefetch" href="/assets/尚硅谷_JavaEE_Linux.html.e1cb317c.js"><link rel="prefetch" href="/assets/尚硅谷_JAVAEE_MyBatis.html.cfc6f95c.js"><link rel="prefetch" href="/assets/尚硅谷_JAVAEE_SpringMVC_01.html.d5463ac6.js"><link rel="prefetch" href="/assets/尚硅谷_JAVAEE_SpringMVC_02.html.1950a71d.js"><link rel="prefetch" href="/assets/尚硅谷_JAVAEE_SpringMVC_03.html.8eeb7d5e.js"><link rel="prefetch" href="/assets/尚硅谷_JAVAEE_Spring_01.html.3c92ad1f.js"><link rel="prefetch" href="/assets/尚硅谷_JAVAEE_Spring_02.html.02108edc.js"><link rel="prefetch" href="/assets/尚硅谷_JAVAEE_SSM整合.html.6dc18351.js"><link rel="prefetch" href="/assets/introduce.html.28805215.js"><link rel="prefetch" href="/assets/api.html.129f101e.js"><link rel="prefetch" href="/assets/home.html.003faba0.js"><link rel="prefetch" href="/assets/plugin.html.ef0e2a60.js"><link rel="prefetch" href="/assets/theme.html.b9cd7c4e.js"><link rel="prefetch" href="/assets/day01_数据库基础.html.126e3169.js"><link rel="prefetch" href="/assets/day03_Mysql函数_DCL_JDBC.html.6060eb04.js"><link rel="prefetch" href="/assets/day02.多表查询.html.41d5f281.js"><link rel="prefetch" href="/assets/404.html.d341cb57.js"><link rel="prefetch" href="/assets/index.html.58efd06f.js"><link rel="prefetch" href="/assets/index.html.97de9f46.js"><link rel="prefetch" href="/assets/index.html.557aa63b.js"><link rel="prefetch" href="/assets/index.html.ad7ee736.js"><link rel="prefetch" href="/assets/index.html.0c81c793.js"><link rel="prefetch" href="/assets/index.html.3ad1ba34.js"><link rel="prefetch" href="/assets/index.html.1df5c8f0.js"><link rel="prefetch" href="/assets/index.html.3063722d.js"><link rel="prefetch" href="/assets/index.html.61990ea1.js"><link rel="prefetch" href="/assets/index.html.47860465.js"><link rel="prefetch" href="/assets/index.html.9c0ff370.js"><link rel="prefetch" href="/assets/index.html.ceff066d.js"><link rel="prefetch" href="/assets/index.html.619474bb.js"><link rel="prefetch" href="/assets/index.html.a37c7154.js"><link rel="prefetch" href="/assets/index.html.0b8b01e2.js"><link rel="prefetch" href="/assets/index.html.c84b791a.js"><link rel="prefetch" href="/assets/index.html.0019e90f.js"><link rel="prefetch" href="/assets/index.html.f4568a25.js"><link rel="prefetch" href="/assets/index.html.57051674.js"><link rel="prefetch" href="/assets/index.html.40a5a878.js"><link rel="prefetch" href="/assets/index.html.574e8ea0.js"><link rel="prefetch" href="/assets/index.html.0dd284c6.js"><link rel="prefetch" href="/assets/index.html.06e3e078.js"><link rel="prefetch" href="/assets/index.html.a012c9d6.js"><link rel="prefetch" href="/assets/index.html.524628e4.js"><link rel="prefetch" href="/assets/index.html.cf9769f3.js"><link rel="prefetch" href="/assets/index.html.c6e767ae.js"><link rel="prefetch" href="/assets/index.html.fca78420.js"><link rel="prefetch" href="/assets/index.html.c27283be.js"><link rel="prefetch" href="/assets/index.html.0927b918.js"><link rel="prefetch" href="/assets/index.html.98fba16a.js"><link rel="prefetch" href="/assets/index.html.e85777b3.js"><link rel="prefetch" href="/assets/index.html.20785866.js"><link rel="prefetch" href="/assets/index.html.4d2fabb8.js"><link rel="prefetch" href="/assets/index.html.4528ce4e.js"><link rel="prefetch" href="/assets/index.html.631e815c.js"><link rel="prefetch" href="/assets/index.html.29a76e91.js"><link rel="prefetch" href="/assets/index.html.b3505ff8.js"><link rel="prefetch" href="/assets/index.html.6253a7e1.js"><link rel="prefetch" href="/assets/index.html.bb8525b1.js"><link rel="prefetch" href="/assets/index.html.28ee009d.js"><link rel="prefetch" href="/assets/index.html.72ac4063.js"><link rel="prefetch" href="/assets/index.html.b57762aa.js"><link rel="prefetch" href="/assets/index.html.08b3a957.js"><link rel="prefetch" href="/assets/index.html.9cbf2d78.js"><link rel="prefetch" href="/assets/index.html.4bc70fa1.js"><link rel="prefetch" href="/assets/index.html.7d530fd6.js"><link rel="prefetch" href="/assets/index.html.6c91053f.js"><link rel="prefetch" href="/assets/index.html.aca8845c.js"><link rel="prefetch" href="/assets/day01_html_css.html.e7031b28.js"><link rel="prefetch" href="/assets/day02_JS.html.67604748.js"><link rel="prefetch" href="/assets/day03.正则表达式-VUE-书城项目.html.aaff2bde.js"><link rel="prefetch" href="/assets/day04.xml_tomcat_http.html.e15916ae.js"><link rel="prefetch" href="/assets/day05.Servlet.html.94007cd3.js"><link rel="prefetch" href="/assets/day06.Request_Response.html.7903b50f.js"><link rel="prefetch" href="/assets/day07.书城项目第二阶段.html.b0a2dbf2.js"><link rel="prefetch" href="/assets/day08_Thymeleaf.html.e08a367a.js"><link rel="prefetch" href="/assets/day09_书城项目第三阶段.html.6ab231dd.js"><link rel="prefetch" href="/assets/day10_cookie_session_书城第四阶段.html.d8e47253.js"><link rel="prefetch" href="/assets/day11_Ajax_Axios_书城项目第五阶段.html.05e9c152.js"><link rel="prefetch" href="/assets/day12_书城项目第五阶段.html.e73547da.js"><link rel="prefetch" href="/assets/day13_Filter_Listenler_书城项目第六阶段.html.706a4f5d.js"><link rel="prefetch" href="/assets/day14_书城项目第六阶段.html.5d00b54f.js"><link rel="prefetch" href="/assets/day01._环境变量_HelloWorld_变量_常量_.html.1218b13b.js"><link rel="prefetch" href="/assets/day02.变量_数据类型转换_运算符.html.033b30ff.js"><link rel="prefetch" href="/assets/day03_流程控制.html.e1c8c0e7.js"><link rel="prefetch" href="/assets/day04.循环_数组.html.bac2989b.js"><link rel="prefetch" href="/assets/day05.方法.html.f9f40ee7.js"><link rel="prefetch" href="/assets/day06.方法的重载_面向对象.html.71c81410.js"><link rel="prefetch" href="/assets/day07.可变参数 命令行参数 递归 对象数组.html.cdc4876c.js"><link rel="prefetch" href="/assets/day08.封装_标准JavaBean_继承_代码块.html.e1784b45.js"><link rel="prefetch" href="/assets/day09.抽象 多态.html.77aeb0f5.js"><link rel="prefetch" href="/assets/day10.接口-final-内部类.html.73b28a0b.js"><link rel="prefetch" href="/assets/day11.Object_异常.html.a57b0c5f.js"><link rel="prefetch" href="/assets/day12.基础API.html.5260352e.js"><link rel="prefetch" href="/assets/day13.常用API.html.07b560ea.js"><link rel="prefetch" href="/assets/day14.API_多线程.html.e6cb5701.js"><link rel="prefetch" href="/assets/day15. 多线程.html.be89a5b2.js"><link rel="prefetch" href="/assets/day16.集合.html.c114e4e8.js"><link rel="prefetch" href="/assets/day17.集合.html.3f246d0d.js"><link rel="prefetch" href="/assets/day18.Map集合_正则表达式.html.4180d9a9.js"><link rel="prefetch" href="/assets/day19.File类_IO流.html.7a9058b2.js"><link rel="prefetch" href="/assets/day20.IO流.html.0854835f.js"><link rel="prefetch" href="/assets/day21.IO流_网络编程.html.d5e2eb99.js"><link rel="prefetch" href="/assets/day22.JDK8新特性.html.b0126c2e.js"><link rel="prefetch" href="/assets/day23.反射.html.7bd37766.js"><link rel="prefetch" href="/assets/Maven.html.d5b0f369.js"><link rel="prefetch" href="/assets/JDBC相关配置.html.ce57076e.js"><link rel="prefetch" href="/assets/MySQL8.0_JDBC笔记.html.908bbbbf.js"><link rel="prefetch" href="/assets/MySQL8.0_SQL笔记.html.b35b9eec.js"><link rel="prefetch" href="/assets/尚硅谷_JavaEE_Linux.html.49047ee1.js"><link rel="prefetch" href="/assets/尚硅谷_JAVAEE_MyBatis.html.b1888d79.js"><link rel="prefetch" href="/assets/尚硅谷_JAVAEE_SpringMVC_01.html.b365a1f7.js"><link rel="prefetch" href="/assets/尚硅谷_JAVAEE_SpringMVC_02.html.48af7bad.js"><link rel="prefetch" href="/assets/尚硅谷_JAVAEE_SpringMVC_03.html.bd03fc97.js"><link rel="prefetch" href="/assets/尚硅谷_JAVAEE_Spring_01.html.b0ac5006.js"><link rel="prefetch" href="/assets/尚硅谷_JAVAEE_Spring_02.html.81819d25.js"><link rel="prefetch" href="/assets/尚硅谷_JAVAEE_SSM整合.html.071d6dbd.js"><link rel="prefetch" href="/assets/introduce.html.1f287638.js"><link rel="prefetch" href="/assets/api.html.0ff820e5.js"><link rel="prefetch" href="/assets/home.html.cc5e5dd6.js"><link rel="prefetch" href="/assets/plugin.html.96c4855f.js"><link rel="prefetch" href="/assets/theme.html.b204257f.js"><link rel="prefetch" href="/assets/day01_数据库基础.html.435d0f70.js"><link rel="prefetch" href="/assets/day03_Mysql函数_DCL_JDBC.html.fc4cbbd6.js"><link rel="prefetch" href="/assets/day02.多表查询.html.530dbd1f.js"><link rel="prefetch" href="/assets/404.html.6c289388.js"><link rel="prefetch" href="/assets/index.html.28d46d0f.js"><link rel="prefetch" href="/assets/index.html.a52191f3.js"><link rel="prefetch" href="/assets/index.html.8d55b278.js"><link rel="prefetch" href="/assets/index.html.8f21397a.js"><link rel="prefetch" href="/assets/index.html.ae1d53ab.js"><link rel="prefetch" href="/assets/index.html.d18b591c.js"><link rel="prefetch" href="/assets/index.html.d0675f51.js"><link rel="prefetch" href="/assets/index.html.428a891a.js"><link rel="prefetch" href="/assets/index.html.e444627b.js"><link rel="prefetch" href="/assets/index.html.7ebfebc8.js"><link rel="prefetch" href="/assets/index.html.faa84a8c.js"><link rel="prefetch" href="/assets/index.html.222f6531.js"><link rel="prefetch" href="/assets/index.html.6fdf9859.js"><link rel="prefetch" href="/assets/index.html.cb4ad210.js"><link rel="prefetch" href="/assets/index.html.f958ccc9.js"><link rel="prefetch" href="/assets/index.html.350fea0d.js"><link rel="prefetch" href="/assets/index.html.db50d4c5.js"><link rel="prefetch" href="/assets/index.html.0ebe57fe.js"><link rel="prefetch" href="/assets/index.html.7ebded45.js"><link rel="prefetch" href="/assets/index.html.4c42615d.js"><link rel="prefetch" href="/assets/index.html.9c4009c2.js"><link rel="prefetch" href="/assets/index.html.16792d52.js"><link rel="prefetch" href="/assets/index.html.3f3a2245.js"><link rel="prefetch" href="/assets/index.html.aec0688f.js"><link rel="prefetch" href="/assets/index.html.05572688.js"><link rel="prefetch" href="/assets/index.html.a9d9696b.js"><link rel="prefetch" href="/assets/index.html.4c72881c.js"><link rel="prefetch" href="/assets/index.html.1347abf2.js"><link rel="prefetch" href="/assets/index.html.13be939a.js"><link rel="prefetch" href="/assets/index.html.11b2957c.js"><link rel="prefetch" href="/assets/index.html.dc2286ef.js"><link rel="prefetch" href="/assets/index.html.5f96ea9e.js"><link rel="prefetch" href="/assets/index.html.419630fc.js"><link rel="prefetch" href="/assets/index.html.8f0d3a1a.js"><link rel="prefetch" href="/assets/index.html.f056c164.js"><link rel="prefetch" href="/assets/index.html.6dabcbc7.js"><link rel="prefetch" href="/assets/index.html.2328a899.js"><link rel="prefetch" href="/assets/index.html.43087c18.js"><link rel="prefetch" href="/assets/index.html.7e0e55d3.js"><link rel="prefetch" href="/assets/index.html.ff46ce3d.js"><link rel="prefetch" href="/assets/index.html.22afaaac.js"><link rel="prefetch" href="/assets/index.html.7882710c.js"><link rel="prefetch" href="/assets/index.html.72604ce3.js"><link rel="prefetch" href="/assets/index.html.6009e057.js"><link rel="prefetch" href="/assets/index.html.b0a115c8.js"><link rel="prefetch" href="/assets/index.html.07e29e17.js"><link rel="prefetch" href="/assets/index.html.721e20e8.js"><link rel="prefetch" href="/assets/index.html.38465f47.js"><link rel="prefetch" href="/assets/404.9e6b1fc0.js"><link rel="prefetch" href="/assets/Categories.b4cdad14.js"><link rel="prefetch" href="/assets/Layout.e815cd43.js"><link rel="prefetch" href="/assets/Post.b02fd647.js"><link rel="prefetch" href="/assets/Timeline.2abb69c2.js"><link rel="prefetch" href="/assets/reco-valine.88224ab5.js">
    <link rel="stylesheet" href="/assets/style.03d208ca.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><div class="common-wrapper no-sidebar"><header class="navbar-container"><div class="toggle-sidebar-button" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span class="site-brand"><a href="/" class=""><!----><!----></a></span><div class="navbar-links-wrapper" style=""><form class="search-box" role="search"><input type="search" autocomplete="off" spellcheck="false" value><!----></form><nav class="navbar-links"><!--[--><div class="navbar-links-item"><a href="/" class="nav-link" aria-label="Home"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->Home<!--]--></span></a><!--[--><!--]--></a></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="Categories"><a class="icon-container left title" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->Categories<!--]--></span></a><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="Categories"><a class="icon-container left title" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->Categories<!--]--></span></a><span class="right arrow"></span></button><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/categories/JavaWEB/1/" class="nav-link" aria-label="JavaWEB"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->JavaWEB<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/categories/Javajichu/1/" class="nav-link" aria-label="Java基础"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->Java基础<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/categories/Maven/1/" class="nav-link" aria-label="Maven"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->Maven<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/categories/JDBC/1/" class="nav-link" aria-label="JDBC"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->JDBC<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/categories/MySQL/1/" class="nav-link" aria-label="MySQL"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->MySQL<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/categories/MyBatis/1/" class="nav-link" aria-label="MyBatis"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->MyBatis<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/categories/SpringMVC/1/" class="nav-link" aria-label="SpringMVC"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->SpringMVC<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/categories/Spring5/1/" class="nav-link" aria-label="Spring5"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->Spring5<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/categories/SSM/1/" class="nav-link" aria-label="SSM"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->SSM<!--]--></span></a><!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="Tags"><a class="icon-container left title" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->Tags<!--]--></span></a><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="Tags"><a class="icon-container left title" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->Tags<!--]--></span></a><span class="right arrow"></span></button><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/tags/JavaWEB/1/" class="nav-link" aria-label="JavaWEB"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->JavaWEB<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/shuchengxiangmu/1/" class="nav-link" aria-label="书城项目"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->书城项目<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/Javajichu/1/" class="nav-link" aria-label="Java基础"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->Java基础<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/yichang/1/" class="nav-link" aria-label="异常"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->异常<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/API/1/" class="nav-link" aria-label="API"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->API<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/duoxiancheng/1/" class="nav-link" aria-label="多线程"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->多线程<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/jihe/1/" class="nav-link" aria-label="集合"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->集合<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/zhengzebiaodashi/1/" class="nav-link" aria-label="正则表达式"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->正则表达式<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/IOliu/1/" class="nav-link" aria-label="IO流"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->IO流<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/wangluobiancheng/1/" class="nav-link" aria-label="网络编程"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->网络编程<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/JDK8xintexing/1/" class="nav-link" aria-label="JDK8新特性"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->JDK8新特性<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/fanshe/1/" class="nav-link" aria-label="反射"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->反射<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/Maven/1/" class="nav-link" aria-label="Maven"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->Maven<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/baoguanli/1/" class="nav-link" aria-label="包管理"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->包管理<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/shujukuqudong/1/" class="nav-link" aria-label="数据库驱动"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->数据库驱动<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/JDBC/1/" class="nav-link" aria-label="JDBC"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->JDBC<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/shujuku/1/" class="nav-link" aria-label="数据库"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->数据库<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/MySQL/1/" class="nav-link" aria-label="MySQL"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->MySQL<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/MyBatis/1/" class="nav-link" aria-label="MyBatis"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->MyBatis<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/SpringMVC/1/" class="nav-link" aria-label="SpringMVC"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->SpringMVC<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/Spring5/1/" class="nav-link" aria-label="Spring5"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->Spring5<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/SSM/1/" class="nav-link" aria-label="SSM"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->SSM<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/lianjiechi/1/" class="nav-link" aria-label="连接池"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->连接池<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/DBUtils/1/" class="nav-link" aria-label="DBUtils"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->DBUtils<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/shiwu/1/" class="nav-link" aria-label="事务"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->事务<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/Mysql/1/" class="nav-link" aria-label="Mysql"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->Mysql<!--]--></span></a><!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="Link"><a class="icon-container left title" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->Link<!--]--></span></a><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="Link"><a class="icon-container left title" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->Link<!--]--></span></a><span class="right arrow"></span></button><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a class="nav-link" href="https://sneoo.com" rel="noopener noreferrer" target="_blank" aria-label="Typecho"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->Typecho<!--]--></span></a><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><!--]--></ul></div></div><!--]--></nav><a class="icon-container left btn-toggle-dark-mode" href="javascript:void(0)"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" style="color:inherit;width:20px;height:20px;font-size:20px;"><g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3h.393a7.5 7.5 0 0 0 7.92 12.446A9 9 0 1 1 12 2.992z"></path><path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0-2 2a2 2 0 0 0-2-2a2 2 0 0 0 2-2"></path><path d="M19 11h2m-1-1v2"></path></g></svg><!----></a></div></header><div class="sidebar-mask"></div><aside class="series-container"><nav class="navbar-links"><!--[--><div class="navbar-links-item"><a href="/" class="nav-link" aria-label="Home"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->Home<!--]--></span></a><!--[--><!--]--></a></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="Categories"><a class="icon-container left title" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->Categories<!--]--></span></a><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="Categories"><a class="icon-container left title" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->Categories<!--]--></span></a><span class="right arrow"></span></button><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/categories/JavaWEB/1/" class="nav-link" aria-label="JavaWEB"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->JavaWEB<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/categories/Javajichu/1/" class="nav-link" aria-label="Java基础"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->Java基础<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/categories/Maven/1/" class="nav-link" aria-label="Maven"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->Maven<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/categories/JDBC/1/" class="nav-link" aria-label="JDBC"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->JDBC<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/categories/MySQL/1/" class="nav-link" aria-label="MySQL"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->MySQL<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/categories/MyBatis/1/" class="nav-link" aria-label="MyBatis"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->MyBatis<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/categories/SpringMVC/1/" class="nav-link" aria-label="SpringMVC"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->SpringMVC<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/categories/Spring5/1/" class="nav-link" aria-label="Spring5"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->Spring5<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/categories/SSM/1/" class="nav-link" aria-label="SSM"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->SSM<!--]--></span></a><!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="Tags"><a class="icon-container left title" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->Tags<!--]--></span></a><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="Tags"><a class="icon-container left title" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->Tags<!--]--></span></a><span class="right arrow"></span></button><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/tags/JavaWEB/1/" class="nav-link" aria-label="JavaWEB"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->JavaWEB<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/shuchengxiangmu/1/" class="nav-link" aria-label="书城项目"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->书城项目<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/Javajichu/1/" class="nav-link" aria-label="Java基础"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->Java基础<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/yichang/1/" class="nav-link" aria-label="异常"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->异常<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/API/1/" class="nav-link" aria-label="API"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->API<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/duoxiancheng/1/" class="nav-link" aria-label="多线程"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->多线程<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/jihe/1/" class="nav-link" aria-label="集合"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->集合<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/zhengzebiaodashi/1/" class="nav-link" aria-label="正则表达式"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->正则表达式<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/IOliu/1/" class="nav-link" aria-label="IO流"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->IO流<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/wangluobiancheng/1/" class="nav-link" aria-label="网络编程"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->网络编程<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/JDK8xintexing/1/" class="nav-link" aria-label="JDK8新特性"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->JDK8新特性<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/fanshe/1/" class="nav-link" aria-label="反射"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->反射<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/Maven/1/" class="nav-link" aria-label="Maven"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->Maven<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/baoguanli/1/" class="nav-link" aria-label="包管理"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->包管理<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/shujukuqudong/1/" class="nav-link" aria-label="数据库驱动"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->数据库驱动<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/JDBC/1/" class="nav-link" aria-label="JDBC"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->JDBC<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/shujuku/1/" class="nav-link" aria-label="数据库"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->数据库<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/MySQL/1/" class="nav-link" aria-label="MySQL"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->MySQL<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/MyBatis/1/" class="nav-link" aria-label="MyBatis"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->MyBatis<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/SpringMVC/1/" class="nav-link" aria-label="SpringMVC"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->SpringMVC<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/Spring5/1/" class="nav-link" aria-label="Spring5"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->Spring5<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/SSM/1/" class="nav-link" aria-label="SSM"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->SSM<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/lianjiechi/1/" class="nav-link" aria-label="连接池"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->连接池<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/DBUtils/1/" class="nav-link" aria-label="DBUtils"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->DBUtils<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/shiwu/1/" class="nav-link" aria-label="事务"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->事务<!--]--></span></a><!--[--><!--]--></a></li><li class="dropdown-item"><a href="/tags/Mysql/1/" class="nav-link" aria-label="Mysql"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->Mysql<!--]--></span></a><!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="Link"><a class="icon-container left title" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->Link<!--]--></span></a><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="Link"><a class="icon-container left title" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->Link<!--]--></span></a><span class="right arrow"></span></button><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a class="nav-link" href="https://sneoo.com" rel="noopener noreferrer" target="_blank" aria-label="Typecho"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->Typecho<!--]--></span></a><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><!--]--></ul></div></div><!--]--></nav><!--[--><!--]--></aside><!--[--><main class="page-container show-catalog"><h1 class="page-title">day04.连接池-DBUtils-事务</h1><div class="page-info"><a class="icon-container left" href="javascript:void(0)"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" style="color:inherit;width:18px;height:18px;font-size:18px;"><g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="7" r="4"></circle><path d="M6 21v-2a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v2"></path></g></svg><span style="color:inherit;font-size:14px;"><!--[-->Kotena<!--]--></span></a><a class="icon-container left" href="javascript:void(0)"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" style="color:inherit;width:18px;height:18px;font-size:18px;"><g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="9"></circle><path d="M12 7v5l3 3"></path></g></svg><span style="color:inherit;font-size:14px;"><!--[-->2022-07-01 00:00:00<!--]--></span></a><a class="icon-container left" href="javascript:void(0)"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" style="color:inherit;width:18px;height:18px;font-size:18px;"><path d="M5 4h4l3 3h7a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg><span style="color:inherit;font-size:14px;"><!--[--><!--[--><a href="/categories/JDBC/1/" class="category">JDBC</a><!--]--><!--]--></span></a><a class="icon-container left" href="javascript:void(0)"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" style="color:inherit;width:18px;height:18px;font-size:18px;"><g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="8.5" cy="8.5" r="1" fill="currentColor"></circle><path d="M4 7v3.859c0 .537.213 1.052.593 1.432l8.116 8.116a2.025 2.025 0 0 0 2.864 0l4.834-4.834a2.025 2.025 0 0 0 0-2.864L12.29 4.593A2.025 2.025 0 0 0 10.859 4H7a3 3 0 0 0-3 3z"></path></g></svg><span style="color:inherit;font-size:14px;"><!--[--><!--[--><a href="/tags/数据库驱动/1/" class="tag">数据库驱动</a><a href="/tags/JDBC/1/" class="tag">JDBC</a><a href="/tags/连接池/1/" class="tag">连接池</a><a href="/tags/DBUtils/1/" class="tag">DBUtils</a><a href="/tags/事务/1/" class="tag">事务</a><a href="/tags/Mysql/1/" class="tag">Mysql</a><!--]--><!--]--></span></a><a class="icon-container left" href="javascript:void(0)"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" style="color:inherit;width:18px;height:18px;font-size:18px;"><g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="2"></circle><path d="M22 12c-2.667 4.667-6 7-10 7s-7.333-2.333-10-7c2.667-4.667 6-7 10-7s7.333 2.333 10 7"></path></g></svg><span style="color:inherit;font-size:14px;"><!--[--><span id="/blogs/jdbc/day04biji/day04.lianjiechi_DBUtils_shiwu.html" class="leancloud-visitors" data-flag-title="Your Article Title"><a class="leancloud-visitors-count" style=""></a></span><!--]--></span></a></div><div class="theme-reco-default-content"><div><h1 id="day04-连接池-dbutils-事务" tabindex="-1"><a class="header-anchor" href="#day04-连接池-dbutils-事务" aria-hidden="true">#</a> day04.连接池-DBUtils-事务</h1><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>课前回顾<span class="token operator">:</span>
   <span class="token number">1.</span>函数<span class="token operator">:</span>
     数学函数
     流程控制函数
     日期函数
   <span class="token number">2.</span>JDBC<span class="token operator">:</span>
     a<span class="token punctuation">.</span>注册驱动<span class="token operator">:</span><span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">&quot;com.mysql.cj.jdbc.Driver&quot;</span><span class="token punctuation">)</span>
     b<span class="token punctuation">.</span>获取连接<span class="token operator">:</span><span class="token class-name">DriverManager</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span>name<span class="token punctuation">,</span>password<span class="token punctuation">)</span>
               url<span class="token operator">:</span>  jdbc<span class="token operator">:</span>mysql<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token operator">:</span><span class="token number">3306</span><span class="token operator">/</span>数据库名字<span class="token operator">?</span>时区<span class="token operator">&amp;</span>批量添加
               name<span class="token operator">:</span>mysql用户名
               password<span class="token operator">:</span>mysql密码
     c<span class="token punctuation">.</span>获取执行平台<span class="token operator">:</span><span class="token class-name">Connection</span>接口中的方法<span class="token operator">:</span>
                  <span class="token class-name">Statement</span> <span class="token function">createStatement</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
     d<span class="token punctuation">.</span>执行sql<span class="token operator">:</span><span class="token class-name">Statement</span>中的方法<span class="token operator">:</span>
                  <span class="token keyword">int</span> <span class="token function">executeUpdate</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token operator">-&gt;</span>针对于增删改操作
                  <span class="token class-name">ResultSet</span> <span class="token function">executeQuery</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token operator">-&gt;</span>针对于查询操作
     e<span class="token punctuation">.</span>处理结果集<span class="token operator">:</span>
       针对于增删改操作不用处理结果集
       针对于查询操作用处理结果集
              <span class="token keyword">boolean</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span> 判断结果集中有没有下一个元素
              <span class="token function">getxxx</span><span class="token punctuation">(</span>列名<span class="token punctuation">)</span><span class="token operator">-&gt;</span>获取指定列名的数据
              <span class="token function">getxxx</span><span class="token punctuation">(</span>第几列<span class="token punctuation">)</span><span class="token operator">-&gt;</span>获取第几列数据
     f<span class="token punctuation">.</span>关闭资源<span class="token operator">:</span>统一用close方法
         
   <span class="token number">3.</span>预处理对象<span class="token operator">:</span><span class="token class-name">PreparedStatement</span> 是 <span class="token class-name">Statement</span>的子接口
     a<span class="token punctuation">.</span>特点<span class="token operator">:</span>支持占位符<span class="token operator">?</span>
     b<span class="token punctuation">.</span><span class="token function">setxxx</span><span class="token punctuation">(</span>第几个<span class="token operator">?</span><span class="token punctuation">,</span>赋值<span class="token punctuation">)</span>
     c<span class="token punctuation">.</span>获取<span class="token operator">:</span><span class="token class-name">Connection</span>中的方法
           <span class="token function">preparedStatement</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span>
     d<span class="token punctuation">.</span>执行sql<span class="token operator">:</span>
       <span class="token keyword">int</span> <span class="token function">executeUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span>针对于增删改操作
       <span class="token class-name">ResultSet</span> <span class="token function">executeQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span>针对于查询操作
          
   
 今日重点<span class="token operator">:</span>
  <span class="token number">1.</span>会使用<span class="token class-name">Druid</span><span class="token punctuation">(</span>德鲁伊<span class="token punctuation">)</span>连接池<span class="token punctuation">,</span><span class="token class-name">C3p0</span>连接池
  <span class="token number">2.</span>会使用<span class="token class-name">DBUtils</span>工具包操作数据库
  <span class="token number">3.</span>会使用<span class="token class-name">DBUtils</span>中的<span class="token class-name">ResultSetHandlder</span>下面的子类处理结果集
  <span class="token number">4.</span>会为代码添加事务
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="第一章-preparedstatement预处理对象" tabindex="-1"><a class="header-anchor" href="#第一章-preparedstatement预处理对象" aria-hidden="true">#</a> 第一章.PreparedStatement预处理对象</h1><div class="language-mysql ext-mysql line-numbers-mode"><pre class="language-mysql"><code>CREATE TABLE category(
  cid INT PRIMARY KEY AUTO_INCREMENT,
  cname VARCHAR(10)
);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_1-mysql批量添加数据" tabindex="-1"><a class="header-anchor" href="#_1-mysql批量添加数据" aria-hidden="true">#</a> 1.mysql批量添加数据</h2><div class="language-properties ext-properties line-numbers-mode"><pre class="language-properties"><code><span class="token key attr-name">properties配置文件中的url加上</span><span class="token punctuation">:</span><span class="token value attr-value">rewriteBatchedStatements=true</span>

<span class="token key attr-name">driver</span><span class="token punctuation">=</span><span class="token value attr-value">com.mysql.cj.jdbc.Driver</span>
<span class="token key attr-name">url</span><span class="token punctuation">=</span><span class="token value attr-value">jdbc:mysql://localhost:3306/220227_java4?serverTimezone=UTC&amp;rewriteBatchedStatements=true</span>
<span class="token key attr-name">username</span><span class="token punctuation">=</span><span class="token value attr-value">root</span>
<span class="token key attr-name">password</span><span class="token punctuation">=</span><span class="token value attr-value">root</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token number">1.</span>在设置完所有要添加的参数<span class="token punctuation">,</span>调用<span class="token class-name">PreparedStatement</span>中的<span class="token function">addBatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>将SQL语句添加到<span class="token class-name">PreparedStatement</span>中
<span class="token number">2.</span>调用<span class="token class-name">PreparedStatement</span>中的<span class="token function">executeBatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span>方法批处理sql语句
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
     * 批量添加
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">batchAdd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>
        <span class="token comment">//获取连接</span>
        <span class="token class-name">Connection</span> conn <span class="token operator">=</span> <span class="token class-name">JDBCUtils</span><span class="token punctuation">.</span><span class="token function">getConn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//准备sql</span>
        <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">&quot;insert into category (cname) values (?)&quot;</span><span class="token punctuation">;</span>
        <span class="token comment">//获取执行平台</span>
        <span class="token class-name">PreparedStatement</span> pst <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            pst<span class="token punctuation">.</span><span class="token function">setObject</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;箱包&quot;</span><span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">/*
              void addBatch()
              将一组参数添加到此 PreparedStatement 对象的批处理命令中
             */</span>
            pst<span class="token punctuation">.</span><span class="token function">addBatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">/*
          批量执行
          executeBatch() 将一批命令提交给数据库来执行，如果全部命令执行成功
         */</span>
        pst<span class="token punctuation">.</span><span class="token function">executeBatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//关闭资源</span>
        <span class="token class-name">JDBCUtils</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span>pst<span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="第二章-连接池" tabindex="-1"><a class="header-anchor" href="#第二章-连接池" aria-hidden="true">#</a> 第二章.连接池</h1><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token number">1.</span>问题<span class="token operator">:</span>
  之前的jdbc操作<span class="token punctuation">,</span>每执行一个操作<span class="token punctuation">,</span>就要获取一条连接对象<span class="token punctuation">(</span><span class="token class-name">Connection</span>对象<span class="token punctuation">)</span><span class="token punctuation">,</span>用完还要销毁<span class="token punctuation">,</span>这样会耗费内存资源
<span class="token number">2.</span>过程<span class="token operator">:</span>
  池子创建之后<span class="token punctuation">,</span>如果来了任务<span class="token punctuation">,</span>池子中有连接对象<span class="token punctuation">,</span>就直接用<span class="token punctuation">,</span>用完还回去
  不用频繁的去创建连接对象<span class="token punctuation">,</span>销毁连接对象
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://photo.sneoo.com/spring5/202207031648085.png" alt="image-20220408091246944"></p><img src="https://photo.sneoo.com/spring5/202207031648086.png" alt="image-20220408091724243" style="zoom:80%;"><h2 id="_1-连接池之c3p0" tabindex="-1"><a class="header-anchor" href="#_1-连接池之c3p0" aria-hidden="true">#</a> 1.连接池之C3p0</h2><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token number">1.</span>java为连接池提供了一个标准<span class="token punctuation">,</span>公共接口<span class="token operator">:</span><span class="token class-name"><span class="token namespace">javax<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span>DataSource</span><span class="token punctuation">,</span>不同的厂商如果想要实现自己的连接池<span class="token punctuation">,</span>就需要实现<span class="token class-name">DataSource</span>接口
<span class="token number">2.</span>常用的连接池<span class="token operator">:</span>
  <span class="token class-name">C3p0</span><span class="token punctuation">,</span>      <span class="token class-name">Druid</span><span class="token punctuation">(</span>最常用<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token number">1.</span>导jar包<span class="token operator">:</span>c3p0<span class="token operator">-</span><span class="token number">0.9</span><span class="token number">.1</span><span class="token number">.2</span><span class="token punctuation">.</span>jar
    
<span class="token number">2.</span>在resources下面创建c3p0<span class="token operator">-</span>config<span class="token punctuation">.</span>xml<span class="token operator">-&gt;</span>名字不能错
<span class="token number">3.</span>在xml中配置相关信息<span class="token operator">:</span>
<span class="token operator">&lt;</span>c3p0<span class="token operator">-</span>config<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 使用默认的配置读取连接池对象 <span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token keyword">default</span><span class="token operator">-</span>config<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>  连接参数 <span class="token operator">--</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">&quot;driverClass&quot;</span><span class="token operator">&gt;</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>mysql<span class="token punctuation">.</span>cj<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span></span>Driver</span><span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">&quot;jdbcUrl&quot;</span><span class="token operator">&gt;</span>jdbc<span class="token operator">:</span>mysql<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token operator">:</span><span class="token number">3306</span><span class="token operator">/</span><span class="token number">220212_</span>java4<span class="token operator">?</span>serverTimezone<span class="token operator">=</span>UTC<span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">&quot;user&quot;</span><span class="token operator">&gt;</span>root<span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">&quot;password&quot;</span><span class="token operator">&gt;</span>root<span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>

        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 
          连接池参数
          初始连接数<span class="token punctuation">(</span>initialPoolSize<span class="token punctuation">)</span>：刚创建好连接池的时候准备的连接数量
          最大连接数<span class="token punctuation">(</span>maxPoolSize<span class="token punctuation">)</span>：连接池中最多可以放多少个连接
          最大等待时间<span class="token punctuation">(</span>checkoutTimeout<span class="token punctuation">)</span>：连接池中没有连接时最长等待时间
          最大空闲回收时间<span class="token punctuation">(</span>maxIdleTime<span class="token punctuation">)</span>：连接池中的空闲连接多久没有使用就会回收
         <span class="token operator">--</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">&quot;initialPoolSize&quot;</span><span class="token operator">&gt;</span><span class="token number">5</span><span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">&quot;maxPoolSize&quot;</span><span class="token operator">&gt;</span><span class="token number">10</span><span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">&quot;checkoutTimeout&quot;</span><span class="token operator">&gt;</span><span class="token number">2000</span><span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">&quot;maxIdleTime&quot;</span><span class="token operator">&gt;</span><span class="token number">1000</span><span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token keyword">default</span><span class="token operator">-</span>config<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>c3p0<span class="token operator">-</span>config<span class="token operator">&gt;</span>
 
初始连接数<span class="token punctuation">(</span>initialPoolSize<span class="token punctuation">)</span>：刚创建好连接池的时候准备的连接数量
最大连接数<span class="token punctuation">(</span>maxPoolSize<span class="token punctuation">)</span>：连接池中最多可以放多少个连接
最大等待时间<span class="token punctuation">(</span>checkoutTimeout<span class="token punctuation">)</span>：连接池中没有连接时最长等待时间
最大空闲回收时间<span class="token punctuation">(</span>maxIdleTime<span class="token punctuation">)</span>：连接池中的空闲连接多久没有使用就会回收

<span class="token number">4.</span>编写工具类<span class="token operator">:</span>
  接口<span class="token operator">:</span><span class="token class-name">DataSource</span>
  c3p0连接池实现类<span class="token operator">:</span><span class="token class-name">ComboPooledDataSrouce</span>
  获取连接<span class="token punctuation">,</span>是在连接池中获取<span class="token operator">:</span><span class="token class-name">ComboPooledDataSrouce</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/*
  读取配置文件方式的工具类
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JDBCUtils_C3P0</span> <span class="token punctuation">{</span>
    <span class="token comment">//定义一个DataSource接口</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">DataSource</span> dataSource<span class="token punctuation">;</span>

    <span class="token keyword">static</span> <span class="token punctuation">{</span>
        <span class="token comment">//创建DataSource接口的实现类,此实现类是C3P0的连接池实现类对象</span>

        <span class="token comment">/*
          C3P0的连接池实现类对象会自动扫描resources资源包或者src下的c3p0-config.xml
          自动解析
         */</span>
        dataSource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ComboPooledDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * 获取连接
     */</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Connection</span> <span class="token function">getConn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//从连接池中获取连接</span>
        <span class="token class-name">Connection</span> connection <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            connection <span class="token operator">=</span> dataSource<span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> connection<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * 此时使用连接池之后close不再是关闭资源,而是将连接对象还给连接池
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token class-name">Connection</span> connection<span class="token punctuation">,</span> <span class="token class-name">Statement</span> st<span class="token punctuation">,</span> <span class="token class-name">ResultSet</span> rs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>rs <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                rs<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>


        <span class="token keyword">if</span> <span class="token punctuation">(</span>st <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                st<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>connection <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                connection<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>
        <span class="token comment">//获取连接-&gt;从连接池中获取的</span>
        <span class="token class-name">Connection</span> conn <span class="token operator">=</span> <span class="token class-name">JDBCUtils_C3P0</span><span class="token punctuation">.</span><span class="token function">getConn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//准备sql</span>
        <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">&quot;insert into category(cname) values (?)&quot;</span><span class="token punctuation">;</span>
        <span class="token comment">//获取预处理对象</span>
        <span class="token class-name">PreparedStatement</span> pst <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//为?赋值</span>
        pst<span class="token punctuation">.</span><span class="token function">setObject</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;蔬菜&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//执行sql</span>
        <span class="token keyword">int</span> i <span class="token operator">=</span> pst<span class="token punctuation">.</span><span class="token function">executeUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//关闭资源</span>
        <span class="token class-name">JDBCUtils_C3P0</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span>pst<span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_2-连接池之druid-德鲁伊" tabindex="-1"><a class="header-anchor" href="#_2-连接池之druid-德鲁伊" aria-hidden="true">#</a> 2.连接池之Druid(德鲁伊)</h2><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token number">1.</span>概述<span class="token operator">:</span><span class="token class-name">Druid</span>连接池是阿里巴巴开发的
<span class="token number">2.</span>好处<span class="token operator">:</span>性能好<span class="token punctuation">,</span>抗造
<span class="token number">3.</span>使用<span class="token operator">:</span>
  a<span class="token punctuation">.</span>到jar包<span class="token operator">:</span>druid<span class="token operator">-</span><span class="token number">1.1</span><span class="token number">.10</span><span class="token punctuation">.</span>jar
  b<span class="token punctuation">.</span>在resources或者src下编写properties配置文件<span class="token operator">-&gt;</span>druid<span class="token punctuation">.</span>properties
    driver<span class="token operator">=</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>mysql<span class="token punctuation">.</span>cj<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span></span>Driver</span>
    url<span class="token operator">=</span>jdbc<span class="token operator">:</span>mysql<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token operator">:</span><span class="token number">3306</span><span class="token operator">/</span><span class="token number">220227_</span>java4<span class="token operator">?</span>serverTimezone<span class="token operator">=</span>UTC<span class="token operator">&amp;</span>rewriteBatchedStatements<span class="token operator">=</span><span class="token boolean">true</span>
    username<span class="token operator">=</span>root
    password<span class="token operator">=</span>root
  c<span class="token punctuation">.</span>编写属于<span class="token class-name">Druid</span>的工具类
    <span class="token class-name">DruidDataSourceFactory</span><span class="token punctuation">.</span><span class="token function">createDataSource</span><span class="token punctuation">(</span><span class="token class-name">Properties</span>集合<span class="token punctuation">)</span><span class="token punctuation">;</span>返回的是<span class="token class-name">DataSource</span>接口的实现类
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DruidUtils</span> <span class="token punctuation">{</span>
    <span class="token comment">//定义一个DataSource接口</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">DataSource</span> dataSource<span class="token punctuation">;</span>

    <span class="token keyword">static</span> <span class="token punctuation">{</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">//创建Properties集合</span>
            <span class="token class-name">Properties</span> properties <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">InputStream</span> in <span class="token operator">=</span> <span class="token class-name">DruidUtils</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span><span class="token string">&quot;druid.properties&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            properties<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//利用DruidDataSourceFactory,根据properties集合创建属于 Druid的连接池对象</span>
            dataSource <span class="token operator">=</span> <span class="token class-name">DruidDataSourceFactory</span><span class="token punctuation">.</span><span class="token function">createDataSource</span><span class="token punctuation">(</span>properties<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * 获取连接
     */</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Connection</span> <span class="token function">getConn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//从连接池中获取连接</span>
        <span class="token class-name">Connection</span> connection <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            connection <span class="token operator">=</span> dataSource<span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> connection<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * 此时使用连接池之后close不再是关闭资源,而是将连接对象还给连接池
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token class-name">Connection</span> connection<span class="token punctuation">,</span> <span class="token class-name">Statement</span> st<span class="token punctuation">,</span> <span class="token class-name">ResultSet</span> rs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>rs <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                rs<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>


        <span class="token keyword">if</span> <span class="token punctuation">(</span>st <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                st<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>connection <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                connection<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>
        <span class="token comment">//获取连接-&gt;从连接池中获取的</span>
        <span class="token class-name">Connection</span> conn <span class="token operator">=</span> <span class="token class-name">DruidUtils</span><span class="token punctuation">.</span><span class="token function">getConn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//准备sql</span>
        <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">&quot;insert into category(cname) values (?)&quot;</span><span class="token punctuation">;</span>
        <span class="token comment">//获取预处理对象</span>
        <span class="token class-name">PreparedStatement</span> pst <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//为?赋值</span>
        pst<span class="token punctuation">.</span><span class="token function">setObject</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;水果&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//执行sql</span>
        <span class="token keyword">int</span> i <span class="token operator">=</span> pst<span class="token punctuation">.</span><span class="token function">executeUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//关闭资源</span>
        <span class="token class-name">DruidUtils</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span>pst<span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="第三章-dbutils工具包" tabindex="-1"><a class="header-anchor" href="#第三章-dbutils工具包" aria-hidden="true">#</a> 第三章.DBUtils工具包</h1><h2 id="_1-准备工作" tabindex="-1"><a class="header-anchor" href="#_1-准备工作" aria-hidden="true">#</a> 1.准备工作</h2><img src="https://photo.sneoo.com/spring5/202207031648087.png" alt="image-20220408101513751" style="zoom:80%;"><h2 id="_2-dbutils的介绍" tabindex="-1"><a class="header-anchor" href="#_2-dbutils的介绍" aria-hidden="true">#</a> 2.DBUtils的介绍</h2><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token number">1.</span>为什么要学<span class="token class-name">DBUtils</span><span class="token operator">:</span>使用原生的jdbc开发<span class="token punctuation">,</span>代码很多<span class="token punctuation">,</span>比较恶心<span class="token punctuation">,</span>会影响我们的开发效率<span class="token punctuation">,</span>而<span class="token class-name">DBUtils</span>可以大大的简化JDBC的开发
<span class="token number">2.</span>什么是<span class="token class-name">DBUtils</span><span class="token operator">:</span>是简化jdbc开发步骤的一个开发工具包
<span class="token number">3.</span>使用<span class="token operator">:</span>
  a<span class="token punctuation">.</span>导jar包<span class="token operator">:</span>commons<span class="token operator">-</span>dbutils<span class="token operator">-</span><span class="token number">1.6</span><span class="token punctuation">.</span>jar
<span class="token number">4.D</span>BUtils工具包中三大核心对象<span class="token operator">:</span>
  <span class="token class-name"><span class="token namespace">a<span class="token punctuation">.</span></span>QueryRunner</span><span class="token operator">:</span>定义了执行sql的方法<span class="token operator">-&gt;</span> 主要用的
  <span class="token class-name"><span class="token namespace">b<span class="token punctuation">.</span></span>ResultSetHandlder</span><span class="token operator">:</span>有很多处理结果集的对象 <span class="token operator">-&gt;</span> 主要用的
  <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span></span>Dbutils</span><span class="token operator">:</span>是<span class="token class-name">DBUtils</span>工具包中的一个类<span class="token punctuation">,</span>里面定义了很多关闭资源以及操作事务等方法
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-queryrunner" tabindex="-1"><a class="header-anchor" href="#_3-queryrunner" aria-hidden="true">#</a> 3.QueryRunner</h2><h3 id="_3-1-空参的queryrunner的介绍以及使用" tabindex="-1"><a class="header-anchor" href="#_3-1-空参的queryrunner的介绍以及使用" aria-hidden="true">#</a> 3.1.空参的QueryRunner的介绍以及使用</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token number">1.</span><span class="token function">QueryRunner</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  a<span class="token punctuation">.</span>特点<span class="token operator">:</span>需要我们自己维护连接对象<span class="token punctuation">(</span>需要自己获取连接对象<span class="token punctuation">,</span>释放连接对象<span class="token punctuation">)</span><span class="token punctuation">,</span>支持sql中使用占位符<span class="token operator">?</span>
<span class="token number">2.</span>方法<span class="token operator">:</span>
  a<span class="token punctuation">.</span><span class="token keyword">int</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">Connection</span> conn<span class="token punctuation">,</span> <span class="token class-name">String</span> sql<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> params<span class="token punctuation">)</span><span class="token operator">-&gt;</span>执行sql<span class="token punctuation">,</span>针对于增删改操作
               conn<span class="token operator">:</span>连接对象
               sql<span class="token operator">:</span>sql语句
               params<span class="token operator">:</span>可变参数<span class="token punctuation">,</span>给sql中的<span class="token operator">?</span>赋值
                      第一个值<span class="token punctuation">,</span>就是给第一个<span class="token operator">?</span>赋值<span class="token punctuation">,</span>自动匹配
                      第二个值<span class="token punctuation">,</span>就是给第二个<span class="token operator">?</span>赋值<span class="token punctuation">,</span>自动匹配
    比如<span class="token operator">:</span><span class="token function">update</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span><span class="token string">&quot;insert into category(cid,cname) values (?,?)&quot;</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;蔬菜&quot;</span><span class="token punctuation">)</span>
        
        <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;蔬菜&quot;</span><span class="token punctuation">}</span>
        <span class="token function">update</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span><span class="token string">&quot;insert into category(cid,cname) values (?,?)&quot;</span><span class="token punctuation">,</span>obj<span class="token punctuation">)</span>
            
  <span class="token class-name"><span class="token namespace">b<span class="token punctuation">.</span></span> T</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token class-name">Connection</span> conn<span class="token punctuation">,</span> <span class="token class-name">String</span> sql<span class="token punctuation">,</span> <span class="token class-name">ResultSetHandler</span>``<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span>`` rsh<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> params<span class="token punctuation">)</span><span class="token operator">-&gt;</span>针对于查询语句执行
               conn<span class="token operator">:</span>连接对象
               sql<span class="token operator">:</span>sql语句
               rsh<span class="token operator">:</span>处理结果集的方式
               params<span class="token operator">:</span>可变参数<span class="token punctuation">,</span>给sql中的<span class="token operator">?</span>赋值
                      第一个值<span class="token punctuation">,</span>就是给第一个<span class="token operator">?</span>赋值<span class="token punctuation">,</span>自动匹配
                      第二个值<span class="token punctuation">,</span>就是给第二个<span class="token operator">?</span>赋值<span class="token punctuation">,</span>自动匹配    
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test01</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>
        <span class="token comment">//创建空参的QueryRunner对象</span>
        <span class="token class-name">QueryRunner</span> qr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryRunner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//获取连接</span>
        <span class="token class-name">Connection</span> conn <span class="token operator">=</span> <span class="token class-name">DruidUtils</span><span class="token punctuation">.</span><span class="token function">getConn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//准备sql</span>
        <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">&quot;insert into category(cname) values (?)&quot;</span><span class="token punctuation">;</span>
        <span class="token comment">//执行sql</span>
        <span class="token comment">//qr.update(conn,sql,&quot;箱包&quot;);</span>


        <span class="token comment">/*
         由于update方法中的第三个参数是可变参数
         所以我们可以在外面定义一个Object数组
         将要给?赋的值放到数组中,然后再将数组
         放到update方法中
         */</span>
        <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;手机&quot;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        qr<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span>sql<span class="token punctuation">,</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//关闭资源</span>
        <span class="token class-name">DruidUtils</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>
        <span class="token comment">//创建空参的QueryRunner对象</span>
        <span class="token class-name">QueryRunner</span> qr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryRunner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//获取连接</span>
        <span class="token class-name">Connection</span> conn <span class="token operator">=</span> <span class="token class-name">DruidUtils</span><span class="token punctuation">.</span><span class="token function">getConn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//执行sql</span>
        qr<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span><span class="token string">&quot;insert into category(cname) values (?)&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;电脑&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//关闭资源</span>
        <span class="token class-name">DruidUtils</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-2-有参queryrunner的介绍以及使用" tabindex="-1"><a class="header-anchor" href="#_3-2-有参queryrunner的介绍以及使用" aria-hidden="true">#</a> 3.2.有参QueryRunner的介绍以及使用</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token number">1.</span>使用有参<span class="token class-name">QueryRunner</span>特点<span class="token operator">:</span>
  不需要我们自己维护连接<span class="token punctuation">,</span><span class="token class-name">QueryRunner</span>会自动维护连接对象
  说白了就是不需要自己从连接池中获取连接<span class="token punctuation">,</span>也不需要我们自己关闭或者归还连接池
<span class="token number">2.</span>构造<span class="token operator">:</span>
  <span class="token class-name">QueryRunner</span><span class="token punctuation">(</span><span class="token class-name">DataSource</span> ds<span class="token punctuation">)</span>
              <span class="token class-name">DataSource</span><span class="token operator">:</span>传递连接池对象
<span class="token number">3.</span>方法<span class="token operator">:</span>
  <span class="token keyword">int</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">String</span> sql<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> params<span class="token punctuation">)</span><span class="token operator">-&gt;</span>针对于增删改操作
             sql<span class="token operator">:</span>sql语句
             params<span class="token operator">:</span>可变参数<span class="token punctuation">,</span>给sql中的<span class="token operator">?</span>赋值
                    第一个值<span class="token punctuation">,</span>就是给第一个<span class="token operator">?</span>赋值<span class="token punctuation">,</span>自动匹配
                    第二个值<span class="token punctuation">,</span>就是给第二个<span class="token operator">?</span>赋值<span class="token punctuation">,</span>自动匹配  
  <span class="token class-name">T</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token class-name">String</span> sql<span class="token punctuation">,</span> <span class="token class-name">ResultSetHandler</span>``<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span>`` rsh<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> params<span class="token punctuation">)</span>
             sql<span class="token operator">:</span>sql语句
             rsh<span class="token operator">:</span>处理结果集的方式
             params<span class="token operator">:</span>可变参数<span class="token punctuation">,</span>给sql中的<span class="token operator">?</span>赋值
                    第一个值<span class="token punctuation">,</span>就是给第一个<span class="token operator">?</span>赋值<span class="token punctuation">,</span>自动匹配
                    第二个值<span class="token punctuation">,</span>就是给第二个<span class="token operator">?</span>赋值<span class="token punctuation">,</span>自动匹配        
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//改造工具类</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DruidUtils</span> <span class="token punctuation">{</span>
    <span class="token comment">//定义一个DataSource接口</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">DataSource</span> dataSource<span class="token punctuation">;</span>

    <span class="token keyword">static</span> <span class="token punctuation">{</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">//创建Properties集合</span>
            <span class="token class-name">Properties</span> properties <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">InputStream</span> in <span class="token operator">=</span> <span class="token class-name">DruidUtils</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span><span class="token string">&quot;druid.properties&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            properties<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//利用DruidDataSourceFactory,根据properties集合创建属于 Druid的连接池对象</span>
            dataSource <span class="token operator">=</span> <span class="token class-name">DruidDataSourceFactory</span><span class="token punctuation">.</span><span class="token function">createDataSource</span><span class="token punctuation">(</span>properties<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * 获取连接
     */</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Connection</span> <span class="token function">getConn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//从连接池中获取连接</span>
        <span class="token class-name">Connection</span> connection <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            connection <span class="token operator">=</span> dataSource<span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> connection<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token doc-comment comment">/**
     * 新加的方法
     * 获取连接池对象
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">DataSource</span> <span class="token function">getDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> dataSource<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>



    <span class="token doc-comment comment">/**
     * 此时使用连接池之后close不再是关闭资源,而是将连接对象还给连接池
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token class-name">Connection</span> connection<span class="token punctuation">,</span> <span class="token class-name">Statement</span> st<span class="token punctuation">,</span> <span class="token class-name">ResultSet</span> rs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>rs <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                rs<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>


        <span class="token keyword">if</span> <span class="token punctuation">(</span>st <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                st<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>connection <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                connection<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test02</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>
        <span class="token comment">//创建QueryRunner对象</span>
        <span class="token class-name">QueryRunner</span> qr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryRunner</span><span class="token punctuation">(</span><span class="token class-name">DruidUtils</span><span class="token punctuation">.</span><span class="token function">getDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//准备sql</span>
        <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">&quot;insert into category (cname) values (?)&quot;</span><span class="token punctuation">;</span>
        <span class="token comment">//执行sql</span>
        qr<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span><span class="token string">&quot;鼠标&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>
        <span class="token comment">//创建QueryRunner对象</span>
        <span class="token class-name">QueryRunner</span> qr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryRunner</span><span class="token punctuation">(</span><span class="token class-name">DruidUtils</span><span class="token punctuation">.</span><span class="token function">getDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//执行sql</span>
        qr<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token string">&quot;delete from category where cid = ?&quot;</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-resultsethandler结果集" tabindex="-1"><a class="header-anchor" href="#_4-resultsethandler结果集" aria-hidden="true">#</a> 4.ResultSetHandler结果集</h2><h3 id="_4-1-标准的javabean" tabindex="-1"><a class="header-anchor" href="#_4-1-标准的javabean" aria-hidden="true">#</a> 4.1.标准的JavaBean</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>什么是<span class="token class-name">JavaBean</span><span class="token operator">:</span>实体类
开发的过程中<span class="token operator">:</span><span class="token class-name">JavaBean</span>中的成员变量要和具体表中的字段要对应
一个标准的<span class="token class-name">JavaBean</span>如何编写<span class="token operator">:</span>成员变量   构造    get<span class="token operator">/</span>set 方法    hashcode和equals方法  toString
                        此类还需要实现<span class="token class-name">Serializable</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://photo.sneoo.com/spring5/202207031648088.png" alt="1599356773135"></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Category</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> cid<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> cname<span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token number">1.</span>要求<span class="token operator">:</span>定义javabean的时候里面的字段类型都要是引用数据类型<span class="token punctuation">,</span>基本类型的字段也要写成包装类
<span class="token number">2.</span>问题<span class="token operator">:</span>为什么定义javabean的时候<span class="token punctuation">,</span>要使用包装类呢<span class="token operator">?</span>
  a<span class="token punctuation">.</span>因为包装类的默认值为NULL<span class="token punctuation">,</span>如果我们的主键是自增<span class="token punctuation">,</span>sql语句可以写成<span class="token operator">:</span>
    insert into <span class="token function">category</span><span class="token punctuation">(</span>cid<span class="token punctuation">,</span>cname<span class="token punctuation">)</span> values <span class="token punctuation">(</span>NULL<span class="token punctuation">,</span><span class="token char">&#39;蔬菜&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  b<span class="token punctuation">.</span>使用包装类<span class="token punctuation">,</span>如果有需要的话<span class="token punctuation">,</span>可以直接调用包装类中的方法操作字段数据
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><img src="https://photo.sneoo.com/spring5/202207031648089.png" alt="image-20220408113147735" style="zoom:80%;"><h3 id="_4-2-beanhandler-t" tabindex="-1"><a class="header-anchor" href="#_4-2-beanhandler-t" aria-hidden="true">#</a> 4.2.BeanHandler<code>&lt;T&gt;</code></h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token number">1.</span>作用<span class="token operator">:</span>将查询出来的结果集中的第一行数据封装成javabean对象
<span class="token number">2.</span>方法<span class="token operator">:</span>
  <span class="token function">query</span><span class="token punctuation">(</span><span class="token class-name">String</span> sql<span class="token punctuation">,</span> <span class="token class-name">ResultSetHandler</span>``<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span>`` rsh<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> params<span class="token punctuation">)</span><span class="token operator">&gt;</span>有参<span class="token class-name">QueryRunner</span>时使用
  <span class="token function">query</span><span class="token punctuation">(</span><span class="token class-name">Connection</span> conn<span class="token punctuation">,</span> <span class="token class-name">String</span> sql<span class="token punctuation">,</span> <span class="token class-name">ResultSetHandler</span>``<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span>`` rsh<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> params<span class="token punctuation">)</span><span class="token operator">-&gt;</span>空参<span class="token class-name">QueryRunner</span>时使用
<span class="token number">3.</span>构造<span class="token operator">:</span>
  <span class="token class-name">BeanHandler</span><span class="token punctuation">(</span><span class="token class-name">Class</span> type<span class="token punctuation">)</span>
  传递的<span class="token keyword">class</span>对象其实就是我们想要封装的javabbean类的<span class="token keyword">class</span>对象
  想将查询出来的数据封装成哪个javabean对象<span class="token punctuation">,</span>就写哪个javabean的<span class="token keyword">class</span>对象
<span class="token number">4.</span>怎么理解<span class="token operator">:</span>
  将查询出来的数据为javabean中的成员变量赋值
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">beanHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>
        <span class="token class-name">QueryRunner</span> qr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryRunner</span><span class="token punctuation">(</span><span class="token class-name">DruidUtils</span><span class="token punctuation">.</span><span class="token function">getDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Category</span> category <span class="token operator">=</span> qr<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;select * from category&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">BeanHandler</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">Category</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>category<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-3-beanlisthandler-t" tabindex="-1"><a class="header-anchor" href="#_4-3-beanlisthandler-t" aria-hidden="true">#</a> 4.3.BeanListHandler<code>&lt;T&gt;</code></h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token number">1.</span>作用<span class="token operator">:</span>将查询出来的结果每一条数据都封装成一个一个的javabean对象<span class="token punctuation">,</span>将这些javabean对象放到<span class="token class-name">List</span>集合中
<span class="token number">2.</span>构造<span class="token operator">:</span>
  <span class="token class-name">BeanListHandler</span><span class="token punctuation">(</span><span class="token class-name">Class</span> type<span class="token punctuation">)</span>
  传递的<span class="token keyword">class</span>对象其实就是我们想要封装的javabbean类的<span class="token keyword">class</span>对象
  想将查询出来的数据封装成哪个javabean对象<span class="token punctuation">,</span>就写哪个javabean的<span class="token keyword">class</span>对象
      
<span class="token number">3.</span>怎么理解<span class="token operator">:</span>
  将查询出来的多条数据封装成多个javabean对象<span class="token punctuation">,</span>将多个javabean对象放到<span class="token class-name">List</span>集合中
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">beanListHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>
        <span class="token class-name">QueryRunner</span> qr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryRunner</span><span class="token punctuation">(</span><span class="token class-name">DruidUtils</span><span class="token punctuation">.</span><span class="token function">getDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Category</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> qr<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;select * from category&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">BeanListHandler</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">Category</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Category</span> category <span class="token operator">:</span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>category<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-4-scalarhandler" tabindex="-1"><a class="header-anchor" href="#_4-4-scalarhandler" aria-hidden="true">#</a> 4.4.ScalarHandler</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token number">1.</span>作用<span class="token operator">:</span>主要是处理单值的查询结果的<span class="token punctuation">,</span>执行的select语句<span class="token punctuation">,</span>结果集只有<span class="token number">1</span>个
<span class="token number">2.</span>构造<span class="token operator">:</span>
  <span class="token class-name">ScalarHandler</span><span class="token punctuation">(</span><span class="token keyword">int</span> columnIndex<span class="token punctuation">)</span><span class="token operator">-&gt;</span>不常用<span class="token operator">-&gt;</span>指定第几列
  <span class="token class-name">ScalarHandler</span><span class="token punctuation">(</span><span class="token class-name">String</span> columnName<span class="token punctuation">)</span><span class="token operator">-&gt;</span>不常用<span class="token operator">-&gt;</span>指定列名
  <span class="token class-name">ScalarHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span>常用
<span class="token number">3.</span>注意<span class="token operator">:</span>
  <span class="token class-name">ScalarHandler</span>和聚合函数使用更有意义
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">scalarHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>
        <span class="token class-name">QueryRunner</span> qr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryRunner</span><span class="token punctuation">(</span><span class="token class-name">DruidUtils</span><span class="token punctuation">.</span><span class="token function">getDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//Object o1 = qr.query(&quot;select * from category&quot;, new ScalarHandler&lt;&gt;(2));</span>
        <span class="token comment">//Object o2 = qr.query(&quot;select * from category&quot;, new ScalarHandler&lt;&gt;(&quot;cname&quot;));</span>
        <span class="token comment">//System.out.println(o2);</span>

        <span class="token class-name">Object</span> o3 <span class="token operator">=</span> qr<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;select count(*) from category&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ScalarHandler</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>o3<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-5-columnlisthandler" tabindex="-1"><a class="header-anchor" href="#_4-5-columnlisthandler" aria-hidden="true">#</a> 4.5.ColumnListHandler</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token number">1.</span>作用<span class="token operator">:</span>将查询出来的结果中的某一列数据<span class="token punctuation">,</span>存储到<span class="token class-name">List</span>集合中
<span class="token number">2.</span>构造<span class="token operator">:</span>
  <span class="token class-name">ColumnListHandler</span><span class="token punctuation">(</span><span class="token keyword">int</span> columnIndex<span class="token punctuation">)</span><span class="token operator">-&gt;</span>指定第几列
  <span class="token class-name">ColumnListHandler</span><span class="token punctuation">(</span><span class="token class-name">String</span> columnName<span class="token punctuation">)</span><span class="token operator">-&gt;</span>指定列名
  <span class="token class-name">ColumnListHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span> 默认显示查询结果中的第一列数据
<span class="token number">3.</span>注意<span class="token operator">:</span>
 <span class="token class-name">ColumnListHandler</span>可以指定泛型类型<span class="token punctuation">,</span>如果不指定<span class="token punctuation">,</span>返回的<span class="token class-name">List</span>泛型就是<span class="token class-name">Object</span>类型
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token class-name">ColumnListHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>
        <span class="token class-name">QueryRunner</span> qr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryRunner</span><span class="token punctuation">(</span><span class="token class-name">DruidUtils</span><span class="token punctuation">.</span><span class="token function">getDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//List&lt;Object&gt; list = qr.query(&quot;select * from category&quot;, new ColumnListHandler&lt;&gt;());</span>
        <span class="token comment">//List&lt;Object&gt; list = qr.query(&quot;select * from category&quot;, new ColumnListHandler&lt;&gt;(2));</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> qr<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;select * from category&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ColumnListHandler</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token string">&quot;cname&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Object</span> o <span class="token operator">:</span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="第四章-事务" tabindex="-1"><a class="header-anchor" href="#第四章-事务" aria-hidden="true">#</a> 第四章.事务</h1><h2 id="_1-事务" tabindex="-1"><a class="header-anchor" href="#_1-事务" aria-hidden="true">#</a> 1.事务</h2><h3 id="_1-1-事务-转账分析图" tabindex="-1"><a class="header-anchor" href="#_1-1-事务-转账分析图" aria-hidden="true">#</a> 1.1.事务_转账分析图</h3><img src="https://photo.sneoo.com/spring5/202207031648090.png" alt="image-20220408140654840" style="zoom:80%;"><div class="language-mysql ext-mysql line-numbers-mode"><pre class="language-mysql"><code>CREATE TABLE account(
  `name` VARCHAR(10),
  money INT
);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-2-实现转账-不加事务" tabindex="-1"><a class="header-anchor" href="#_1-2-实现转账-不加事务" aria-hidden="true">#</a> 1.2.实现转账(不加事务)</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test01Transfer</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">transfer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>
        <span class="token comment">//创建QueryRunner对象</span>
        <span class="token class-name">QueryRunner</span> qr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryRunner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//获取连接</span>
        <span class="token class-name">Connection</span> conn <span class="token operator">=</span> <span class="token class-name">DruidUtils</span><span class="token punctuation">.</span><span class="token function">getConn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//减钱的sql</span>
        <span class="token class-name">String</span> sqlOut <span class="token operator">=</span> <span class="token string">&quot;update account set money= money-1000 where name = ?&quot;</span><span class="token punctuation">;</span>

        <span class="token comment">//加钱的sql</span>
        <span class="token class-name">String</span> sqlIn <span class="token operator">=</span> <span class="token string">&quot;update account set money= money+1000 where name = ?&quot;</span><span class="token punctuation">;</span>

        <span class="token comment">//执行sql</span>
        qr<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span>sqlOut<span class="token punctuation">,</span><span class="token string">&quot;涛哥&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//制造错误,模仿断网</span>
        <span class="token comment">//System.out.println(1/0);</span>

        qr<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span>sqlIn<span class="token punctuation">,</span><span class="token string">&quot;茜茜&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//关闭资源</span>
        <span class="token class-name">DruidUtils</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-3-事务的介绍" tabindex="-1"><a class="header-anchor" href="#_1-3-事务的介绍" aria-hidden="true">#</a> 1.3.事务的介绍</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token number">1.</span>作用<span class="token operator">:</span>主要是用于管理一组操作的<span class="token punctuation">,</span>让这组操作<span class="token punctuation">(</span>一组操作可能包含了多条sql<span class="token punctuation">)</span><span class="token punctuation">,</span>要么全部成功<span class="token punctuation">,</span>要么全部失败
<span class="token number">2.</span>注意<span class="token operator">:</span>
  mysql自带事务<span class="token punctuation">,</span>但是这个事务一次只能管理一条sql<span class="token punctuation">,</span>如果想要事务管理多条sql<span class="token punctuation">,</span>需要将mysql自带事务关闭<span class="token punctuation">,</span>开启手动事务
<span class="token number">3.</span>如何手动管理事务<span class="token operator">?</span> <span class="token class-name">Connection</span>对象中的方法
  <span class="token keyword">void</span> <span class="token function">setAutoCommit</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span>关闭mysql自带事务<span class="token punctuation">,</span>开启手动事务
  <span class="token keyword">void</span> <span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> 提交事务<span class="token operator">-&gt;</span>当事务一旦提交<span class="token punctuation">,</span>管理的sql数据将永久保存<span class="token punctuation">,</span>回不去了
  <span class="token keyword">void</span> <span class="token function">rollback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> 回滚事务<span class="token operator">-&gt;</span>如果事务不提交<span class="token punctuation">(</span>commit<span class="token punctuation">)</span>的话<span class="token punctuation">,</span>调用此方法<span class="token punctuation">,</span>可以将数据还原回去
<span class="token number">4.</span>注意<span class="token operator">:</span>
  以上三个方法<span class="token punctuation">,</span>必须是同一条连接对象调用<span class="token punctuation">,</span>不然无法完成手动事务管理
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>总结:</p><p>1.事务可以管理多条sql.使其要么全成功,要么全失败</p><p>2.mysql自带事务管理,但是一个事务只管理一条sql</p><p>3.所以我们如果想让事务管理一组操作,需要关闭mysql自带事务,开启手动事务</p><p>4.开启事务,提交事务,回滚事务的方法都需要同一个Connection对象调用</p></blockquote><h3 id="_1-4-dbutils实现转账-添加事务" tabindex="-1"><a class="header-anchor" href="#_1-4-dbutils实现转账-添加事务" aria-hidden="true">#</a> 1.4.DBUtils实现转账(添加事务)</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test01Transfer</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">transfer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{</span>
        <span class="token comment">//创建QueryRunner对象</span>
        <span class="token class-name">QueryRunner</span> qr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryRunner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//获取连接</span>
        <span class="token class-name">Connection</span> conn <span class="token operator">=</span> <span class="token class-name">DruidUtils</span><span class="token punctuation">.</span><span class="token function">getConn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span><span class="token punctuation">{</span>
            <span class="token comment">//开启手动事务</span>
            conn<span class="token punctuation">.</span><span class="token function">setAutoCommit</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//减钱的sql</span>
            <span class="token class-name">String</span> sqlOut <span class="token operator">=</span> <span class="token string">&quot;update account set money= money-1000 where name = ?&quot;</span><span class="token punctuation">;</span>

            <span class="token comment">//加钱的sql</span>
            <span class="token class-name">String</span> sqlIn <span class="token operator">=</span> <span class="token string">&quot;update account set money= money+1000 where name = ?&quot;</span><span class="token punctuation">;</span>

            <span class="token comment">//执行sql</span>
            qr<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span>sqlOut<span class="token punctuation">,</span><span class="token string">&quot;涛哥&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//制造错误,模仿断网</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">/</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            qr<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span>sqlIn<span class="token punctuation">,</span><span class="token string">&quot;茜茜&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//提交事务</span>
            conn<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;转账成功&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">//回滚事务</span>
            conn<span class="token punctuation">.</span><span class="token function">rollback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;转账失败&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>
            <span class="token comment">//关闭资源</span>
            <span class="token class-name">DruidUtils</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-5-mysql中操作事务-了解" tabindex="-1"><a class="header-anchor" href="#_1-5-mysql中操作事务-了解" aria-hidden="true">#</a> 1.5.mysql中操作事务_了解</h3><div class="language-mysql ext-mysql line-numbers-mode"><pre class="language-mysql"><code>1.开启事务:begin
2.提交事务:commit
3.回滚事务:rollback
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">-- 开启事务</span>
<span class="token keyword">BEGIN</span><span class="token punctuation">;</span>

<span class="token keyword">UPDATE</span> account <span class="token keyword">SET</span> money <span class="token operator">=</span> money<span class="token operator">-</span><span class="token number">1000</span> <span class="token keyword">WHERE</span> <span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span> <span class="token operator">=</span> <span class="token string">&#39;涛哥&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">UPDATE</span> account <span class="token keyword">SET</span> money <span class="token operator">=</span> money<span class="token operator">+</span><span class="token number">1000</span> <span class="token keyword">WHERE</span> <span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span> <span class="token operator">=</span> <span class="token string">&#39;茜茜&#39;</span><span class="token punctuation">;</span>

<span class="token comment">-- 提交事务</span>
<span class="token keyword">COMMIT</span><span class="token punctuation">;</span>

<span class="token comment">-- 回滚事务</span>
<span class="token keyword">ROLLBACK</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-6-分层思想介绍以及架构搭建" tabindex="-1"><a class="header-anchor" href="#_1-6-分层思想介绍以及架构搭建" aria-hidden="true">#</a> 1.6.分层思想介绍以及架构搭建</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>三层架构思想<span class="token operator">:</span> 表现层<span class="token punctuation">(</span>web<span class="token punctuation">)</span>   业务层<span class="token punctuation">(</span>service<span class="token punctuation">)</span>   持久层<span class="token punctuation">(</span>dao<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><img src="https://photo.sneoo.com/spring5/202207031648091.png" alt="image-20220408144633497" style="zoom:80%;"><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>创建<span class="token keyword">package</span><span class="token operator">:</span>包名都是小写单词<span class="token punctuation">;</span>公司域名倒着写

com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>web<span class="token operator">-&gt;</span> 表现层<span class="token punctuation">,</span>和页面打交道<span class="token punctuation">,</span>这里面的类用于接收请求和回响应
com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>service<span class="token operator">-&gt;</span>业务层<span class="token punctuation">,</span>写业务
com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>dao<span class="token operator">-&gt;</span>持久层<span class="token punctuation">,</span>和数据库打交道
com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>pojo<span class="token operator">-&gt;</span>javabean实体类
com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>utils<span class="token operator">-&gt;</span> 工具类
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><img src="https://photo.sneoo.com/spring5/202207031648092.png" alt="image-20220408145012436" style="zoom:80%;"><h4 id="_1-6-1-转账-web层实现" tabindex="-1"><a class="header-anchor" href="#_1-6-1-转账-web层实现" aria-hidden="true">#</a> 1.6.1.转账_web层实现</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AccountController</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//创建Scanner</span>
        <span class="token class-name">Scanner</span> sc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scanner</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;请您输入出钱的人:&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> outName <span class="token operator">=</span> sc<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;请您输入收钱的人:&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> inName <span class="token operator">=</span> sc<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;请您输入转账金额:&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> money <span class="token operator">=</span> sc<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        
        <span class="token comment">//将outName,inName,money传递到service层</span>
        <span class="token class-name">AccountService</span> accountService <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AccountService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        accountService<span class="token punctuation">.</span><span class="token function">transfer</span><span class="token punctuation">(</span>outName<span class="token punctuation">,</span>inName<span class="token punctuation">,</span>money<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>温馨小提示:</p><p>开发中对一个方法的注释:一般用文档注释</p></blockquote><h4 id="_1-6-2-转账-service层实现" tabindex="-1"><a class="header-anchor" href="#_1-6-2-转账-service层实现" aria-hidden="true">#</a> 1.6.2.转账_service层实现</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AccountService</span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * <span class="token keyword">@param</span> <span class="token parameter">outName</span>  出钱人姓名
     * <span class="token keyword">@param</span> <span class="token parameter">inName</span>   收钱人姓名
     * <span class="token keyword">@param</span> <span class="token parameter">money</span>    转账金额
     */</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">transfer</span><span class="token punctuation">(</span><span class="token class-name">String</span> outName<span class="token punctuation">,</span> <span class="token class-name">String</span> inName<span class="token punctuation">,</span> <span class="token keyword">int</span> money<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//直接将数据传递给dao</span>
        <span class="token class-name">AccountDao</span> accountDao <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AccountDao</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span><span class="token punctuation">{</span>
            <span class="token comment">//减钱</span>
            accountDao<span class="token punctuation">.</span><span class="token function">outMoney</span><span class="token punctuation">(</span>outName<span class="token punctuation">,</span>money<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//System.out.println(1/0);</span>

            <span class="token comment">//加钱</span>
            accountDao<span class="token punctuation">.</span><span class="token function">inMoney</span><span class="token punctuation">(</span>inName<span class="token punctuation">,</span>money<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;转账成功&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;转账失败&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>


    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_1-6-3-转账-dao层实现" tabindex="-1"><a class="header-anchor" href="#_1-6-3-转账-dao层实现" aria-hidden="true">#</a> 1.6.3.转账_dao层实现</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AccountDao</span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * 转钱方法
     * <span class="token keyword">@param</span> <span class="token parameter">outName</span>  出钱人姓名
     * <span class="token keyword">@param</span> <span class="token parameter">money</span>    金额
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">outMoney</span><span class="token punctuation">(</span><span class="token class-name">String</span> outName<span class="token punctuation">,</span> <span class="token keyword">int</span> money<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">//创建QueryRunner对象</span>
        <span class="token class-name">QueryRunner</span> qr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryRunner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//获取连接</span>
        <span class="token class-name">Connection</span> conn <span class="token operator">=</span> <span class="token class-name">DruidUtils</span><span class="token punctuation">.</span><span class="token function">getConn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//准备sql</span>
        <span class="token class-name">String</span> outSql <span class="token operator">=</span> <span class="token string">&quot;update account set money = money-? where name = ?&quot;</span><span class="token punctuation">;</span>
        <span class="token comment">//执行sql</span>
        qr<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span>outSql<span class="token punctuation">,</span>money<span class="token punctuation">,</span>outName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//关闭资源</span>
        <span class="token class-name">DruidUtils</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * 加钱方法
     * <span class="token keyword">@param</span> <span class="token parameter">inName</span>  收钱人姓名
     * <span class="token keyword">@param</span> <span class="token parameter">money</span>   金额
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">inMoney</span><span class="token punctuation">(</span><span class="token class-name">String</span> inName<span class="token punctuation">,</span> <span class="token keyword">int</span> money<span class="token punctuation">)</span><span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">//创建QueryRunner对象</span>
        <span class="token class-name">QueryRunner</span> qr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryRunner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//获取连接</span>
        <span class="token class-name">Connection</span> conn <span class="token operator">=</span> <span class="token class-name">DruidUtils</span><span class="token punctuation">.</span><span class="token function">getConn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//准备sql</span>
        <span class="token class-name">String</span> inSql <span class="token operator">=</span> <span class="token string">&quot;update account set money = money+? where name = ?&quot;</span><span class="token punctuation">;</span>
        <span class="token comment">//执行sql</span>
        qr<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span>inSql<span class="token punctuation">,</span>money<span class="token punctuation">,</span>inName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//关闭资源</span>
        <span class="token class-name">DruidUtils</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_1-6-4-在service层添加事务-传递连接" tabindex="-1"><a class="header-anchor" href="#_1-6-4-在service层添加事务-传递连接" aria-hidden="true">#</a> 1.6.4.在service层添加事务(传递连接)</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AccountService</span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * <span class="token keyword">@param</span> <span class="token parameter">outName</span>  出钱人姓名
     * <span class="token keyword">@param</span> <span class="token parameter">inName</span>   收钱人姓名
     * <span class="token keyword">@param</span> <span class="token parameter">money</span>    转账金额
     */</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">transfer</span><span class="token punctuation">(</span><span class="token class-name">String</span> outName<span class="token punctuation">,</span> <span class="token class-name">String</span> inName<span class="token punctuation">,</span> <span class="token keyword">int</span> money<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//直接将数据传递给dao</span>
        <span class="token class-name">AccountDao</span> accountDao <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AccountDao</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//获取连接</span>
        <span class="token class-name">Connection</span> conn <span class="token operator">=</span> <span class="token class-name">DruidUtils</span><span class="token punctuation">.</span><span class="token function">getConn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span><span class="token punctuation">{</span>
            <span class="token comment">//开启手动事务</span>
            conn<span class="token punctuation">.</span><span class="token function">setAutoCommit</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//减钱</span>
            accountDao<span class="token punctuation">.</span><span class="token function">outMoney</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span>outName<span class="token punctuation">,</span>money<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">/</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//加钱</span>
            accountDao<span class="token punctuation">.</span><span class="token function">inMoney</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span>inName<span class="token punctuation">,</span>money<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//提交事务</span>
            conn<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;转账成功&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">//回滚事务</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                conn<span class="token punctuation">.</span><span class="token function">rollback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;转账失败&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                ex<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>
            <span class="token class-name">DruidUtils</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>


    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_1-6-5-修改dao层代码" tabindex="-1"><a class="header-anchor" href="#_1-6-5-修改dao层代码" aria-hidden="true">#</a> 1.6.5.修改dao层代码</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AccountDao</span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * 转钱方法
     * <span class="token keyword">@param</span> <span class="token parameter">outName</span>  出钱人姓名
     * <span class="token keyword">@param</span> <span class="token parameter">money</span>    金额
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">outMoney</span><span class="token punctuation">(</span><span class="token class-name">Connection</span> conn<span class="token punctuation">,</span><span class="token class-name">String</span> outName<span class="token punctuation">,</span> <span class="token keyword">int</span> money<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">//创建QueryRunner对象</span>
        <span class="token class-name">QueryRunner</span> qr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryRunner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//准备sql</span>
        <span class="token class-name">String</span> outSql <span class="token operator">=</span> <span class="token string">&quot;update account set money = money-? where name = ?&quot;</span><span class="token punctuation">;</span>
        <span class="token comment">//执行sql</span>
        qr<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span>outSql<span class="token punctuation">,</span>money<span class="token punctuation">,</span>outName<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * 加钱方法
     * <span class="token keyword">@param</span> <span class="token parameter">inName</span>  收钱人姓名
     * <span class="token keyword">@param</span> <span class="token parameter">money</span>   金额
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">inMoney</span><span class="token punctuation">(</span><span class="token class-name">Connection</span> conn<span class="token punctuation">,</span><span class="token class-name">String</span> inName<span class="token punctuation">,</span> <span class="token keyword">int</span> money<span class="token punctuation">)</span><span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">//创建QueryRunner对象</span>
        <span class="token class-name">QueryRunner</span> qr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryRunner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//准备sql</span>
        <span class="token class-name">String</span> inSql <span class="token operator">=</span> <span class="token string">&quot;update account set money = money+? where name = ?&quot;</span><span class="token punctuation">;</span>
        <span class="token comment">//执行sql</span>
        qr<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span>inSql<span class="token punctuation">,</span>money<span class="token punctuation">,</span>inName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token number">1.</span>问题描述<span class="token operator">:</span>service层只是处理业务的<span class="token punctuation">,</span>而获取连接对象这种事儿是service应该干的吗<span class="token operator">?</span>不是
          既然获取连接对象这种不在service层干<span class="token punctuation">,</span>那么dao层的连接对象怎么办<span class="token operator">?</span>

<span class="token number">2.</span>解决问题<span class="token operator">:</span>给service和dao层找一个<span class="token string">&quot;小秘书&quot;</span><span class="token punctuation">,</span>让这个<span class="token string">&quot;小秘书&quot;</span>去获取连接对象<span class="token punctuation">,</span>然后将获取的连接对象分别传给service层和dao层
          还要保证service层和dao层的连接对象是同一个<span class="token punctuation">,</span>不然事务不能生效

<span class="token number">3.</span>问题描述<span class="token operator">:</span>
  如果在多线程的情况下<span class="token punctuation">,</span>一个用户就相当于一个线程<span class="token punctuation">,</span>如何保证多个用户<span class="token punctuation">(</span>多个线程<span class="token punctuation">)</span>不会使用同一条连接对象<span class="token operator">?</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><img src="https://photo.sneoo.com/spring5/202207031648093.png" alt="image-20220408154342849" style="zoom:80%;"><img src="https://photo.sneoo.com/spring5/202207031648094.png" alt="image-20220408154956009" style="zoom:80%;"><h2 id="_2-threadlocal" tabindex="-1"><a class="header-anchor" href="#_2-threadlocal" aria-hidden="true">#</a> 2.ThreadLocal</h2><h3 id="_2-1-threadlocal基本使用和原理" tabindex="-1"><a class="header-anchor" href="#_2-1-threadlocal基本使用和原理" aria-hidden="true">#</a> 2.1.ThreadLocal基本使用和原理</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token number">1.</span>概述<span class="token operator">:</span>可以看做是一个容器<span class="token punctuation">,</span>专门放变量或者对象的
<span class="token number">2.</span>方法<span class="token operator">:</span>
  <span class="token keyword">void</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">T</span> value<span class="token punctuation">)</span><span class="token operator">-&gt;</span> 往<span class="token class-name">ThreadLocal</span>中存数据
  <span class="token class-name">T</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span>从<span class="token class-name">ThreadLocal</span>中获取数据
<span class="token number">3.</span>特点<span class="token operator">:</span>
  <span class="token class-name"><span class="token namespace">a<span class="token punctuation">.</span></span>ThreadLocal</span>中获取的元素都是最后一次存进去的<span class="token punctuation">,</span>一次只能存一个数据
  b<span class="token punctuation">.</span>一个线程往<span class="token class-name">TheadLocal</span>中存的数据<span class="token punctuation">,</span>其他线程获取不到
     在一条线程中使用的<span class="token class-name">ThreadLocal</span>中存储的对象<span class="token punctuation">,</span>是同一个对象
<span class="token number">4.</span>作用<span class="token operator">:</span>
  保证一条线程上使用的资源是同一个
      
<span class="token number">5.</span>ThreadLocal底层实质上是一个<span class="token class-name">Map</span>集合
  key<span class="token operator">:</span>当前正在执行的线程对象<span class="token operator">-&gt;</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  value<span class="token operator">:</span>随意<span class="token operator">-&gt;</span>往<span class="token class-name">ThreadLocal</span>中存的数据
  
  这样<span class="token punctuation">,</span>存数据的时候<span class="token class-name">ThreadLocal</span>底层直接将当前线程存的值和当前线程直接绑死<span class="token punctuation">,</span>所以别的线程拿不到值
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><img src="https://photo.sneoo.com/spring5/202207031648095.png" alt="image-20220408155921616" style="zoom:80%;"><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test01</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ThreadLocal</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> tl <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadLocal</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        tl<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;涛哥&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        tl<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;三上&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        tl<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;松下&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>tl<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//使用了另外一个线程</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>tl<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//null</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-2-连接对象管理类-小秘书" tabindex="-1"><a class="header-anchor" href="#_2-2-连接对象管理类-小秘书" aria-hidden="true">#</a> 2.2.连接对象管理类(小秘书)</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/*
  使用ThreadLocal类,将连接对象存进去
  保证一个用户使用一个连接对象
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConnectionManager</span> <span class="token punctuation">{</span>
    <span class="token comment">//定义一个ThreadLocal对象</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">ThreadLocal</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Connection</span><span class="token punctuation">&gt;</span></span> tl <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadLocal</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * 定义方法,从连接池中获取连接对象,存到ThreadLocal中
     * 然后将ThreadLocal中的连接对象返回
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Connection</span> <span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>
        <span class="token comment">//从ThreadLocal中获取连接对象,看看里面有没有Connection对象</span>
        <span class="token class-name">Connection</span> conn <span class="token operator">=</span> tl<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//判断,如果获取出来的连接对象为null,证明之前没有在ThreadLocal中存</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>conn<span class="token operator">==</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">//从连接池中获取一条连接对象,存入ThreadLocal中</span>
            conn <span class="token operator">=</span> <span class="token class-name">DruidUtils</span><span class="token punctuation">.</span><span class="token function">getDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            tl<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>conn<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> conn<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AccountService</span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * <span class="token keyword">@param</span> <span class="token parameter">outName</span>  出钱人姓名
     * <span class="token keyword">@param</span> <span class="token parameter">inName</span>   收钱人姓名
     * <span class="token keyword">@param</span> <span class="token parameter">money</span>    转账金额
     */</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">transfer</span><span class="token punctuation">(</span><span class="token class-name">String</span> outName<span class="token punctuation">,</span> <span class="token class-name">String</span> inName<span class="token punctuation">,</span> <span class="token keyword">int</span> money<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//直接将数据传递给dao</span>
        <span class="token class-name">AccountDao</span> accountDao <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AccountDao</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Connection</span> conn <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span><span class="token punctuation">{</span>
            conn <span class="token operator">=</span> <span class="token class-name">ConnectionManager</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//开启手动事务</span>
            conn<span class="token punctuation">.</span><span class="token function">setAutoCommit</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//减钱</span>
            accountDao<span class="token punctuation">.</span><span class="token function">outMoney</span><span class="token punctuation">(</span>outName<span class="token punctuation">,</span>money<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">/</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//加钱</span>
            accountDao<span class="token punctuation">.</span><span class="token function">inMoney</span><span class="token punctuation">(</span>inName<span class="token punctuation">,</span>money<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//提交事务</span>
            conn<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;转账成功&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">//回滚事务</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                conn<span class="token punctuation">.</span><span class="token function">rollback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;转账失败&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                ex<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>
            <span class="token class-name">DruidUtils</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>


    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AccountDao</span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * 转钱方法
     * <span class="token keyword">@param</span> <span class="token parameter">outName</span>  出钱人姓名
     * <span class="token keyword">@param</span> <span class="token parameter">money</span>    金额
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">outMoney</span><span class="token punctuation">(</span><span class="token class-name">String</span> outName<span class="token punctuation">,</span> <span class="token keyword">int</span> money<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">//创建QueryRunner对象</span>
        <span class="token class-name">QueryRunner</span> qr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryRunner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//利用连接管理类获取连接对象</span>
        <span class="token class-name">Connection</span> conn <span class="token operator">=</span> <span class="token class-name">ConnectionManager</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//准备sql</span>
        <span class="token class-name">String</span> outSql <span class="token operator">=</span> <span class="token string">&quot;update account set money = money-? where name = ?&quot;</span><span class="token punctuation">;</span>
        <span class="token comment">//执行sql</span>
        qr<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span>outSql<span class="token punctuation">,</span>money<span class="token punctuation">,</span>outName<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * 加钱方法
     * <span class="token keyword">@param</span> <span class="token parameter">inName</span>  收钱人姓名
     * <span class="token keyword">@param</span> <span class="token parameter">money</span>   金额
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">inMoney</span><span class="token punctuation">(</span><span class="token class-name">String</span> inName<span class="token punctuation">,</span> <span class="token keyword">int</span> money<span class="token punctuation">)</span><span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">//创建QueryRunner对象</span>
        <span class="token class-name">QueryRunner</span> qr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryRunner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//利用连接管理类获取连接对象</span>
        <span class="token class-name">Connection</span> conn <span class="token operator">=</span> <span class="token class-name">ConnectionManager</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//准备sql</span>
        <span class="token class-name">String</span> inSql <span class="token operator">=</span> <span class="token string">&quot;update account set money = money+? where name = ?&quot;</span><span class="token punctuation">;</span>
        <span class="token comment">//执行sql</span>
        qr<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span>inSql<span class="token punctuation">,</span>money<span class="token punctuation">,</span>inName<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-事务的特性以及隔离级别" tabindex="-1"><a class="header-anchor" href="#_3-事务的特性以及隔离级别" aria-hidden="true">#</a> 3.事务的特性以及隔离级别</h2><h3 id="_3-1-事务特性-acid" tabindex="-1"><a class="header-anchor" href="#_3-1-事务特性-acid" aria-hidden="true">#</a> 3.1.事务特性：ACID</h3><ul><li><p>原子性（Atomicity）原子性是指事务是一个不可分割的工作单位，事务中的操作要么都发生，要么都不发生。</p></li><li><p>一致性（Consistency）事务前后数据的完整性必须保持一致。</p></li><li><p>隔离性（Isolation）事务的隔离性是指多个用户并发访问数据库时，一个用户的事务不能被其它用户的事务所干扰，多个并发事务之间数据要相互隔离,正常情况下数据库是做不到这一点的,可以设置隔离级别,但是效率会非常低。</p></li><li><p>持久性（Durability）持久性是指一个事务一旦被提交，它对数据库中数据的改变就是永久性的，接下来即使数据库发生故障也不应该对其有任何影响。</p></li></ul><h3 id="_3-2-并发访问问题" tabindex="-1"><a class="header-anchor" href="#_3-2-并发访问问题" aria-hidden="true">#</a> 3.2 并发访问问题</h3><p>如果不考虑隔离性，事务存在3中并发访问问题。</p><ol><li><p>脏读：一个事务读到了另一个事务未提交的数据.</p></li><li><p>不可重复读：一个事务读到了另一个事务已经提交(update)的数据。引发另一个事务，在事务中的多次查询结果不一致。</p></li><li><p>虚读 /幻读：一个事务读到了另一个事务已经提交(insert)的数据。导致另一个事务，在事务中多次查询的结果不一致。</p></li></ol><h3 id="_3-3-隔离级别-解决问题" tabindex="-1"><a class="header-anchor" href="#_3-3-隔离级别-解决问题" aria-hidden="true">#</a> 3.3 隔离级别：解决问题</h3><ul><li>数据库规范规定了4种隔离级别，分别用于描述两个事务并发的所有情况。</li></ul><ol><li><p><strong>read uncommitted</strong> 读未提交，一个事务读到另一个事务没有提交的数据。</p><p>a)存在：3个问题（脏读、不可重复读、虚读）。</p><p>b)解决：0个问题</p></li><li><p><strong>read committed</strong> 读已提交，一个事务读到另一个事务已经提交的数据。</p><p>a)存在：2个问题（不可重复读、虚读）。</p><p>b)解决：1个问题（脏读）</p></li><li><p><strong>repeatable read</strong>:可重复读，在一个事务中读到的数据始终保持一致，无论另一个事务是否提交。</p><p>a)存在：1个问题（虚读）。</p><p>b)解决：2个问题（脏读、不可重复读）</p><p>4.<strong>serializable 串行化</strong>，同时只能执行一个事务，相当于事务中的单线程。</p></li></ol><p>a)存在：0个问题。</p><p>b)解决：3个问题（脏读、不可重复读、虚读）</p><ul><li>安全和性能对比 <ul><li>安全性：<code>serializable &gt; repeatable read &gt; read committed &gt; read uncommitted</code></li><li>性能 ： <code>serializable &lt; repeatable read &lt; read committed &lt; read uncommitted</code></li></ul></li><li>常见数据库的默认隔离级别： <ul><li>MySql：<code>repeatable read</code></li><li>Oracle：<code>read committed</code></li></ul></li></ul><h3 id="_3-4-演示" tabindex="-1"><a class="header-anchor" href="#_3-4-演示" aria-hidden="true">#</a> 3.4 演示</h3><ul><li><p>隔离级别演示参考：资料/隔离级别操作过程.doc【增强内容,了解】</p></li><li><p>查询数据库的隔离级别</p></li></ul><div class="language-mysql ext-mysql line-numbers-mode"><pre class="language-mysql"><code>show variables like &#39;%isolation%&#39;;
或
select @@tx_isolation;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://photo.sneoo.com/spring5/202207031648096.png" alt=""></p><ul><li><p>设置数据库的隔离级别</p><ul><li><code>set session transactionisolation level</code> 级别字符串</li><li>级别字符串：<code>readuncommitted</code>、<code>read committed</code>、<code>repeatable read</code>、<code>serializable</code></li><li>例如：<code>set session transaction isolation level read uncommitted;</code></li></ul></li><li><p>读未提交：readuncommitted</p><ul><li>A窗口设置隔离级别 <ul><li>AB同时开始事务</li><li>A 查询</li><li>B 更新，但不提交</li><li>A 再查询？-- 查询到了未提交的数据</li><li>B 回滚</li><li>A 再查询？-- 查询到事务开始前数据</li></ul></li></ul></li><li><p>读已提交：read committed</p><ul><li>A窗口设置隔离级别 <ul><li>AB同时开启事务</li><li>A查询</li><li>B更新、但不提交</li><li>A再查询？--数据不变，解决问题【脏读】</li><li>B提交</li><li>A再查询？--数据改变，存在问题【不可重复读】</li></ul></li></ul></li><li><p>可重复读：repeatable read</p><ul><li>A窗口设置隔离级别 <ul><li>AB 同时开启事务</li><li>A查询</li><li>B更新， 但不提交</li><li>A再查询？--数据不变，解决问题【脏读】</li><li>B提交</li><li>A再查询？--数据不变，解决问题【不可重复读】</li><li>A提交或回滚</li><li>A再查询？--数据改变，另一个事务</li></ul></li></ul></li><li><p>串行化：serializable</p><ul><li>A窗口设置隔离级别</li><li>AB同时开启事务</li><li>A查询 <ul><li>B更新？--等待(如果A没有进一步操作，B将等待超时)</li><li>A回滚</li><li>B 窗口？--等待结束，可以进行操作</li></ul></li></ul></li></ul><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token operator">-</span> 原子性（<span class="token class-name">Atomicity</span>）原子性是指事务是一个不可分割的工作单位，事务中的操作要么都发生，要么都不发生。 
<span class="token operator">-</span> 一致性（<span class="token class-name">Consistency</span>）事务前后数据的完整性必须保持一致。
<span class="token operator">-</span> 隔离性（<span class="token class-name">Isolation</span>）事务的隔离性是指多个用户并发访问数据库时，一个用户的事务不能被其它用户的事务所干扰，多个并发事务之间数据要相互隔离<span class="token punctuation">,</span>正常情况下数据库是做不到这一点的<span class="token punctuation">,</span>可以设置隔离级别<span class="token punctuation">,</span>但是隔离级别越高<span class="token punctuation">,</span>效率会非常低。
<span class="token operator">-</span> 持久性（<span class="token class-name">Durability</span>）持久性是指一个事务一旦被提交，它对数据库中数据的改变就是永久性的，接下来即使数据库发生故障也不应该对其有任何影响。
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>如果不考虑隔离性，事务存在<span class="token number">3</span>中并发访问问题。<span class="token punctuation">(</span>如果隔离级别低<span class="token punctuation">,</span>事务跟事务之间有可能互相影响<span class="token punctuation">)</span>

<span class="token number">1.</span> 脏读：一个事务读到了另一个事务未提交的数据<span class="token punctuation">.</span>
<span class="token number">2.</span> 不可重复读：一个事务读到了另一个事务已经提交<span class="token punctuation">(</span>update<span class="token punctuation">)</span>的数据。引发另一个事务，在事务中的多次查询结果不一致。
<span class="token number">3.</span> 虚读 <span class="token operator">/</span>幻读：一个事务读到了另一个事务已经提交<span class="token punctuation">(</span>insert<span class="token punctuation">)</span>的数据。导致另一个事务，在事务中多次查询的结果不一致。
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>总结<span class="token operator">:</span>
  我们最理想的状态是<span class="token operator">:</span>一个事务和其他事务互不影响
  
  但是如果不考虑隔离级别的话<span class="token punctuation">,</span>就会出现多个事务之间互相影响
  
  而事务互相影响的表现方式为<span class="token operator">:</span>
    脏读
    不可重复读
    虚读<span class="token operator">/</span>幻读
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div></div><footer class="page-meta"><div class="meta-item edit-link"><a class="nav-link meta-item-label" href="https://github.com/vuepress-reco/vuepress-theme-reco-next/edit/main/example//blogs/jdbc/day04%E7%AC%94%E8%AE%B0/day04.%E8%BF%9E%E6%8E%A5%E6%B1%A0_DBUtils_%E4%BA%8B%E5%8A%A1.md" rel="noopener noreferrer" target="_blank" aria-label="Edit this page"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" style="color:inherit;width:20px;height:20px;font-size:20px;"><g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 7H6a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h9a2 2 0 0 0 2-2v-3"></path><path d="M9 15h3l8.5-8.5a1.5 1.5 0 0 0-3-3L9 12v3"></path><path d="M16 5l3 3"></path></g></svg><span style="color:inherit;font-size:14px;"><!--[-->Edit this page<!--]--></span></a><!----><!--[--><!--]--></a></div><!----></footer><!----><div class="reco-valine-wrapper" style="display:none;"><div id="valine"></div></div></main><!--]--><div class="page-catalog-container"><h5 class="tip">ON THIS PAGE</h5><ul><!--[--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/blogs/jdbc/day04biji/day04.lianjiechi_DBUtils_shiwu.html#_1-mysql批量添加数据" class="router-link-active router-link-exact-active nav-link page-catalog-item" aria-label="1.mysql批量添加数据"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->1.mysql批量添加数据<!--]--></span></a><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/blogs/jdbc/day04biji/day04.lianjiechi_DBUtils_shiwu.html#_1-连接池之c3p0" class="router-link-active router-link-exact-active nav-link page-catalog-item" aria-label="1.连接池之C3p0"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->1.连接池之C3p0<!--]--></span></a><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/blogs/jdbc/day04biji/day04.lianjiechi_DBUtils_shiwu.html#_2-连接池之druid-德鲁伊" class="router-link-active router-link-exact-active nav-link page-catalog-item" aria-label="2.连接池之Druid(德鲁伊)"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->2.连接池之Druid(德鲁伊)<!--]--></span></a><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/blogs/jdbc/day04biji/day04.lianjiechi_DBUtils_shiwu.html#_1-准备工作" class="router-link-active router-link-exact-active nav-link page-catalog-item" aria-label="1.准备工作"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->1.准备工作<!--]--></span></a><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/blogs/jdbc/day04biji/day04.lianjiechi_DBUtils_shiwu.html#_2-dbutils的介绍" class="router-link-active router-link-exact-active nav-link page-catalog-item" aria-label="2.DBUtils的介绍"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->2.DBUtils的介绍<!--]--></span></a><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/blogs/jdbc/day04biji/day04.lianjiechi_DBUtils_shiwu.html#_3-queryrunner" class="router-link-active router-link-exact-active nav-link page-catalog-item" aria-label="3.QueryRunner"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->3.QueryRunner<!--]--></span></a><!--[--><!--]--></a></li><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/jdbc/day04biji/day04.lianjiechi_DBUtils_shiwu.html#_3-1-空参的queryrunner的介绍以及使用" class="router-link-active router-link-exact-active nav-link page-catalog-item" aria-label="3.1.空参的QueryRunner的介绍以及使用"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->3.1.空参的QueryRunner的介绍以及使用<!--]--></span></a><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/jdbc/day04biji/day04.lianjiechi_DBUtils_shiwu.html#_3-2-有参queryrunner的介绍以及使用" class="router-link-active router-link-exact-active nav-link page-catalog-item" aria-label="3.2.有参QueryRunner的介绍以及使用"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->3.2.有参QueryRunner的介绍以及使用<!--]--></span></a><!--[--><!--]--></a></li><!--]--><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/blogs/jdbc/day04biji/day04.lianjiechi_DBUtils_shiwu.html#_4-resultsethandler结果集" class="router-link-active router-link-exact-active nav-link page-catalog-item" aria-label="4.ResultSetHandler结果集"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->4.ResultSetHandler结果集<!--]--></span></a><!--[--><!--]--></a></li><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/jdbc/day04biji/day04.lianjiechi_DBUtils_shiwu.html#_4-1-标准的javabean" class="router-link-active router-link-exact-active nav-link page-catalog-item" aria-label="4.1.标准的JavaBean"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->4.1.标准的JavaBean<!--]--></span></a><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/jdbc/day04biji/day04.lianjiechi_DBUtils_shiwu.html#_4-2-beanhandler-t" class="router-link-active router-link-exact-active nav-link page-catalog-item" aria-label="4.2.BeanHandler&lt;T&gt;"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->4.2.BeanHandler&lt;T&gt;<!--]--></span></a><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/jdbc/day04biji/day04.lianjiechi_DBUtils_shiwu.html#_4-3-beanlisthandler-t" class="router-link-active router-link-exact-active nav-link page-catalog-item" aria-label="4.3.BeanListHandler&lt;T&gt;"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->4.3.BeanListHandler&lt;T&gt;<!--]--></span></a><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/jdbc/day04biji/day04.lianjiechi_DBUtils_shiwu.html#_4-4-scalarhandler" class="router-link-active router-link-exact-active nav-link page-catalog-item" aria-label="4.4.ScalarHandler"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->4.4.ScalarHandler<!--]--></span></a><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/jdbc/day04biji/day04.lianjiechi_DBUtils_shiwu.html#_4-5-columnlisthandler" class="router-link-active router-link-exact-active nav-link page-catalog-item" aria-label="4.5.ColumnListHandler"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->4.5.ColumnListHandler<!--]--></span></a><!--[--><!--]--></a></li><!--]--><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/blogs/jdbc/day04biji/day04.lianjiechi_DBUtils_shiwu.html#_1-事务" class="router-link-active router-link-exact-active nav-link page-catalog-item" aria-label="1.事务"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->1.事务<!--]--></span></a><!--[--><!--]--></a></li><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/jdbc/day04biji/day04.lianjiechi_DBUtils_shiwu.html#_1-1-事务-转账分析图" class="router-link-active router-link-exact-active nav-link page-catalog-item" aria-label="1.1.事务_转账分析图"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->1.1.事务_转账分析图<!--]--></span></a><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/jdbc/day04biji/day04.lianjiechi_DBUtils_shiwu.html#_1-2-实现转账-不加事务" class="router-link-active router-link-exact-active nav-link page-catalog-item" aria-label="1.2.实现转账(不加事务)"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->1.2.实现转账(不加事务)<!--]--></span></a><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/jdbc/day04biji/day04.lianjiechi_DBUtils_shiwu.html#_1-3-事务的介绍" class="router-link-active router-link-exact-active nav-link page-catalog-item" aria-label="1.3.事务的介绍"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->1.3.事务的介绍<!--]--></span></a><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/jdbc/day04biji/day04.lianjiechi_DBUtils_shiwu.html#_1-4-dbutils实现转账-添加事务" class="router-link-active router-link-exact-active nav-link page-catalog-item" aria-label="1.4.DBUtils实现转账(添加事务)"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->1.4.DBUtils实现转账(添加事务)<!--]--></span></a><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/jdbc/day04biji/day04.lianjiechi_DBUtils_shiwu.html#_1-5-mysql中操作事务-了解" class="router-link-active router-link-exact-active nav-link page-catalog-item" aria-label="1.5.mysql中操作事务_了解"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->1.5.mysql中操作事务_了解<!--]--></span></a><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/jdbc/day04biji/day04.lianjiechi_DBUtils_shiwu.html#_1-6-分层思想介绍以及架构搭建" class="router-link-active router-link-exact-active nav-link page-catalog-item" aria-label="1.6.分层思想介绍以及架构搭建"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->1.6.分层思想介绍以及架构搭建<!--]--></span></a><!--[--><!--]--></a></li><!--]--><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/blogs/jdbc/day04biji/day04.lianjiechi_DBUtils_shiwu.html#_2-threadlocal" class="router-link-active router-link-exact-active nav-link page-catalog-item" aria-label="2.ThreadLocal"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->2.ThreadLocal<!--]--></span></a><!--[--><!--]--></a></li><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/jdbc/day04biji/day04.lianjiechi_DBUtils_shiwu.html#_2-1-threadlocal基本使用和原理" class="router-link-active router-link-exact-active nav-link page-catalog-item" aria-label="2.1.ThreadLocal基本使用和原理"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->2.1.ThreadLocal基本使用和原理<!--]--></span></a><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/jdbc/day04biji/day04.lianjiechi_DBUtils_shiwu.html#_2-2-连接对象管理类-小秘书" class="router-link-active router-link-exact-active nav-link page-catalog-item" aria-label="2.2.连接对象管理类(小秘书)"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->2.2.连接对象管理类(小秘书)<!--]--></span></a><!--[--><!--]--></a></li><!--]--><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/blogs/jdbc/day04biji/day04.lianjiechi_DBUtils_shiwu.html#_3-事务的特性以及隔离级别" class="router-link-active router-link-exact-active nav-link page-catalog-item" aria-label="3.事务的特性以及隔离级别"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->3.事务的特性以及隔离级别<!--]--></span></a><!--[--><!--]--></a></li><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/jdbc/day04biji/day04.lianjiechi_DBUtils_shiwu.html#_3-1-事务特性-acid" class="router-link-active router-link-exact-active nav-link page-catalog-item" aria-label="3.1.事务特性：ACID"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->3.1.事务特性：ACID<!--]--></span></a><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/jdbc/day04biji/day04.lianjiechi_DBUtils_shiwu.html#_3-2-并发访问问题" class="router-link-active router-link-exact-active nav-link page-catalog-item" aria-label="3.2 并发访问问题"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->3.2 并发访问问题<!--]--></span></a><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/jdbc/day04biji/day04.lianjiechi_DBUtils_shiwu.html#_3-3-隔离级别-解决问题" class="router-link-active router-link-exact-active nav-link page-catalog-item" aria-label="3.3 隔离级别：解决问题"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->3.3 隔离级别：解决问题<!--]--></span></a><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/jdbc/day04biji/day04.lianjiechi_DBUtils_shiwu.html#_3-4-演示" class="router-link-active router-link-exact-active nav-link page-catalog-item" aria-label="3.4 演示"><!--[--><!--]--><a class="icon-container left" href="javascript:void(0)"><!----><span style="color:inherit;font-size:14px;"><!--[-->3.4 演示<!--]--></span></a><!--[--><!--]--></a></li><!--]--><!--]--><!--]--></ul></div></div></div><!----><!----><!--]--></div>
    <script type="module" src="/assets/app.a3ab45a4.js" defer></script>
  </body>
</html>
